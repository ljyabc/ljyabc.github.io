<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false,"dimmer":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Redis缓存技术1. NoSQL产品12memcachedredis 2. redis面试常问问题：功能介绍12345678910高速读写数据类型丰富    （笔试、面试）*****支持持久化      （笔试、面试）*****多种内存分配及回收策略支持事务			（面试）  ****消息队列、消息订阅 支持高可用                     ****支持分布式分片集群 （面试）">
<meta name="keywords" content="redis">
<meta property="og:type" content="article">
<meta property="og:title" content="redis缓存技术">
<meta property="og:url" content="https://ljyabc.github.io/2019/03/31/redis缓存技术/index.html">
<meta property="og:site_name" content="择墅居:李江洋">
<meta property="og:description" content="Redis缓存技术1. NoSQL产品12memcachedredis 2. redis面试常问问题：功能介绍12345678910高速读写数据类型丰富    （笔试、面试）*****支持持久化      （笔试、面试）*****多种内存分配及回收策略支持事务			（面试）  ****消息队列、消息订阅 支持高可用                     ****支持分布式分片集群 （面试）">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553340666820.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553341990178.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553452880488.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553455706534.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553455764675.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553455959728.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553456485956.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553456593470.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553456758673.png">
<meta property="og:updated_time" content="2025-04-08T14:37:54.219Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="redis缓存技术">
<meta name="twitter:description" content="Redis缓存技术1. NoSQL产品12memcachedredis 2. redis面试常问问题：功能介绍12345678910高速读写数据类型丰富    （笔试、面试）*****支持持久化      （笔试、面试）*****多种内存分配及回收策略支持事务			（面试）  ****消息队列、消息订阅 支持高可用                     ****支持分布式分片集群 （面试）">
<meta name="twitter:image" content="https://ljyabc.github.io/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553340666820.png">






  <link rel="canonical" href="https://ljyabc.github.io/2019/03/31/redis缓存技术/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>redis缓存技术 | 择墅居:李江洋</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">择墅居:李江洋</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">争做长沙别墅豪装第一品牌</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-schedule">

    
    
    
      
    

    

    <a href="/schedule/" rel="section"><i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>日程表</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-sitemap">

    
    
    
      
    

    

    <a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>站点地图</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-commonweal">

    
    
    
      
    

    

    <a href="/404/" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>公益 404</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-book">

    
    
    
      
    

    

    <a href="/book" rel="section"><i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>book</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ljyabc.github.io/2019/03/31/redis缓存技术/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="李江洋">
      <meta itemprop="description" content="记录学习的技能和遇到的问题">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="择墅居:李江洋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">redis缓存技术

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-03-31 15:50:51" itemprop="dateCreated datePublished" datetime="2019-03-31T15:50:51+08:00">2019-03-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2025-04-08 22:37:54" itemprop="dateModified" datetime="2025-04-08T22:37:54+08:00">2025-04-08</time>
              
            
          </span>

          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/03/31/redis缓存技术/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/03/31/redis缓存技术/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Redis缓存技术"><a href="#Redis缓存技术" class="headerlink" title="Redis缓存技术"></a>Redis缓存技术</h1><h4 id="1-NoSQL产品"><a href="#1-NoSQL产品" class="headerlink" title="1. NoSQL产品"></a>1. NoSQL产品</h4><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">memcached</span></span><br><span class="line"><span class="attribute">redis</span></span><br></pre></td></tr></table></figure>
<h4 id="2-redis面试常问问题：功能介绍"><a href="#2-redis面试常问问题：功能介绍" class="headerlink" title="2. redis面试常问问题：功能介绍"></a>2. redis面试常问问题：功能介绍</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">高速读写</span><br><span class="line">数据类型丰富    （笔试、面试）<span class="strong">*****</span></span><br><span class="line">支持持久化      （笔试、面试）<span class="strong">*****</span></span><br><span class="line">多种内存分配及回收策略</span><br><span class="line">支持事务			（面试）  <span class="emphasis">***</span>*</span><br><span class="line">消息队列、消息订阅 </span><br><span class="line">支持高可用                     <span class="emphasis">***</span>*</span><br><span class="line">支持分布式分片集群 （面试）   <span class="strong">*****</span></span><br><span class="line">缓存穿透\雪崩（笔试、面试）   <span class="strong">*****</span></span><br><span class="line">Redis API					   **</span><br></pre></td></tr></table></figure>
<h4 id="3-企业缓存产品介绍"><a href="#3-企业缓存产品介绍" class="headerlink" title="3. 企业缓存产品介绍"></a>3. 企业缓存产品介绍</h4><h5 id="3-1-memcached"><a href="#3-1-memcached" class="headerlink" title="3.1 memcached"></a>3.1 memcached</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">优点：高性能读写、单一数据类型、支持客户端式分布式集群、一致性	<span class="built_in">hash</span>多核结构、多线程读写性能高。</span><br><span class="line"></span><br><span class="line">缺点：</span><br><span class="line">无持久化、节点故障可能出现缓存穿透、分布式需要客户端实现、跨机房数据同步困难、架构扩容复杂度高</span><br></pre></td></tr></table></figure>
<h5 id="3-2-redis"><a href="#3-2-redis" class="headerlink" title="3.2 redis"></a>3.2 redis</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">优点：高性能读写、多数据类型支持、数据持久化、高可用架构、支持自定义虚拟内存、支持分布式分片集群、单线程读写性能极高</span><br><span class="line"></span><br><span class="line">缺点：多线程读写较Memcached慢</span><br><span class="line"></span><br><span class="line">应用的场景：</span><br><span class="line">新浪、京东、直播类平台、网页游戏</span><br></pre></td></tr></table></figure>
<h5 id="3-3-memcache与redis在读写性能的对比"><a href="#3-3-memcache与redis在读写性能的对比" class="headerlink" title="3.3 memcache与redis在读写性能的对比"></a>3.3 memcache与redis在读写性能的对比</h5><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">memcached 适合,多用户访问,每个用户少量的rw</span><br><span class="line">redis     适合,少用户访问,每个用户大量rw	</span><br><span class="line">			</span><br><span class="line">Tair：淘宝使用的</span><br><span class="line">优点：高性能读写、支持三种存储引擎（<span class="built_in">ddb</span>、rdb、ldb）、支持高可用、支持分布式分片集群、支撑了几乎所有淘宝业务的缓存。</span><br><span class="line"></span><br><span class="line">缺点：单机情况下，读写性能较其他两种产品较慢</span><br></pre></td></tr></table></figure>
<h5 id="3-4-Redis使用场景介绍"><a href="#3-4-Redis使用场景介绍" class="headerlink" title="3.4 Redis使用场景介绍"></a>3.4 Redis使用场景介绍</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Memcached：多核的缓存服务，更加适合于多用户并发访问次数较少的应用场景</span><br><span class="line"></span><br><span class="line">Redis：单核的缓存服务，单节点情况下，更加适合于少量用户，多次访问的应用场景。</span><br><span class="line"></span><br><span class="line">Redis一般是单机多实例架构，配合redis集群出现。</span><br></pre></td></tr></table></figure>
<h4 id="4-Redis安装部署"><a href="#4-Redis安装部署" class="headerlink" title="4. Redis安装部署"></a>4. Redis安装部署</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">下载：</span><br><span class="line">wget http://download.redis.io/releases/redis<span class="number">-3.2</span><span class="number">.12</span>.tar.gz</span><br><span class="line">解压：</span><br><span class="line">上传至 /data</span><br><span class="line">tar xzf redis<span class="number">-3.2</span><span class="number">.12</span>.tar.gz</span><br><span class="line">mv redis<span class="number">-3.2</span><span class="number">.12</span> redis</span><br><span class="line">安装：</span><br><span class="line">cd redis</span><br><span class="line">make</span><br><span class="line">启动：</span><br><span class="line">src/redis-server &amp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">环境变量：</span><br><span class="line">vim /etc/profile </span><br><span class="line">export PATH=/data/redis/src:$PATH</span><br><span class="line">source /etc/profile </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">redis-server &amp; </span><br><span class="line"></span><br><span class="line">redis-cli </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; set num <span class="number">10</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get num</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure>
<p><img src="/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553340666820.png" alt="1553340666820"></p>
<h4 id="5-Redis基本管理操作"><a href="#5-Redis基本管理操作" class="headerlink" title="5. Redis基本管理操作"></a>5. Redis基本管理操作</h4><h5 id="5-1-基础配置文件介绍"><a href="#5-1-基础配置文件介绍" class="headerlink" title="5.1 基础配置文件介绍"></a>5.1 基础配置文件介绍</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1.设置配置文件</span><br><span class="line">[root@standby ~]# redis-cli  shutdown </span><br><span class="line"></span><br><span class="line">mkdir /data/6379</span><br><span class="line"></span><br><span class="line">cat &gt;&gt;/data/6379/redis.conf &lt;&lt;EOF</span><br><span class="line">daemonize yes #守护进程</span><br><span class="line">port 6379 #端口</span><br><span class="line">logfile /data/6379/redis.log # 日志</span><br><span class="line">dir /data/6379 #文件目录</span><br><span class="line">dbfilename dump.rdb #文件名字</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">2.重启redis</span><br><span class="line">redis-cli shutdown </span><br><span class="line">redis-server /data/6379/redis.conf </span><br><span class="line">netstat -lnp|grep 63</span><br></pre></td></tr></table></figure>
<h5 id="5-2-配置文件说明"><a href="#5-2-配置文件说明" class="headerlink" title="5.2 配置文件说明"></a>5.2 配置文件说明</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">redis.conf</span><br><span class="line">1.是否后台运行</span><br><span class="line">daemonize yes</span><br><span class="line"></span><br><span class="line">2.默认端口：</span><br><span class="line">port 6379</span><br><span class="line"></span><br><span class="line">3.日志文件位置</span><br><span class="line">logfile /var/log/redis.log</span><br><span class="line"></span><br><span class="line">4.持久化文件存储位置</span><br><span class="line">dir /data/6379</span><br><span class="line"></span><br><span class="line">5.RDB持久化数据文件:</span><br><span class="line">dbfilename dump.rdb</span><br></pre></td></tr></table></figure>
<h5 id="5-3-redis-cli-客户端命令常用参数说明"><a href="#5-3-redis-cli-客户端命令常用参数说明" class="headerlink" title="5.3 redis-cli 客户端命令常用参数说明"></a>5.3 redis-cli 客户端命令常用参数说明</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">redis-cli 刚装完,可以在redis服务器上直接登录redis</span><br><span class="line">-p <span class="number">6379</span>   指定端口号</span><br><span class="line">-h        指定链接地址</span><br><span class="line">-a        指定链接密码</span><br><span class="line">redis-cli  set num  <span class="number">10</span> ,无交互执行redis命令</span><br><span class="line">cat /tmp/<span class="number">1.</span>txt |redis-cli</span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># redis-cli -h 10.0.0.51  -p 6379</span></span><br><span class="line"><span class="number">10.0</span><span class="number">.0</span><span class="number">.51</span>:<span class="number">6379</span>&gt;</span><br></pre></td></tr></table></figure>
<h5 id="5-4-redis安全配置-指定IP-设置验证密码"><a href="#5-4-redis安全配置-指定IP-设置验证密码" class="headerlink" title="5.4 redis安全配置:指定IP/设置验证密码"></a>5.4 redis安全配置:指定IP/设置验证密码</h5><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis默认开启了保护模式，只允许本地回环地址登录并访问数据库。</span><br><span class="line"></span><br><span class="line">禁止protected-<span class="keyword">mode</span></span><br><span class="line"></span><br><span class="line">protected-<span class="keyword">mode</span> yes/<span class="keyword">no</span> （保护模式，是否只允许本地访问）</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">(1)Bind :指定IP进行监听</span><br><span class="line">echo &quot;bind 10.0.0.200  127.0.0.1&quot; &gt;&gt;/data/6379/redis.conf</span><br><span class="line">(2)增加requirepass  &#123;password&#125;</span><br><span class="line">echo &quot;requirepass 123&quot; &gt;&gt;/data/6379/redis.conf</span><br><span class="line"></span><br><span class="line">重启redis</span><br><span class="line">redis-cli shutdown </span><br><span class="line">redis-server /data/6379/redis.conf </span><br><span class="line"></span><br><span class="line">----------验证-----</span><br><span class="line">方法一：</span><br><span class="line">[root@db03 ~]# redis-cli -a 123</span><br><span class="line">127.0.0.1:6379&gt; set name zhangsan </span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; exit</span><br><span class="line">方法二：</span><br><span class="line">[root@db03 ~]# redis-cli</span><br><span class="line">127.0.0.1:6379&gt; auth 123</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set a b</span><br></pre></td></tr></table></figure>
<h5 id="5-5-在线查看和修改配置"><a href="#5-5-在线查看和修改配置" class="headerlink" title="5.5 在线查看和修改配置"></a>5.5 在线查看和修改配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CONFIG GET *</span><br><span class="line">CONFIG GET requirepass</span><br><span class="line">CONFIG SET requirepass 123 #修改密码,不会自动写入配置</span><br></pre></td></tr></table></figure>
<hr>
<p><img src="/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553341990178.png" alt="1553341990178"></p>
<h4 id="6-redis持久化（内存数据保存到磁盘）"><a href="#6-redis持久化（内存数据保存到磁盘）" class="headerlink" title="6. redis持久化（内存数据保存到磁盘）"></a>6. redis持久化（内存数据保存到磁盘）</h4><h5 id="6-1-作用"><a href="#6-1-作用" class="headerlink" title="6.1 作用"></a>6.1 作用</h5><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">作用:可以有效防止,在redis宕机后,缓存失效的问题.</span><br></pre></td></tr></table></figure>
<h5 id="6-2-RDB-持久化"><a href="#6-2-RDB-持久化" class="headerlink" title="6.2 RDB 持久化"></a>6.2 RDB 持久化</h5><blockquote>
<p><strong>1. 优缺点</strong></p>
</blockquote>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">可以在指定的时间间隔内生成数据集的时间点快照（point-<span class="keyword">in</span>-<span class="built_in">time</span> snapshot）。</span><br><span class="line"></span><br><span class="line">优点：</span><br><span class="line">速度快，适合于用做备份，主从复制也是基于RDB持久化功能实现的。</span><br><span class="line"></span><br><span class="line">缺点：</span><br><span class="line">会有数据丢失</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>2.rdb持久化核心配置参数</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vim /data/6379/redis.conf</span><br><span class="line">dir /data/6379</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"></span><br><span class="line">配置分别表示：</span><br><span class="line">dir              ---redis持久化的文件目录</span><br><span class="line">dbfilename       ----redis持久化的文件名</span><br><span class="line">900秒（15分钟）内有1个更改</span><br><span class="line">300秒（5分钟）内有10个更改</span><br><span class="line">60秒内有10000个更改</span><br></pre></td></tr></table></figure>
<h5 id="6-3-AOF-持久化-append-only-log-file"><a href="#6-3-AOF-持久化-append-only-log-file" class="headerlink" title="6.3 AOF 持久化(append-only log file)"></a>6.3 AOF 持久化(append-only log file)</h5><blockquote>
<p><strong>1.优缺点</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">记录服务器执行的所有写操作命令，并在服务器启动时，通过重新执行这些命令来还原数据集。 </span><br><span class="line">AOF 文件中的命令全部以 Redis 协议的格式来保存，新命令会被追加到文件的末尾。</span><br><span class="line"></span><br><span class="line">优点：可以最大程度保证数据不丢</span><br><span class="line">缺点：日志记录量级比较大</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>2.AOF持久化配置</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1.配置参数</span><br><span class="line">appendonly yes</span><br><span class="line">appendfsync everysec</span><br><span class="line"></span><br><span class="line">appendfsync always</span><br><span class="line">appendfsync no</span><br><span class="line"></span><br><span class="line">2.配置介绍</span><br><span class="line">是否打开aof日志功能</span><br><span class="line">每1个命令,都立即同步到aof </span><br><span class="line">每秒写1次</span><br><span class="line">写入工作交给操作系统,由操作系统判断缓冲区大小,统一写入到aof.</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">appendfsync 只需要配置一个就可以</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.配置</span><br><span class="line">vim /data/6379/redis.conf</span><br><span class="line">appendonly yes</span><br><span class="line">appendfsync everysec</span><br></pre></td></tr></table></figure>
<h5 id="6-4-redis-持久化方式有哪些？有什么区别？"><a href="#6-4-redis-持久化方式有哪些？有什么区别？" class="headerlink" title="6.4 redis 持久化方式有哪些？有什么区别？"></a>6.4 redis 持久化方式有哪些？有什么区别？</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rdb：基于快照的持久化，速度更快，一般用作备份，主从复制也是依赖于rdb持久化功能</span><br><span class="line"></span><br><span class="line">aof：以追加的方式记录redis操作日志的文件。可以最大程度的保证redis数据安全，类似于mysql的binlog</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="7-Redis数据类型-笔试"><a href="#7-Redis数据类型-笔试" class="headerlink" title="7. Redis数据类型(笔试)"></a>7. Redis数据类型(笔试)</h4><h5 id="7-1-介绍"><a href="#7-1-介绍" class="headerlink" title="7.1 介绍"></a>7.1 介绍</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">String ：     字符类型</span><br><span class="line">Hash：        字典类型</span><br><span class="line">List：        列表     </span><br><span class="line">Set：         集合 </span><br><span class="line">Sorted set：  有序集合</span><br><span class="line"></span><br><span class="line">---------------------------</span><br><span class="line">键      值</span><br><span class="line">key     value</span><br><span class="line"></span><br><span class="line">key     col1 value1  col2 value2 </span><br><span class="line"></span><br><span class="line">key     [a,b,c,d]  </span><br><span class="line">         <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br><span class="line">		 		 </span><br><span class="line">key1    (a,b,c,d)  </span><br><span class="line"></span><br><span class="line">		  <span class="number">10</span>	 <span class="number">20</span>   <span class="number">30</span>  <span class="number">40</span> ----打分</span><br><span class="line">key1     ( a,    b,   c,  d)  </span><br><span class="line">           <span class="number">0</span>     <span class="number">1</span>    <span class="number">2</span>   <span class="number">3</span></span><br></pre></td></tr></table></figure>
<h5 id="7-2-键的通用操作"><a href="#7-2-键的通用操作" class="headerlink" title="7.2 键的通用操作"></a>7.2 键的通用操作</h5><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">KEYS * 	 keys a  keys a*	查看已存在所有键的名字   ****</span><br><span class="line">TYPE						返回键所存储值的类型     ****</span><br><span class="line">EXISTS 				        检查是否存在             *****</span><br><span class="line">再get</span><br><span class="line">EXPIRE\ PEXPIRE 			以秒\毫秒设定生存时间       ***</span><br><span class="line">设置EXPIRE</span><br><span class="line">TTL\ PTTL 					以秒\毫秒为单位返回生存时间 ***</span><br><span class="line">显示</span><br><span class="line">PERSIST 					取消生存实现设置            ***</span><br><span class="line">DEL							删除一个key</span><br><span class="line">RENAME 				        变更KEY名</span><br></pre></td></tr></table></figure>
<p><img src="/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553452880488.png" alt="1553452880488"></p>
<h5 id="7-3-string类型的应用场景"><a href="#7-3-string类型的应用场景" class="headerlink" title="7.3 string类型的应用场景"></a>7.3 string类型的应用场景</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">应用场景</span><br><span class="line"></span><br><span class="line">常规计数：</span><br><span class="line">微博数，粉丝数等。</span><br><span class="line">订阅、礼物、页游</span><br><span class="line">key:value</span><br><span class="line"></span><br><span class="line">计数器</span><br><span class="line">每点一次关注，都执行以下命令一次</span><br><span class="line">127.0.0.1:6379&gt; incr fans_count</span><br><span class="line">(integer) 10003</span><br><span class="line">INCRBY num 100000</span><br><span class="line">127.0.0.1:6379&gt; get fans_count</span><br><span class="line">&quot;10003&quot;</span><br><span class="line">127.0.0.1:6379&gt; incrby fans_count 1000</span><br><span class="line">(integer) 11003</span><br><span class="line">127.0.0.1:6379&gt; decr fans_count </span><br><span class="line">(integer) 11002</span><br><span class="line">127.0.0.1:6379&gt; decrby  fans_count 1000</span><br></pre></td></tr></table></figure>
<h5 id="7-4-hash类型的应用场景"><a href="#7-4-hash类型的应用场景" class="headerlink" title="7.4 hash类型的应用场景"></a>7.4 hash类型的应用场景</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">hash</span>类型（字典类型）</span><br><span class="line"></span><br><span class="line">应用场景：</span><br><span class="line">存储部分变更的数据，如用户信息等。</span><br><span class="line">最接近mysql表结构的一种类型</span><br></pre></td></tr></table></figure>
<h5 id="7-5-list列表的应用场景"><a href="#7-5-list列表的应用场景" class="headerlink" title="7.5 list列表的应用场景"></a>7.5 list列表的应用场景</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">消息队列系统：后进先出</span><br><span class="line">比如sina微博:在Redis中我们的最新微博ID使用了常驻缓存，这是一直更新的。</span><br><span class="line">但是做了限制不能超过5000个ID，因此获取ID的函数会一直询问Redis。</span><br><span class="line">只有在<span class="keyword">start</span>/<span class="keyword">count</span>参数超出了这个范围的时候，才需要去访问数据库。</span><br><span class="line">系统不会像传统方式那样“刷新”缓存，Redis实例中的信息永远是一致的。</span><br><span class="line"><span class="keyword">SQL</span>数据库（或是硬盘上的其他类型数据库）只是在用户需要获取“很远”的数据时才会被触发，</span><br><span class="line">而主页或第一个评论页是不会麻烦到硬盘上的数据库了。</span><br></pre></td></tr></table></figure>
<h5 id="7-6-SET-集合类型（类似于mysql中的join）应用场景"><a href="#7-6-SET-集合类型（类似于mysql中的join）应用场景" class="headerlink" title="7.6 SET 集合类型（类似于mysql中的join）应用场景"></a>7.6 SET 集合类型（类似于mysql中的join）应用场景</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">应用场景：</span><br><span class="line">案例：在微博应用中，可以将一个用户所有的关注人存在一个集合中，将其所有粉丝存在一个集合。</span><br><span class="line">Redis还为集合提供了求交集、并集、差集等操作，可以非常方便的实现如共同关注、共同喜好、二度好友等功能，</span><br><span class="line">对上面的所有集合操作，你还可以使用不同的命令选择将结果返回给客户端还是存集到一个新的集合中。</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>1.经典案例</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">-------------</span><br><span class="line">127.0.0.1:6379&gt; sadd lxl pg1 pg2 songlaoban oldnie oldchen marong</span><br><span class="line">(integer) 6</span><br><span class="line">127.0.0.1:6379&gt; sadd jnl baoqiang yufan oldchen songzhe</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; sadd jnl baoqiang yufan oldchen songzhe oldguo  alexdsb </span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line">127.0.0.1:6379&gt; smembers lxl</span><br><span class="line">1) &quot;pg2&quot;</span><br><span class="line">2) &quot;pg1&quot;</span><br><span class="line">3) &quot;oldnie&quot;</span><br><span class="line">4) &quot;songlaoban&quot;</span><br><span class="line">5) &quot;marong&quot;</span><br><span class="line">6) &quot;oldchen&quot;</span><br><span class="line">127.0.0.1:6379&gt; smembers jnl</span><br><span class="line">1) &quot;alexdsb&quot;</span><br><span class="line">2) &quot;yufan&quot;</span><br><span class="line">3) &quot;oldguo&quot;</span><br><span class="line">4) &quot;songzhe&quot;</span><br><span class="line">5) &quot;baoqiang&quot;</span><br><span class="line">6) &quot;oldchen&quot;</span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; SUNION lxl jnl  #-------合集（去重）</span><br><span class="line"> 1) &quot;marong&quot;</span><br><span class="line"> 2) &quot;pg2&quot;</span><br><span class="line"> 3) &quot;pg1&quot;</span><br><span class="line"> 4) &quot;oldchen&quot;</span><br><span class="line"> 5) &quot;alexdsb&quot;</span><br><span class="line"> 6) &quot;yufan&quot;</span><br><span class="line"> 7) &quot;songlaoban&quot;</span><br><span class="line"> 8) &quot;baoqiang&quot;</span><br><span class="line"> 9) &quot;oldnie&quot;</span><br><span class="line">10) &quot;songzhe&quot;</span><br><span class="line">11) &quot;oldguo&quot;</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; SINTER lxl jnl  #-----并集</span><br><span class="line">1) &quot;oldchen&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line">127.0.0.1:6379&gt; SDIFF lxl jnl   # ----差集</span><br><span class="line">1) &quot;songlaoban&quot;</span><br><span class="line">2) &quot;oldnie&quot;</span><br><span class="line">3) &quot;pg1&quot;</span><br><span class="line">4) &quot;pg2&quot;</span><br><span class="line">5) &quot;marong&quot;</span><br><span class="line">127.0.0.1:6379&gt; SDIFF  jnl lxl </span><br><span class="line">1) &quot;alexdsb&quot;</span><br><span class="line">2) &quot;yufan&quot;</span><br><span class="line">3) &quot;songzhe&quot;</span><br><span class="line">4) &quot;oldguo&quot;</span><br><span class="line">5) &quot;baoqiang&quot;</span><br><span class="line">-----------------</span><br></pre></td></tr></table></figure>
<h5 id="7-7-SortedSet（有序集合）应用场景"><a href="#7-7-SortedSet（有序集合）应用场景" class="headerlink" title="7.7 SortedSet（有序集合）应用场景"></a>7.7 SortedSet（有序集合）应用场景</h5><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">应用场景：</span><br><span class="line">排行榜应用，取TOP N操作</span><br><span class="line"></span><br><span class="line">这个需求与上面需求的不同之处在于，前面操作以时间为权重，这个是以某个条件为权重，比如按顶的次数排序，这时候就需要我们的sorted <span class="keyword">set</span>出马了，将你要排序的值设置成sorted <span class="keyword">set</span>的score，将具体的数据设置成相应的<span class="keyword">value</span>，每次只需要执行一条ZADD命令即可。</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>1.经典案例</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">--------------</span><br><span class="line">127.0.0.1:6379&gt; zadd topN 0 smlt 0 fskl 0 fshkl 0 lzlsfs 0 wdhbx 0 wxg </span><br><span class="line">(integer) 6</span><br><span class="line">127.0.0.1:6379&gt; ZINCRBY topN 100000 smlt #手动设置点播数</span><br><span class="line">&quot;100000&quot;</span><br><span class="line">127.0.0.1:6379&gt; ZINCRBY topN 10000 fskl</span><br><span class="line">&quot;10000&quot;</span><br><span class="line">127.0.0.1:6379&gt; ZINCRBY topN 1000000 fshkl</span><br><span class="line">&quot;1000000&quot;</span><br><span class="line">127.0.0.1:6379&gt; ZINCRBY topN 100 lzlsfs</span><br><span class="line">&quot;100&quot;</span><br><span class="line">127.0.0.1:6379&gt; ZINCRBY topN 10 wdhbx</span><br><span class="line">&quot;10&quot;</span><br><span class="line">127.0.0.1:6379&gt; ZINCRBY topN 100000000 wxg</span><br><span class="line">&quot;100000000&quot;</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ZREVRANGE topN 0 2 </span><br><span class="line">1) &quot;wxg&quot;</span><br><span class="line">2) &quot;fshkl&quot;</span><br><span class="line">3) &quot;smlt&quot;</span><br><span class="line">127.0.0.1:6379&gt; ZREVRANGE topN 0 2 withscores</span><br><span class="line">1) &quot;wxg&quot;</span><br><span class="line">2) &quot;100000000&quot;</span><br><span class="line">3) &quot;fshkl&quot;</span><br><span class="line">4) &quot;1000000&quot;</span><br><span class="line">5) &quot;smlt&quot;</span><br><span class="line">6) &quot;100000&quot;</span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line"></span><br><span class="line">--------------</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="8-redis的发布订阅"><a href="#8-redis的发布订阅" class="headerlink" title="8. redis的发布订阅"></a>8. redis的发布订阅</h4><h5 id="8-1-发布订阅系统的相关指令"><a href="#8-1-发布订阅系统的相关指令" class="headerlink" title="8.1 发布订阅系统的相关指令"></a>8.1 发布订阅系统的相关指令</h5><p>领事回话关了没了</p>
<p><img src="/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553455706534.png" alt="1553455706534"></p>
<p><img src="/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553455764675.png" alt="1553455764675"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>PUBLISH channel msg</span><br><span class="line">将信息 message 发送到指定的频道 channel</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>SUBSCRIBE channel [channel ...]</span><br><span class="line">订阅频道，可以同时订阅多个频道</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>UNSUBSCRIBE [channel ...]</span><br><span class="line">取消订阅指定的频道, 如果不指定频道，则会取消订阅所有频道</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>PSUBSCRIBE pattern [pattern ...]</span><br><span class="line">订阅一个或多个符合给定模式的频道，每个模式以 * 作为匹配符，比如 it* 匹配所	有以 it 开头的频道( it.news 、 it.blog 、 it.tweets 等等)， news.* 匹配所有	以 news. 开头的频道( news.it 、 news.<span class="keyword">global</span>.today 等等)，诸如此类</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>PUNSUBSCRIBE [pattern [pattern ...]]</span><br><span class="line">退订指定的规则, 如果没有参数则会退订所有规则</span><br><span class="line"></span><br><span class="line"><span class="number">6.</span>PUBSUB subcommand [argument [argument ...]]</span><br><span class="line">查看订阅与发布系统状态</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">使用发布订阅模式实现的消息队列，当有客户端订阅channel后只能收到后续发布到该频道的消息，之前发送的不会缓存，必须Provider和Consumer同时在线。</span><br></pre></td></tr></table></figure>
<h5 id="8-2-实例"><a href="#8-2-实例" class="headerlink" title="8.2 实例"></a>8.2 实例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">发布订阅例子：</span><br><span class="line"></span><br><span class="line">窗口1：</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; SUBSCRIBE baodi </span><br><span class="line"></span><br><span class="line">窗口2：</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; PUBLISH baodi &quot;jin tian zhen kaixin!&quot;</span><br><span class="line"></span><br><span class="line">订阅多频道：</span><br><span class="line">窗口1：</span><br><span class="line">127.0.0.1:6379&gt; PSUBSCRIBE wang*</span><br><span class="line">窗口2：</span><br><span class="line">127.0.0.1:6379&gt; PUBLISH wangbaoqiang &quot;jintian zhennanshou &quot;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="9-Redis事务"><a href="#9-Redis事务" class="headerlink" title="9. Redis事务"></a>9. Redis事务</h4><p><img src="/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553455959728.png" alt="155345959728"></p>
<p><img src="/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553456485956.png" alt="1553456485956"></p>
<p><img src="/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553456593470.png" alt="1553456593470"></p>
<p><img src="/2019/03/31/redis缓存技术/E:/blog-git/ljy/source/_posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B01/1553456758673.png" alt="1553456758673"></p>
<h5 id="9-1-redis和mysql事务实现的原理"><a href="#9-1-redis和mysql事务实现的原理" class="headerlink" title="9.1 redis和mysql事务实现的原理"></a>9.1 redis和mysql事务实现的原理</h5><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis的事务是基于队列实现的。<span class="comment">---queue</span></span><br><span class="line">mysql的事务是基于事务日志实现的。<span class="comment">---undo redo</span></span><br></pre></td></tr></table></figure>
<h5 id="9-2-开启事务"><a href="#9-2-开启事务" class="headerlink" title="9.2 开启事务"></a>9.2 开启事务</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.开启事务功能时（multi）</span><br><span class="line">multi </span><br><span class="line">command1      </span><br><span class="line">command2</span><br><span class="line">command3</span><br><span class="line">command4</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">4条语句作为一个组，并没有真正执行，而是被放入同一队列中。</span><br><span class="line">如果，这是执行discard，会直接丢弃队列中所有的命令，而不是做回滚。</span><br><span class="line"></span><br><span class="line">2.当执行exec时，对列中所有操作，要么全成功要么全失败</span><br><span class="line">exec</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>1.实例</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">----------</span><br><span class="line">127.0.0.1:6379&gt; set a b</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set a b</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set c d</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line"></span><br><span class="line">--------------------</span><br></pre></td></tr></table></figure>
<h5 id="9-3-redis乐观锁实现（模拟买票）"><a href="#9-3-redis乐观锁实现（模拟买票）" class="headerlink" title="9.3 redis乐观锁实现（模拟买票）"></a>9.3 redis乐观锁实现（模拟买票）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">发布一张票</span><br><span class="line">set ticket 1</span><br><span class="line"></span><br><span class="line">窗口1：</span><br><span class="line">watch ticket  # 监听其他事务是否提交</span><br><span class="line">multi</span><br><span class="line">set ticket 0       1----&gt;0</span><br><span class="line"></span><br><span class="line">窗口2：</span><br><span class="line">multi </span><br><span class="line">set ticket 0 </span><br><span class="line">exec </span><br><span class="line"></span><br><span class="line">窗口1：</span><br><span class="line">exec</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="10-服务器管理命令"><a href="#10-服务器管理命令" class="headerlink" title="10. 服务器管理命令"></a>10. 服务器管理命令</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Info</span><br><span class="line">Clinet list</span><br><span class="line">Client kill ip:port</span><br><span class="line">config <span class="builtin-name">get</span> *</span><br><span class="line">CONFIG RESETSTAT 重置统计</span><br><span class="line">CONFIG GET/<span class="builtin-name">SET</span> 动态修改</span><br><span class="line">Dbsize</span><br><span class="line">FLUSHALL 清空所有数据 </span><br><span class="line">select 1</span><br><span class="line">FLUSHDB 清空当前库</span><br><span class="line"></span><br><span class="line">MONITOR 监控实时指令</span><br><span class="line">SHUTDOWN 关闭服务器</span><br><span class="line"></span><br><span class="line">关闭数据库：</span><br><span class="line">redis-cli -a root shutdown</span><br></pre></td></tr></table></figure>
<h4 id="11-redis（master-replicaset）主从复制"><a href="#11-redis（master-replicaset）主从复制" class="headerlink" title="11. redis（master-replicaset）主从复制"></a>11. redis（master-replicaset）主从复制</h4><h5 id="11-1-原理"><a href="#11-1-原理" class="headerlink" title="11.1 原理"></a>11.1 原理</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">原理：</span><br><span class="line"><span class="number">1.</span> 从服务器向主服务器发送 SYNC 命令。</span><br><span class="line"><span class="number">2.</span> 接到 SYNC 命令的主服务器会调用BGSAVE 命令，创建一个 RDB 文件，并使用缓冲区记录接下来执行的所有写命令。</span><br><span class="line"><span class="number">3.</span> 当主服务器执行完 BGSAVE 命令时，它会向从服务器发送 RDB 文件，而从服务器则会接收并载入这个文件。</span><br><span class="line"><span class="number">4.</span> 主服务器将缓冲区储存的所有写命令（广播形式）发送给从服务器执行。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-------------</span><br><span class="line"><span class="number">1</span>、在开启主从复制的时候，使用的是RDB方式的，同步主从数据的</span><br><span class="line"><span class="number">2</span>、同步开始之后，通过主库命令传播的方式，主动的复制方式实现</span><br><span class="line"><span class="number">3</span>、<span class="number">2.8</span>以后实现PSYNC的机制，实现断线重连</span><br></pre></td></tr></table></figure>
<h5 id="11-2-主从数据一致性保证"><a href="#11-2-主从数据一致性保证" class="headerlink" title="11.2 主从数据一致性保证"></a>11.2 主从数据一致性保证</h5><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">min</span>-slaves-<span class="built_in">to</span>-<span class="built_in">write</span> <span class="number">1</span></span><br><span class="line"><span class="built_in">min</span>-slaves-<span class="built_in">max</span>-lag</span><br></pre></td></tr></table></figure>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">这个特性的运作原理：</span><br><span class="line">从服务器以每秒一次的频率<span class="built_in"> PING </span>主服务器一次， 并报告复制流的处理情况。</span><br><span class="line">主服务器会记录各个从服务器最后一次向它发送<span class="built_in"> PING </span>的时间。</span><br><span class="line"></span><br><span class="line">用户可以通过配置， 指定网络延迟的最大值 min-slaves-max-lag ，</span><br><span class="line"></span><br><span class="line">以及执行写操作所需的至少从服务器数量 min-slaves-to-write 。</span><br><span class="line"></span><br><span class="line">如果至少有 min-slaves-to-write 个从服务器， 并且这些服务器的延迟值都少于 min-slaves-max-lag秒，</span><br><span class="line"></span><br><span class="line">那么主服务器就会执行客户端请求的写操作。</span><br><span class="line"></span><br><span class="line">你可以将这个特性看作 CAP 理论中的 C 的条件放宽版本： 尽管不能保证写操作的持久性， </span><br><span class="line">但起码丢失数据的窗口会被严格限制在指定的秒数中。</span><br><span class="line"></span><br><span class="line">另一方面， 如果条件达不到 min-slaves-to-write 和 min-slaves-max-lag 所指定的条件， 那么写操作就不会被执行</span><br><span class="line">主服务器会向请求执行写操作的客户端返回一个错误。</span><br></pre></td></tr></table></figure>
<h5 id="11-3-主库是否要开启持久化？"><a href="#11-3-主库是否要开启持久化？" class="headerlink" title="11.3 主库是否要开启持久化？"></a>11.3 主库是否要开启持久化？</h5><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">如果不开有可能，主库重启操作，造成所有主从数据丢失！</span><br><span class="line"></span><br><span class="line">解决办法：</span><br><span class="line"><span class="meta">down</span>掉的主服务器，不要使用了</span><br></pre></td></tr></table></figure>
<h5 id="11-4-主从复制实现"><a href="#11-4-主从复制实现" class="headerlink" title="11.4 主从复制实现"></a>11.4 主从复制实现</h5><blockquote>
<p><strong>1.环境：准备两个或两个以上redis实例</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/638&#123;0..2&#125;</span><br><span class="line"></span><br><span class="line">配置文件示例：</span><br><span class="line">cat &gt;&gt; /data/6380/redis.conf &lt;&lt; EOF </span><br><span class="line">port 6380</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile /data/6380/redis.pid</span><br><span class="line">loglevel notice</span><br><span class="line">logfile &quot;/data/6380/redis.log&quot;</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line">dir /data/6380</span><br><span class="line">requirepass 123</span><br><span class="line">masterauth 123</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cp /data/6380/redis.conf /data/6381/redis.conf</span><br><span class="line">cp /data/6380/redis.conf /data/6382/redis.conf</span><br><span class="line"></span><br><span class="line">sed -i &apos;s#6380#6381#g&apos; /data/6381/redis.conf</span><br><span class="line">sed -i &apos;s#6380#6382#g&apos; /data/6382/redis.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">启动：</span><br><span class="line">redis-server /data/6380/redis.conf</span><br><span class="line">redis-server /data/6381/redis.conf</span><br><span class="line">redis-server /data/6382/redis.conf</span><br><span class="line"></span><br><span class="line">netstat -lnp|grep 638</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">主节点：6380</span><br><span class="line">从节点：6381、6382</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>2.开启主从</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">6381/6382命令行:</span><br><span class="line"></span><br><span class="line">redis-cli -p 6381 -a 123 SLAVEOF 127.0.0.1 6380</span><br><span class="line">redis-cli -p 6382 -a 123 SLAVEOF 127.0.0.1 6380</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>3.查询主从状态</strong></p>
</blockquote>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p <span class="number">6380</span> -a <span class="number">123</span> info replication</span><br><span class="line">redis-cli -p <span class="number">6381</span> -a <span class="number">123</span> info replication</span><br><span class="line">redis-cli -p <span class="number">6382</span> -a <span class="number">123</span> info replication</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>4.模拟主库故障: 从库切为主库</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 6380 -a 123 shutdown</span><br><span class="line"></span><br><span class="line">redis-cli -p 6381 -a 123</span><br><span class="line">info replication</span><br><span class="line">slaveof no one</span><br><span class="line"></span><br><span class="line">6382连接到6381：</span><br><span class="line">[root@db03 ~]# redis-cli -p 6382 -a 123</span><br><span class="line">127.0.0.1:6382&gt; SLAVEOF no one</span><br><span class="line">127.0.0.1:6382&gt; SLAVEOF 127.0.0.1 6381</span><br></pre></td></tr></table></figure>
<h5 id="11-5-redis-sentinel（哨兵）"><a href="#11-5-redis-sentinel（哨兵）" class="headerlink" title="11.5 redis-sentinel（哨兵）"></a>11.5 redis-sentinel（哨兵）</h5><blockquote>
<p><strong>1.作用</strong></p>
</blockquote>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、监控</span><br><span class="line"><span class="number">2</span>、自动选主，切换（<span class="number">6381</span> slaveof no one）</span><br><span class="line"><span class="number">3</span>、<span class="number">2</span>号从库（<span class="number">6382</span>）指向新主库（<span class="number">6381</span>）</span><br><span class="line"><span class="number">4</span>、应用透明</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>2.搭建</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sentinel搭建过程</span><br><span class="line"></span><br><span class="line">mkdir /data/26380</span><br><span class="line">cd /data/26380</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; sentinel.conf &lt;&lt; EOF</span><br><span class="line">port 26380</span><br><span class="line">dir &quot;/data/26380&quot;</span><br><span class="line">sentinel monitor mymaster 127.0.0.1 6380 1</span><br><span class="line">sentinel down-after-milliseconds mymaster 5000</span><br><span class="line">sentinel auth-pass mymaster 123 </span><br><span class="line">EOF</span><br><span class="line">启动：</span><br><span class="line">redis-sentinel /data/26380/sentinel.conf &amp;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>3.如果有问题</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、重新准备<span class="number">1</span>主<span class="number">2</span>从环境</span><br><span class="line"><span class="number">2</span>、kill掉sentinel进程</span><br><span class="line"><span class="number">3</span>、删除sentinel目录下的所有文件</span><br><span class="line"><span class="number">4</span>、重新搭建sentinel</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>4.停主库测试</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">停主库测试：</span><br><span class="line"></span><br><span class="line">[root@db01 ~]# redis-cli -p 6380 -a 123</span><br><span class="line">shutdown</span><br><span class="line"></span><br><span class="line">[root@db01 ~]# redis-cli -p 6381 -a 123</span><br><span class="line">info replication</span><br><span class="line"></span><br><span class="line">启动源主库（6380），看状态。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Sentinel管理命令：</span><br><span class="line"></span><br><span class="line">redis-cli -p 26380</span><br><span class="line"></span><br><span class="line">PING ：返回 PONG 。</span><br><span class="line">SENTINEL masters ：列出所有被监视的主服务器</span><br><span class="line">SENTINEL slaves &lt;master name&gt; </span><br><span class="line">SENTINEL get-master-addr-by-name &lt;master name&gt; ： 返回给定名字的主服务器的 IP 地址和端口号。 </span><br><span class="line">SENTINEL reset &lt;pattern&gt; ： 重置所有名字和给定模式 pattern 相匹配的主服务器。 </span><br><span class="line">SENTINEL failover &lt;master name&gt; ： 当主服务器失效时， 在不询问其他 Sentinel 意见的情况下， 强制开始一次自动故障迁移。</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="12-redis-cluster-集群"><a href="#12-redis-cluster-集群" class="headerlink" title="12. redis cluster(集群)"></a>12. redis cluster(集群)</h4><h5 id="12-1-高性能"><a href="#12-1-高性能" class="headerlink" title="12.1 高性能"></a>12.1 高性能</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、在多分片节点中，将<span class="number">16384</span>个槽位，均匀分布到多个分片节点中</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、存数据时，将key做crc16(key),然后和<span class="number">16384</span>进行取模，得出槽位值（<span class="number">0</span><span class="number">-16383</span>之间）</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>、根据计算得出的槽位值，找到相对应的分片节点的主节点，存储到相应槽位上</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>、如果客户端当时连接的节点不是将来要存储的分片节点，分片集群会将客户端连接切换至真正存储节点进行数据存储</span><br></pre></td></tr></table></figure>
<h5 id="12-2-高可用"><a href="#12-2-高可用" class="headerlink" title="12.2 高可用"></a>12.2 高可用</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">在搭建集群时，会为每一个分片的主节点，对应一个从节点，实现slaveof的功能，同时当主节点down，实现类似于sentinel的自动failover的功能。</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>、redis会有多组分片构成（<span class="number">3</span>组）</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、redis cluster 使用固定个数的slot存储数据（一共<span class="number">16384</span>slot）</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>、每组分片分得<span class="number">1</span>/<span class="number">3</span> slot个数（<span class="number">0</span><span class="number">-5500</span>  <span class="number">5501</span><span class="number">-11000</span>  <span class="number">11001</span><span class="number">-16383</span>）</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>、基于CRC16(key) % <span class="number">16384</span> ====》值 （槽位号）。</span><br></pre></td></tr></table></figure>
<h5 id="12-3-规划、搭建过程："><a href="#12-3-规划、搭建过程：" class="headerlink" title="12.3 规划、搭建过程："></a>12.3 规划、搭建过程：</h5><blockquote>
<p><strong>1.注意事项</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">注：</span><br><span class="line"><span class="number">1.</span>在企业规划中，一个分片的两个分到不同的物理机，防止硬件主机宕机造成的整个分片数据丢失。</span><br><span class="line"></span><br><span class="line"><span class="number">2.6</span>个redis实例，一般会放到<span class="number">3</span>台硬件服务器</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>2.安装集群插件</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">EPEL源安装ruby支持</span><br><span class="line">yum install ruby rubygems -y</span><br><span class="line"></span><br><span class="line">使用国内源</span><br><span class="line">gem sources -l</span><br><span class="line">gem sources -a http://mirrors.aliyun.com/rubygems/ </span><br><span class="line">gem sources  --remove https://rubygems.org/</span><br><span class="line">gem sources -l</span><br><span class="line">gem install redis -v 3.3.3</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>3.集群节点准备</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/700&#123;0..5&#125;</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /data/7000/redis.conf &lt;&lt; EOF</span><br><span class="line">port 7000</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile /data/7000/redis.pid</span><br><span class="line">loglevel notice</span><br><span class="line">logfile &quot;/data/7000/redis.log&quot;</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line">dir /data/7000</span><br><span class="line">protected-mode no</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">appendonly yes</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cp /data/7000/redis.conf /data/7001/redis.conf</span><br><span class="line">cp /data/7000/redis.conf /data/7002/redis.conf</span><br><span class="line">cp /data/7000/redis.conf /data/7003/redis.conf</span><br><span class="line">cp /data/7000/redis.conf /data/7004/redis.conf</span><br><span class="line">cp /data/7000/redis.conf /data/7005/redis.conf</span><br><span class="line"></span><br><span class="line">sed -i &apos;s#7000#7001#g&apos; /data/7001/redis.conf</span><br><span class="line">sed -i &apos;s#7000#7002#g&apos; /data/7002/redis.conf</span><br><span class="line">sed -i &apos;s#7000#7003#g&apos; /data/7003/redis.conf</span><br><span class="line">sed -i &apos;s#7000#7004#g&apos; /data/7004/redis.conf</span><br><span class="line">sed -i &apos;s#7000#7005#g&apos; /data/7005/redis.conf</span><br><span class="line"></span><br><span class="line">启动节点：</span><br><span class="line"></span><br><span class="line">redis-server /data/7000/redis.conf </span><br><span class="line">redis-server /data/7001/redis.conf </span><br><span class="line">redis-server /data/7002/redis.conf </span><br><span class="line">redis-server /data/7003/redis.conf </span><br><span class="line">redis-server /data/7004/redis.conf </span><br><span class="line">redis-server /data/7005/redis.conf </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@db01 ~]# ps -ef |grep redis</span><br><span class="line">root       8854      1  0 03:56 ?        00:00:00 redis-server *:7000 [cluster]     </span><br><span class="line">root       8858      1  0 03:56 ?        00:00:00 redis-server *:7001 [cluster]     </span><br><span class="line">root       8860      1  0 03:56 ?        00:00:00 redis-server *:7002 [cluster]     </span><br><span class="line">root       8864      1  0 03:56 ?        00:00:00 redis-server *:7003 [cluster]     </span><br><span class="line">root       8866      1  0 03:56 ?        00:00:00 redis-server *:7004 [cluster]     </span><br><span class="line">root       8874      1  0 03:56 ?        00:00:00 redis-server *:7005 [cluster]</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>4.将节点加入集群管理</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-trib.rb create --replicas 1 127.0.0.1:7000 127.0.0.1:7001 \</span><br><span class="line">127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>5.集群状态查看</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">集群主节点状态</span><br><span class="line">redis-cli -p 7000 cluster nodes | grep master</span><br><span class="line">集群从节点状态</span><br><span class="line">redis-cli -p 7000 cluster nodes | grep slave</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>6.集群节点管理: 增加新的节点</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#1 增加新的节点</span><br><span class="line"></span><br><span class="line">mkdir /data/7006</span><br><span class="line">mkdir /data/7007</span><br><span class="line"></span><br><span class="line">vim /data/7006/redis.conf</span><br><span class="line">port 7006</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile /data/7006/redis.pid</span><br><span class="line">loglevel notice</span><br><span class="line">logfile &quot;/data/7006/redis.log&quot;</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line">dir /data/7006</span><br><span class="line">protected-mode no</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /data/7007/redis.conf</span><br><span class="line">port 7007</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile /data/7007/redis.pid</span><br><span class="line">loglevel notice</span><br><span class="line">logfile &quot;/data/7007/redis.log&quot;</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line">dir /data/7007</span><br><span class="line">protected-mode no</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">redis-server /data/7006/redis.conf </span><br><span class="line">redis-server /data/7007/redis.conf </span><br><span class="line"></span><br><span class="line">#2 添加主节点：</span><br><span class="line">redis-trib.rb add-node 127.0.0.1:7006 127.0.0.1:7000</span><br><span class="line"></span><br><span class="line">#3 转移slot（重新分片）</span><br><span class="line">redis-trib.rb reshard 127.0.0.1:7000</span><br><span class="line"></span><br><span class="line">#4 添加一个从节点</span><br><span class="line">redis-trib.rb add-node --slave --master-id 1c98b2b2ce18f88c76821cdb82dba4defaa5eb48 127.0.0.1:7007 127.0.0.1:7000</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>7.集群节点管理: 删除一个节点</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">删除master节点之前首先要使用reshard移除master的全部slot,然后再删除当前节点</span><br><span class="line">redis-trib.rb del-node 127.0.0.1:7006 1c98b2b2ce18f88c76821cdb82dba4defaa5eb48</span><br><span class="line">redis-trib.rb del-node 127.0.0.1:7007 00185d1cf069b23468d5863202ac651f0d02a9f8</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>8.设置redis最大内存</strong></p>
</blockquote>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">config</span> <span class="built_in">set</span> maxmemory <span class="number">102400000</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="13-redis的多API支持-python为例"><a href="#13-redis的多API支持-python为例" class="headerlink" title="13. redis的多API支持:python为例"></a>13. redis的多API支持:python为例</h4><h5 id="13-1-软件驱动下载"><a href="#13-1-软件驱动下载" class="headerlink" title="13.1 软件驱动下载"></a>13.1 软件驱动下载</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">https://redis.io/clients</span><br><span class="line"></span><br><span class="line">下载redis-py-master.zip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>安装驱动redis-py-master：</span><br><span class="line"></span><br><span class="line">unzip redis-py-master.zip</span><br><span class="line"></span><br><span class="line">cd redis-py-master</span><br><span class="line">python3 setup.py install</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>安装redis-cluser的客户端程序</span><br><span class="line"></span><br><span class="line">cd redis-py-cluster-unstable</span><br><span class="line">python3 setup.py install</span><br></pre></td></tr></table></figure>
<h5 id="13-2-对redis的单实例进行连接操作"><a href="#13-2-对redis的单实例进行连接操作" class="headerlink" title="13.2  对redis的单实例进行连接操作"></a>13.2  对redis的单实例进行连接操作</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python3</span><br><span class="line">&gt;&gt;&gt;<span class="keyword">import</span> redis</span><br><span class="line">&gt;&gt;&gt;r = redis.StrictRedis(host=<span class="string">'10.0.0.100'</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>,password=<span class="string">'123'</span>)</span><br><span class="line">&gt;&gt;&gt;r.set(<span class="string">'foo'</span>, <span class="string">'bar'</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line">&gt;&gt;&gt;r.get(<span class="string">'foo'</span>)</span><br><span class="line"><span class="string">'bar'</span></span><br></pre></td></tr></table></figure>
<h5 id="13-3-sentinel集群连接并操作"><a href="#13-3-sentinel集群连接并操作" class="headerlink" title="13.3   sentinel集群连接并操作"></a>13.3   sentinel集群连接并操作</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 服务和sentinel服务开启</span><br><span class="line">[root@db01 ~]# redis-server /data/6380/redis.conf</span><br><span class="line">[root@db01 ~]# redis-server /data/6381/redis.conf</span><br><span class="line">[root@db01 ~]# redis-server /data/6382/redis.conf </span><br><span class="line">[root@db01 ~]# redis-sentinel /data/26380/sentinel.conf &amp;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 导入redis sentinel包</span></span><br><span class="line">&gt;&gt;&gt;<span class="keyword">from</span> redis.sentinel <span class="keyword">import</span> Sentinel  </span><br><span class="line"><span class="comment">##指定sentinel的地址和端口号</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sentinel = Sentinel([(<span class="string">'localhost'</span>, <span class="number">26380</span>)], socket_timeout=<span class="number">0.1</span>)  </span><br><span class="line"><span class="comment">##测试，获取以下主库和从库的信息</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sentinel.discover_master(<span class="string">'mymaster'</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sentinel.discover_slaves(<span class="string">'mymaster'</span>)  </span><br><span class="line"></span><br><span class="line"><span class="comment">##配置读写分离</span></span><br><span class="line"><span class="comment">#写节点</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>master = sentinel.master_for(<span class="string">'mymaster'</span>, socket_timeout=<span class="number">0.1</span>,password=<span class="string">"123"</span>)  </span><br><span class="line"><span class="comment">#读节点</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>slave = sentinel.slave_for(<span class="string">'mymaster'</span>, socket_timeout=<span class="number">0.1</span>,password=<span class="string">"123"</span>)  </span><br><span class="line"><span class="comment">###读写分离测试   key     </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>master.set(<span class="string">'oldboy'</span>, <span class="string">'123'</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>slave.get(<span class="string">'oldboy'</span>)  </span><br><span class="line"><span class="string">'123'</span></span><br></pre></td></tr></table></figure>
<h5 id="13-4-redis-cluster的连接并操作（python2-7-2以上版本才支持redis-cluster，我们选择的是3-5）"><a href="#13-4-redis-cluster的连接并操作（python2-7-2以上版本才支持redis-cluster，我们选择的是3-5）" class="headerlink" title="13.4  redis cluster的连接并操作（python2.7.2以上版本才支持redis cluster，我们选择的是3.5）"></a>13.4  <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0dyb2t6ZW4vcmVkaXMtcHktY2x1c3Rlcg==" title="https://github.com/Grokzen/redis-py-cluster">redis cluster的连接并操作（python2.7.2以上版本才支持redis cluster，我们选择的是3.5）<i class="fa fa-external-link"></i></span></h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">python3</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> rediscluster <span class="keyword">import</span> StrictRedisCluster  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>startup_nodes = [&#123;<span class="string">"host"</span>: <span class="string">"127.0.0.1"</span>, <span class="string">"port"</span>: <span class="string">"7000"</span>&#125;,&#123;<span class="string">"host"</span>: <span class="string">"127.0.0.1"</span>, <span class="string">"port"</span>: <span class="string">"7001"</span>&#125;,&#123;<span class="string">"host"</span>: <span class="string">"127.0.0.1"</span>, <span class="string">"port"</span>: <span class="string">"7002"</span>&#125;]  </span><br><span class="line"><span class="comment">### Note: decode_responses must be set to True when used with python3  </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rc = StrictRedisCluster(startup_nodes=startup_nodes, decode_responses=<span class="literal">True</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rc.set(<span class="string">"foo0000"</span>, <span class="string">"bar0000"</span>)  </span><br><span class="line"><span class="literal">True</span>  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(rc.get(<span class="string">"foo0000"</span>))  </span><br><span class="line"><span class="string">'bar'</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="14-redis可能会出现的问题"><a href="#14-redis可能会出现的问题" class="headerlink" title="14. redis可能会出现的问题"></a>14. redis可能会出现的问题</h4><h5 id="14-1-缓存穿透"><a href="#14-1-缓存穿透" class="headerlink" title="14.1 缓存穿透"></a>14.1 缓存穿透</h5><blockquote>
<p><strong>1.概念</strong></p>
</blockquote>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">访问一个不存在的key，缓存不起作用，请求会穿透到<span class="built_in">DB</span>，流量大时<span class="built_in">DB</span>会挂掉。</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>2.解决方案</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>采用部署过滤器，使用一个足够大的bitmap，用于存储可能访问的key，不存在的key直接被过滤；</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>访问key未在DB查询到值，也将空值写进缓存，但可以设置较短过期时间。</span><br></pre></td></tr></table></figure>
<h5 id="14-2-缓存雪崩"><a href="#14-2-缓存雪崩" class="headerlink" title="14.2 缓存雪崩"></a>14.2 缓存雪崩</h5><blockquote>
<p><strong>1.概念</strong></p>
</blockquote>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">大量的key设置了相同的过期时间，导致在缓存在同一时刻全部失效，造成瞬时<span class="built_in">DB</span>请求量大、压力骤增，引起雪崩。</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>2.解决方案</strong></p>
</blockquote>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">可以给缓存设置过期时间时加上一个随机值时间，使得每个<span class="built_in">key</span>的过期时间分布开来，不会集中在同一时刻失效。</span><br></pre></td></tr></table></figure>
<h5 id="14-3-缓存击穿"><a href="#14-3-缓存击穿" class="headerlink" title="14.3 缓存击穿"></a>14.3 缓存击穿</h5><blockquote>
<p><strong>1.概念</strong></p>
</blockquote>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在访问key之前，在缓存过期的一刻，同时有大量的请求，这些请求都会击穿到<span class="built_in">DB</span>，造成瞬时<span class="built_in">DB</span>请求量大、压力骤增。</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>2.解决方案</strong></p>
</blockquote>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在访<span class="built_in">问key</span>之前，采用SETNX（set <span class="keyword">if</span><span class="built_in"> not</span><span class="built_in"> exists</span>）来设置另一个短<span class="built_in">期key</span>来锁住当<span class="built_in">前key</span>的访问，访问结束再删除该短<span class="built_in">期key</span>。</span><br></pre></td></tr></table></figure>

      
    </div>

    

    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center;">
  <img id="wechat_subscriber_qcode" src="/images/gongzhonghao.jpg" alt="李江洋 wechat" style="width: 200px; max-width: 100%;">
  <div>python分享公众号</div>
</div>

      </div>
    

    
      
    
    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById(&quot;QR&quot;); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="李江洋 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="李江洋 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/redis/" rel="tag"># redis</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/03/31/mysql多实例/" rel="next" title="mysql多实例">
                <i class="fa fa-chevron-left"></i> mysql多实例
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/03/31/mysql数据库管理/" rel="prev" title="mysql数据库管理">
                mysql数据库管理 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="李江洋">
            
              <p class="site-author-name" itemprop="name">李江洋</p>
              <p class="site-description motion-element" itemprop="description">记录学习的技能和遇到的问题</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">179</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">41</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lvdXJuYW1l" title="GitHub &rarr; https://github.com/yourname"><i class="fa fa-fw fa-github"></i>GitHub</span>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <span class="exturl" data-url="bWFpbHRvOjEzMjgwNDQzOTJAcXEuY29t" title="E-Mail &rarr; mailto:1328044392@qq.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</span>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <span class="exturl" data-url="aHR0cDovL2V4YW1wbGUuY29t" title="http://example.com">Title</span>
                  </li>
                
              </ul>
            </div>
          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis缓存技术"><span class="nav-number">1.</span> <span class="nav-text">Redis缓存技术</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-NoSQL产品"><span class="nav-number">1.0.0.1.</span> <span class="nav-text">1. NoSQL产品</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-redis面试常问问题：功能介绍"><span class="nav-number">1.0.0.2.</span> <span class="nav-text">2. redis面试常问问题：功能介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-企业缓存产品介绍"><span class="nav-number">1.0.0.3.</span> <span class="nav-text">3. 企业缓存产品介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-1-memcached"><span class="nav-number">1.0.0.3.1.</span> <span class="nav-text">3.1 memcached</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-redis"><span class="nav-number">1.0.0.3.2.</span> <span class="nav-text">3.2 redis</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-memcache与redis在读写性能的对比"><span class="nav-number">1.0.0.3.3.</span> <span class="nav-text">3.3 memcache与redis在读写性能的对比</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-4-Redis使用场景介绍"><span class="nav-number">1.0.0.3.4.</span> <span class="nav-text">3.4 Redis使用场景介绍</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-Redis安装部署"><span class="nav-number">1.0.0.4.</span> <span class="nav-text">4. Redis安装部署</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-Redis基本管理操作"><span class="nav-number">1.0.0.5.</span> <span class="nav-text">5. Redis基本管理操作</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-基础配置文件介绍"><span class="nav-number">1.0.0.5.1.</span> <span class="nav-text">5.1 基础配置文件介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-配置文件说明"><span class="nav-number">1.0.0.5.2.</span> <span class="nav-text">5.2 配置文件说明</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-3-redis-cli-客户端命令常用参数说明"><span class="nav-number">1.0.0.5.3.</span> <span class="nav-text">5.3 redis-cli 客户端命令常用参数说明</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-4-redis安全配置-指定IP-设置验证密码"><span class="nav-number">1.0.0.5.4.</span> <span class="nav-text">5.4 redis安全配置:指定IP/设置验证密码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-5-在线查看和修改配置"><span class="nav-number">1.0.0.5.5.</span> <span class="nav-text">5.5 在线查看和修改配置</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-redis持久化（内存数据保存到磁盘）"><span class="nav-number">1.0.0.6.</span> <span class="nav-text">6. redis持久化（内存数据保存到磁盘）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#6-1-作用"><span class="nav-number">1.0.0.6.1.</span> <span class="nav-text">6.1 作用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-2-RDB-持久化"><span class="nav-number">1.0.0.6.2.</span> <span class="nav-text">6.2 RDB 持久化</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-3-AOF-持久化-append-only-log-file"><span class="nav-number">1.0.0.6.3.</span> <span class="nav-text">6.3 AOF 持久化(append-only log file)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-4-redis-持久化方式有哪些？有什么区别？"><span class="nav-number">1.0.0.6.4.</span> <span class="nav-text">6.4 redis 持久化方式有哪些？有什么区别？</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-Redis数据类型-笔试"><span class="nav-number">1.0.0.7.</span> <span class="nav-text">7. Redis数据类型(笔试)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#7-1-介绍"><span class="nav-number">1.0.0.7.1.</span> <span class="nav-text">7.1 介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-2-键的通用操作"><span class="nav-number">1.0.0.7.2.</span> <span class="nav-text">7.2 键的通用操作</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-3-string类型的应用场景"><span class="nav-number">1.0.0.7.3.</span> <span class="nav-text">7.3 string类型的应用场景</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-4-hash类型的应用场景"><span class="nav-number">1.0.0.7.4.</span> <span class="nav-text">7.4 hash类型的应用场景</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-5-list列表的应用场景"><span class="nav-number">1.0.0.7.5.</span> <span class="nav-text">7.5 list列表的应用场景</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-6-SET-集合类型（类似于mysql中的join）应用场景"><span class="nav-number">1.0.0.7.6.</span> <span class="nav-text">7.6 SET 集合类型（类似于mysql中的join）应用场景</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-7-SortedSet（有序集合）应用场景"><span class="nav-number">1.0.0.7.7.</span> <span class="nav-text">7.7 SortedSet（有序集合）应用场景</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-redis的发布订阅"><span class="nav-number">1.0.0.8.</span> <span class="nav-text">8. redis的发布订阅</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#8-1-发布订阅系统的相关指令"><span class="nav-number">1.0.0.8.1.</span> <span class="nav-text">8.1 发布订阅系统的相关指令</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-2-实例"><span class="nav-number">1.0.0.8.2.</span> <span class="nav-text">8.2 实例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-Redis事务"><span class="nav-number">1.0.0.9.</span> <span class="nav-text">9. Redis事务</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#9-1-redis和mysql事务实现的原理"><span class="nav-number">1.0.0.9.1.</span> <span class="nav-text">9.1 redis和mysql事务实现的原理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-2-开启事务"><span class="nav-number">1.0.0.9.2.</span> <span class="nav-text">9.2 开启事务</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-3-redis乐观锁实现（模拟买票）"><span class="nav-number">1.0.0.9.3.</span> <span class="nav-text">9.3 redis乐观锁实现（模拟买票）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-服务器管理命令"><span class="nav-number">1.0.0.10.</span> <span class="nav-text">10. 服务器管理命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-redis（master-replicaset）主从复制"><span class="nav-number">1.0.0.11.</span> <span class="nav-text">11. redis（master-replicaset）主从复制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#11-1-原理"><span class="nav-number">1.0.0.11.1.</span> <span class="nav-text">11.1 原理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#11-2-主从数据一致性保证"><span class="nav-number">1.0.0.11.2.</span> <span class="nav-text">11.2 主从数据一致性保证</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#11-3-主库是否要开启持久化？"><span class="nav-number">1.0.0.11.3.</span> <span class="nav-text">11.3 主库是否要开启持久化？</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#11-4-主从复制实现"><span class="nav-number">1.0.0.11.4.</span> <span class="nav-text">11.4 主从复制实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#11-5-redis-sentinel（哨兵）"><span class="nav-number">1.0.0.11.5.</span> <span class="nav-text">11.5 redis-sentinel（哨兵）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#12-redis-cluster-集群"><span class="nav-number">1.0.0.12.</span> <span class="nav-text">12. redis cluster(集群)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#12-1-高性能"><span class="nav-number">1.0.0.12.1.</span> <span class="nav-text">12.1 高性能</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#12-2-高可用"><span class="nav-number">1.0.0.12.2.</span> <span class="nav-text">12.2 高可用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#12-3-规划、搭建过程："><span class="nav-number">1.0.0.12.3.</span> <span class="nav-text">12.3 规划、搭建过程：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#13-redis的多API支持-python为例"><span class="nav-number">1.0.0.13.</span> <span class="nav-text">13. redis的多API支持:python为例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#13-1-软件驱动下载"><span class="nav-number">1.0.0.13.1.</span> <span class="nav-text">13.1 软件驱动下载</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#13-2-对redis的单实例进行连接操作"><span class="nav-number">1.0.0.13.2.</span> <span class="nav-text">13.2  对redis的单实例进行连接操作</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#13-3-sentinel集群连接并操作"><span class="nav-number">1.0.0.13.3.</span> <span class="nav-text">13.3   sentinel集群连接并操作</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#13-4-redis-cluster的连接并操作（python2-7-2以上版本才支持redis-cluster，我们选择的是3-5）"><span class="nav-number">1.0.0.13.4.</span> <span class="nav-text">13.4  redis cluster的连接并操作（python2.7.2以上版本才支持redis cluster，我们选择的是3.5）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#14-redis可能会出现的问题"><span class="nav-number">1.0.0.14.</span> <span class="nav-text">14. redis可能会出现的问题</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#14-1-缓存穿透"><span class="nav-number">1.0.0.14.1.</span> <span class="nav-text">14.1 缓存穿透</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#14-2-缓存雪崩"><span class="nav-number">1.0.0.14.2.</span> <span class="nav-text">14.2 缓存雪崩</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#14-3-缓存击穿"><span class="nav-number">1.0.0.14.3.</span> <span class="nav-text">14.3 缓存击穿</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2025</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">李江洋</span>

  

  
</div>


  <div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <span class="exturl theme-link" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZw==">NexT.Pisces</span> v7.0.1</div>






  <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/7.1.2/mermaid.min.js"></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({theme: 'forest'});
    }
  </script>


        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>






















  
  
  <script id="ribbon" size="300" alpha="0.6" zindex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>





  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.1"></script>


  
  
  
  <script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script>


<script>
  var disqus_config = function() {
    this.page.url = "https://ljyabc.github.io/2019/03/31/redis缓存技术/";
    this.page.identifier = "2019/03/31/redis缓存技术/";
    this.page.title = 'redis缓存技术';
    };
  function loadComments() {
    var d = document, s = d.createElement('script');
    s.src = 'https://.disqus.com/embed.js';
    s.setAttribute('data-timestamp', '' + +new Date());
    (d.head || d.body).appendChild(s);
  }
  
    loadComments();
  
</script>





  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  
  <script src="/js/src/exturl.js?v=7.0.1"></script>


  

  

   <!-- 代码块复制功能 -->
  <script type="text/javascript" src="/js/src/clipboard.min.js"></script>  
  <script type="text/javascript" src="/js/src/clipboard-use.js"></script>
</body>
</html>
