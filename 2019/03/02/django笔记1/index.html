<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false,"dimmer":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="django框架1 基于wsgiref定义自己的web框架.note  0 基于socket手写web框架.note  day011.web应用 web应用：  123web应用：是一种可以通过web访问的应用程序，最大的好处就是用户可以很容易访问应用程序，用户只需要在浏览器中打开网页，不需要安装其他软件。cs架构web应用：大部分是基于b/s架构的程序。  web应用的优点 123451.只需要">
<meta name="keywords" content="python框架">
<meta property="og:type" content="article">
<meta property="og:title" content="django笔记1">
<meta property="og:url" content="https://ljyabc.github.io/2019/03/02/django笔记1/index.html">
<meta property="og:site_name" content="择墅居:李江洋">
<meta property="og:description" content="django框架1 基于wsgiref定义自己的web框架.note  0 基于socket手写web框架.note  day011.web应用 web应用：  123web应用：是一种可以通过web访问的应用程序，最大的好处就是用户可以很容易访问应用程序，用户只需要在浏览器中打开网页，不需要安装其他软件。cs架构web应用：大部分是基于b/s架构的程序。  web应用的优点 123451.只需要">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipboard.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipboard1.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipboard2.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/01.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/2.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/ard.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/rd.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/cliboard.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/aclipboard.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipbossard.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipb1oard.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipb2oard.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipbo4ard.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipboard02.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipboard03.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipboard04.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipboard05.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipboard06.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipboard07.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipboard08.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipboard09.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipboard10.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipboard11.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipboard12.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipboard13.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipboard14.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipboard15.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/C:/Users/aaa/AppData/Local/Temp/1552228994449.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552229746713.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552231144528.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552233166530.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1555849029706.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552234194253.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552234212442.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552488359923.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552488778206.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552489301361.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552489506222.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552489924936.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552490963768.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552492082082.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552492635768.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552153143351.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552153361848.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552153728832.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552153847052.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552154157269.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552154010685.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552154293200.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552154436732.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552156641791.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552156970809.png">
<meta property="og:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/1552157199316.png">
<meta property="og:updated_time" content="2025-04-08T14:37:21.767Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="django笔记1">
<meta name="twitter:description" content="django框架1 基于wsgiref定义自己的web框架.note  0 基于socket手写web框架.note  day011.web应用 web应用：  123web应用：是一种可以通过web访问的应用程序，最大的好处就是用户可以很容易访问应用程序，用户只需要在浏览器中打开网页，不需要安装其他软件。cs架构web应用：大部分是基于b/s架构的程序。  web应用的优点 123451.只需要">
<meta name="twitter:image" content="https://ljyabc.github.io/2019/03/02/django笔记1/clipboard.png">






  <link rel="canonical" href="https://ljyabc.github.io/2019/03/02/django笔记1/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>django笔记1 | 择墅居:李江洋</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">择墅居:李江洋</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">争做长沙别墅豪装第一品牌</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-schedule">

    
    
    
      
    

    

    <a href="/schedule/" rel="section"><i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>日程表</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-sitemap">

    
    
    
      
    

    

    <a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>站点地图</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-commonweal">

    
    
    
      
    

    

    <a href="/404/" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>公益 404</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-book">

    
    
    
      
    

    

    <a href="/book" rel="section"><i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>book</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ljyabc.github.io/2019/03/02/django笔记1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="李江洋">
      <meta itemprop="description" content="记录学习的技能和遇到的问题">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="择墅居:李江洋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">django笔记1

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-03-02 21:21:50" itemprop="dateCreated datePublished" datetime="2019-03-02T21:21:50+08:00">2019-03-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2025-04-08 22:37:21" itemprop="dateModified" datetime="2025-04-08T22:37:21+08:00">2025-04-08</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/python入门到放弃系列/" itemprop="url" rel="index"><span itemprop="name">python入门到放弃系列</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/03/02/django笔记1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/03/02/django笔记1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="django框架"><a href="#django框架" class="headerlink" title="django框架"></a>django框架</h2><p><span class="exturl" data-url="bm90ZTovLzQ2Q0IzQTMzODYyNTQyMkRCNjcwQzI3QjkwRTA3NUM5" title="note://46CB3A338625422DB670C27B90E075C9">1 基于wsgiref定义自己的web框架.note<i class="fa fa-external-link"></i></span> </p>
<p><span class="exturl" data-url="bm90ZTovLzk4RTQ1REJDNDFBNDRFNDE5Q0M2MDFEQjVDRjhDODlD" title="note://98E45DBC41A44E419CC601DB5CF8C89C">0 基于socket手写web框架.note<i class="fa fa-external-link"></i></span> </p>
<h3 id="day01"><a href="#day01" class="headerlink" title="day01"></a>day01</h3><h4 id="1-web应用"><a href="#1-web应用" class="headerlink" title="1.web应用"></a>1.web应用</h4><ul>
<li><p>web应用：</p>
 <figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">web应用：是一种可以通过web访问的应用程序，最大的好处就是用户可以很容易访问应用程序，用户只需要在浏览器中打开网页，不需要安装其他软件。</span><br><span class="line"><span class="keyword">cs</span>架构</span><br><span class="line">web应用：大部分是基于b/s架构的程序。</span><br></pre></td></tr></table></figure>
</li>
<li><p>web应用的优点</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>只需要一个浏览器即可。</span><br><span class="line"><span class="number">2.</span>网络应用程序通常耗费很少的用户硬盘空间。</span><br><span class="line"><span class="number">3.</span>不需要更新，所有的特性都是在服务器上执行，从而自动传达给用户端</span><br><span class="line"><span class="number">4.</span>和服务器端的网络产品很容易结合，如email功能和搜索功能</span><br><span class="line"><span class="number">5.</span>因为在网络浏览器窗口中运行，所以大部分情况下可以跨平台使用</span><br></pre></td></tr></table></figure>
</li>
<li><p>web应用的缺点</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>特别强调浏览器的适用性</span><br><span class="line"><span class="number">2.</span>如果连接出现问题，应用将不能访问</span><br><span class="line"><span class="number">3.</span>不能针对用户定制化，个性化</span><br><span class="line"><span class="number">4.</span>理论上可以检索任何用户的行为，这可能带来隐私安全问题</span><br></pre></td></tr></table></figure>
</li>
<li><p>总结</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">本质上：浏览器是一个<span class="built_in">socket</span>客户端，服务器是一个<span class="built_in">socket</span>服务端</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-http协议"><a href="#2-http协议" class="headerlink" title="2.http协议"></a>2.http协议</h4><ul>
<li><p>什么是http协议</p>
</li>
<li><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>协议是超文本传输协议</span><br><span class="line">是一个属于应用层的面向对像的协议</span><br><span class="line">浏览器作为<span class="keyword">http</span>的客户端，通过url向及web服务器发送所有请求，web服务器收到请求后，向客户端发送响应消息</span><br></pre></td></tr></table></figure>
<p>http协议的特性</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>基于tcp（传输层）/ip（网络层）协议之上的应用层协议</span><br><span class="line"><span class="number">2.</span>基于请求，响应模式</span><br><span class="line">	协议规定：请求从客户端发出，最后服务器端响应请求并返回</span><br><span class="line"><span class="number">3.</span>无状态保存：<span class="keyword">http</span>协议自身不对请求和响应之间通信状态进行保存，也就是说<span class="keyword">http</span>协议对于请求和发送不做持久化处理</span><br><span class="line">注意：</span><br><span class="line">	由于<span class="keyword">http</span>无状态保存，所以为了持久化处理，引入了cookie技术，有了cookie再用<span class="keyword">http</span>协议通信，就可以管理状态了。</span><br><span class="line"><span class="number">4.</span>无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户请求，并受到客户的应答后，即断开连接。采用这种方式可以节省传输时间。</span><br></pre></td></tr></table></figure>
</li>
<li><p>http请求协议与响应协议</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">http请求协议：</span><br><span class="line">请求首行：</span><br><span class="line"><span class="keyword">post</span>(请求方式：<span class="keyword">POST</span>/GET) /<span class="keyword">form</span>/index HTTP/1.1</span><br><span class="line">请求首部字段(请求头):</span><br><span class="line">Host：127.0.0.1</span><br><span class="line">Connection:<span class="keyword">keep</span>-alive</span><br><span class="line">Content-<span class="keyword">Type</span>:application/x-www-<span class="keyword">form</span>-urlencoded</span><br><span class="line">Content-Length:16</span><br><span class="line">请求体：</span><br><span class="line">name = ueno&amp;age = 33</span><br></pre></td></tr></table></figure>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">请求方式：get与post请求</span><br><span class="line"><span class="number">1.</span>GET提交的数据会放在url之后，以？分割url和传输数据，参数之间以&amp;相连，如?name = test1&amp;id = <span class="number">1</span>。</span><br><span class="line">POST方法是把提交的数据放在http包的请求体中。</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>GET提交的数据大小有限制（因为浏览器的url的长度有限制），而POST方法提交的数据没有限制。</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>GET与POST请求在服务端获取请求数据方式不同</span><br></pre></td></tr></table></figure>
</li>
<li><p>响应协议</p>
</li>
<li><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">状态行：协议版本 状态码 状态码描述 </span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line"></span><br><span class="line">响应头部：</span><br><span class="line">头部字段名：值 \r\n</span><br><span class="line"></span><br><span class="line">响应正文：</span><br></pre></td></tr></table></figure>
<p>响应状态码</p>
<p>| 状态码 | 类别             | 原因短语                   |<br>| —— | —————- | ————————– |<br>| 1xx    | 信息性状态码     | 接受的请求正在处理         |<br>| 2xx    | 成功状态码       | 请求正常处理完毕           |<br>| 3xx    | 重定向状态码     | 需要进行附近操作以完成请求 |<br>| 4xx    | 客户端错误状态码 | 服务器无法将处理请求       |<br>| 5xx    | 服务器错误状态码 | 服务器处理请求出错         |</p>
</li>
<li><p>url简介</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">统一资源定位符是对可以从互联网上得到的资源的位置和访问方法的一种简洁的表示，是互联网上标准支援你的地址。互联网上标准资源的地址，互联网上的每个文件都有一个唯一的url，它包含的信息支出文件的位置以及浏览器应该怎么处理它</span><br><span class="line"></span><br><span class="line">格式：</span><br><span class="line">协议：/<span class="regexp">/ip:端口(80) /</span>路径?name=lqz<span class="variable">$age</span>=age=<span class="number">18</span></span><br><span class="line"></span><br><span class="line">?之前的是请求路径，？之后的是请求数据部分</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="3-python中的web主流的框架-MVC"><a href="#3-python中的web主流的框架-MVC" class="headerlink" title="3.python中的web主流的框架(MVC)"></a>3.python中的web主流的框架(MVC)</h4><p><img src="/2019/03/02/django笔记1/clipboard.png" alt="clipboard"></p>
<p><img src="/2019/03/02/django笔记1/clipboard1.png" alt="clipboard1"></p>
<p><img src="/2019/03/02/django笔记1/clipboard2.png" alt="clipboard2"></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a：socket <span class="string">b:</span>路由和视图匹配关系 <span class="string">c:</span>模板渲染</span><br><span class="line"></span><br><span class="line"><span class="string">django:</span> a：用了wsgiref b：自己 <span class="string">c:</span>自己</span><br><span class="line"><span class="string">flask:</span> <span class="string">a:</span>用了别人的 b：自己 <span class="string">c:</span>jinja2</span><br><span class="line">tornado：a：自己 <span class="string">b:</span>自己 <span class="string">c:</span>自己</span><br></pre></td></tr></table></figure>
<p><img src="/2019/03/02/django笔记1/01.png" alt="img"> </p>
<p><img src="/2019/03/02/django笔记1/2.png" alt="img"> </p>
<p><img src="/2019/03/02/django笔记1/ard.png" alt="img"> </p>
<p><img src="/2019/03/02/django笔记1/rd.png" alt="img"> </p>
<p><img src="/2019/03/02/django笔记1/cliboard.png" alt="img"> </p>
<p><img src="/2019/03/02/django笔记1/aclipboard.png" alt="img"> </p>
<p><img src="/2019/03/02/django笔记1/clipbossard.png" alt="img"> </p>
<h3 id="6-内容总结"><a href="#6-内容总结" class="headerlink" title="6 内容总结"></a>6 内容总结</h3><p>6 内容总结</p>
<p><img src="/2019/03/02/django笔记1/clipb1oard.png" alt="img"></p>
<p><img src="/2019/03/02/django笔记1/clipb2oard.png" alt="img"></p>
<p><img src="/2019/03/02/django笔记1/clipbo4ard.png" alt="img"></p>
<p>django安装</p>
<p>1.几大部分</p>
<p><img src="/2019/03/02/django笔记1/clipboard02.png" alt="img"></p>
<p><img src="/2019/03/02/django笔记1/clipboard03.png" alt="ig"></p>
<p><img src="/2019/03/02/django笔记1/clipboard04.png" alt="img"></p>
<p><img src="/2019/03/02/django笔记1/clipboard05.png" alt="img"></p>
<p><img src="/2019/03/02/django笔记1/clipboard06.png" alt="img"></p>
<p><img src="/2019/03/02/django笔记1/clipboard07.png" alt="img"></p>
<p>可以有多个APP</p>
<p><img src="/2019/03/02/django笔记1/clipboard08.png" alt="img"></p>
<p><img src="/2019/03/02/django笔记1/clipboard09.png" alt="img"></p>
<p><img src="/2019/03/02/django笔记1/clipboard10.png" alt="ig"></p>
<p>注意事项</p>
<p><img src="/2019/03/02/django笔记1/clipboard11.png" alt="ig"></p>
<p><img src="/2019/03/02/django笔记1/clipboard12.png" alt="ig"></p>
<p>命令运行django</p>
<p><img src="/2019/03/02/django笔记1/clipboard13.png" alt="mg"></p>
<p><img src="/2019/03/02/django笔记1/clipboard14.png" alt="mg"></p>
<p><img src="/2019/03/02/django笔记1/clipboard15.png" alt="ig"></p>
<ul>
<li><p>django安装</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">下载django</span></span><br><span class="line"><span class="number">1.</span><span class="string">pip</span> <span class="string">install</span> <span class="string">django==1.11.9</span> </span><br><span class="line"></span><br><span class="line"><span class="string">创建项目</span></span><br><span class="line"><span class="number">2.</span><span class="string">django-admin</span> <span class="string">startproject</span> <span class="string">项目名</span> </span><br><span class="line"></span><br><span class="line"><span class="string">创建app</span></span><br><span class="line"><span class="number">3.</span><span class="string">python</span> <span class="string">manage.py</span> <span class="string">startapp</span> <span class="string">app01</span></span><br><span class="line"></span><br><span class="line"><span class="string">运行项目</span></span><br><span class="line"><span class="number">4.</span><span class="string">python</span> <span class="string">mansge.py</span> <span class="string">runserver</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8001</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>django文件目录</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">manage.py   项目的入口，执行一些命令</span><br><span class="line">settings    全局配置信息</span><br><span class="line">urls        总路由，请求地址和视图函数的映射关系</span><br><span class="line">migrations  数据库迁移的记录</span><br><span class="line">models      数据库表模型</span><br><span class="line">views       视图函数</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="day02"><a href="#day02" class="headerlink" title="day02"></a>day02</h3><h4 id="1-django中的app的概念"><a href="#1-django中的app的概念" class="headerlink" title="1.django中的app的概念"></a>1.django中的app的概念</h4><figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">大学：项目</span><br><span class="line">信息学院：app01</span><br><span class="line">物理学院：app02</span><br><span class="line">注意：创建了app，要在配置文件中注册</span><br><span class="line"><span class="type">INSTALLED_APPS</span> = [</span><br><span class="line">    <span class="symbol">'django</span>.contrib.admin',</span><br><span class="line">    <span class="symbol">'django</span>.contrib.auth',</span><br><span class="line">    <span class="symbol">'django</span>.contrib.contenttypes',</span><br><span class="line">    <span class="symbol">'django</span>.contrib.sessions',</span><br><span class="line">    <span class="symbol">'django</span>.contrib.messages',</span><br><span class="line">    <span class="symbol">'django</span>.contrib.staticfiles',</span><br><span class="line">    <span class="symbol">'app01</span>.apps.<span class="type">App01Config'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="2-模板路径配置"><a href="#2-模板路径配置" class="headerlink" title="2.模板路径配置"></a>2.模板路径配置</h4><figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>templates文件夹</span><br><span class="line"><span class="number">2.</span>settings里注册一下</span><br><span class="line"><span class="type">TEMPLATES</span> = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="symbol">'BACKEND'</span>: <span class="symbol">'django</span>.template.backends.django.<span class="type">DjangoTemplates'</span>,</span><br><span class="line">        <span class="symbol">'DIRS'</span>: [os.path.join(<span class="type">BASE_DIR</span>, <span class="symbol">'templates'</span>)]</span><br><span class="line">        ,</span><br><span class="line">        <span class="symbol">'APP_DIRS'</span>: <span class="type">True</span>,</span><br><span class="line">        <span class="symbol">'OPTIONS'</span>: &#123;</span><br><span class="line">            <span class="symbol">'context_processors'</span>: [</span><br><span class="line">                <span class="symbol">'django</span>.template.context_processors.debug',</span><br><span class="line">                <span class="symbol">'django</span>.template.context_processors.request',</span><br><span class="line">                <span class="symbol">'django</span>.contrib.auth.context_processors.auth',</span><br><span class="line">                <span class="symbol">'django</span>.contrib.messages.context_processors.messages',</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="3-静态文件配置"><a href="#3-静态文件配置" class="headerlink" title="3.静态文件配置"></a>3.静态文件配置</h4><p><img src="/2019/03/02/django笔记1/C:/Users\aaa\AppData\Local\Temp\1552228994449.png" alt="1552228994449"></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="selector-class">.STATIC_URL</span> = <span class="string">'/static'</span>  一般不要改</span><br><span class="line"><span class="number">2</span>.创建一个static文件夹       一般不要改</span><br><span class="line"><span class="number">3</span><span class="selector-class">.STATICFILES_DIRS</span> = [</span><br><span class="line">    os<span class="selector-class">.path</span>.join(BASE_DIR,<span class="string">'static'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="4-完整版登录功能"><a href="#4-完整版登录功能" class="headerlink" title="4.完整版登录功能"></a>4.完整版登录功能</h4><ul>
<li><h5 id="templates（模板）"><a href="#templates（模板）" class="headerlink" title="templates（模板）"></a>templates（模板）</h5><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.login.html</span><br><span class="line">	<span class="number">1.1</span> action:提交到后台的地址三种写法：</span><br><span class="line">        http:<span class="comment">//127.0.0.1:8000/login</span></span><br><span class="line">        /login/</span><br><span class="line">        不写</span><br><span class="line">	<span class="number">1.2</span> <span class="function"><span class="keyword">method</span> <span class="title">post</span>方式</span></span><br><span class="line"><span class="function">	1.3 <span class="title">input</span> <span class="title">type</span>="<span class="title">submit</span>" <span class="title">value</span>= "提交" 或 <span class="title">button</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><h6 id="views（视图层）"><a href="#views（视图层）" class="headerlink" title="views（视图层）"></a>views（视图层）</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>request.method  前台提交过来请求的方式POST/GET</span><br><span class="line"><span class="number">2.</span>request.POST(相当于字典) post形式提交过来的数据</span><br><span class="line"><span class="number">3.</span>request.POST.get(<span class="string">'name'</span>) 通过key取值，取出列表的最后一个值</span><br><span class="line"><span class="number">4.</span>request.POST.getlist(<span class="string">'name'</span>) 通过key取出列表的所有元素</span><br><span class="line"></span><br><span class="line">注意：前台GET方式提交的数据，从request.GET字典中取值</span><br></pre></td></tr></table></figure>
</li>
<li><p>连接数据库(防止sql注入，推荐以下写法)</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cur.execute('<span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> name=%s <span class="keyword">and</span> <span class="keyword">password</span>=%s<span class="string">',[name,pwd])</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="5-GET请求和POST请求"><a href="#5-GET请求和POST请求" class="headerlink" title="5.GET请求和POST请求"></a>5.GET请求和POST请求</h4><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">get</span>：获取数据，页面，携带数据是不重要的数据（数据量有大小限制）</span><br><span class="line"></span><br><span class="line"><span class="built_in">post</span>：往后台提交数据，没有长度限制</span><br></pre></td></tr></table></figure>
<h4 id="6-新手三件套总结"><a href="#6-新手三件套总结" class="headerlink" title="6.新手三件套总结"></a>6.新手三件套总结</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="selector-class">.render</span> 返回页面，默认会templates里找，注意路径</span><br><span class="line">book_list = models<span class="selector-class">.BookList</span><span class="selector-class">.objects</span>.values()</span><br><span class="line">    return render(request, <span class="string">'select.html'</span>, &#123;<span class="string">'book_list'</span>: book_list&#125;)</span><br><span class="line">    </span><br><span class="line"><span class="number">2</span><span class="selector-class">.redirect</span> 重定向</span><br><span class="line">return redirect(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">3</span><span class="selector-class">.HttpResponse</span> 返回的是HttpResponse的对象</span><br></pre></td></tr></table></figure>
<h4 id="7-pycharm连接数据库"><a href="#7-pycharm连接数据库" class="headerlink" title="7.pycharm连接数据库"></a>7.pycharm连接数据库</h4><p><img src="/2019/03/02/django笔记1/1552229746713.png" alt="1552229746713"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">参靠视频</span><br></pre></td></tr></table></figure>
<h4 id="8-orm介绍"><a href="#8-orm介绍" class="headerlink" title="8.orm介绍"></a>8.orm介绍</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span><span class="string">orm即object</span> <span class="string">relational</span> <span class="string">mapping</span> <span class="string">，对象关系映射</span></span><br><span class="line"><span class="string">优点：</span></span><br><span class="line">	<span class="string">不用写sql语句</span></span><br><span class="line">	<span class="string">开发效率高</span></span><br><span class="line"><span class="string">缺点：</span></span><br><span class="line">	<span class="string">可能sql效率低</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span><span class="string">.如何使用</span></span><br><span class="line">	<span class="string">如果连接mysql，在setting里配置</span></span><br><span class="line">	<span class="string">DATABASES</span> <span class="string">=</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">'default':</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="attr">'ENGINE':</span> <span class="string">'django.db.backends.mysql'</span><span class="string">,</span></span><br><span class="line">        <span class="attr">'HOST':</span> <span class="string">'127.0.0.1'</span><span class="string">,</span></span><br><span class="line">        <span class="attr">'PORT':</span> <span class="number">3306</span><span class="string">,</span></span><br><span class="line">        <span class="attr">'USER':</span> <span class="string">'root'</span><span class="string">,</span></span><br><span class="line">        <span class="attr">'PASSWORD':</span> <span class="string">'123'</span><span class="string">,</span></span><br><span class="line">        <span class="attr">'NAME':</span> <span class="string">'homework'</span><span class="string">,</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span><span class="string">django-orm</span></span><br><span class="line">	<span class="number">3.1</span> <span class="string">不能创建数据库（需要手动创建数据库）</span></span><br><span class="line">	<span class="number">3.2</span> <span class="string">可以创建数据表</span></span><br><span class="line">	<span class="number">3.3</span> <span class="string">可以创建字段</span></span><br><span class="line">	</span><br><span class="line"><span class="number">4</span><span class="string">.数据库迁移</span></span><br><span class="line">	<span class="number">4.1</span> <span class="string">python</span> <span class="string">manage.py</span> <span class="string">makemigrations</span></span><br><span class="line">	<span class="number">4.2</span> <span class="string">python</span> <span class="string">manage.py</span> <span class="string">migrate</span></span><br></pre></td></tr></table></figure>
<p><img src="/2019/03/02/django笔记1/1552231144528.png" alt="1552231144528"></p>
<p>9.orm创建表</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class BookList(models.Model):</span><br><span class="line">    id = models.AutoField(<span class="attribute">primary_key</span>=<span class="literal">True</span>)</span><br><span class="line">    name = models.CharField(<span class="attribute">max_length</span>=32)</span><br><span class="line">    price = models.CharField(<span class="attribute">max_length</span>=32)</span><br><span class="line">    author = models.CharField(<span class="attribute">max_length</span>=32)</span><br><span class="line">    publish = models.CharField(<span class="attribute">max_length</span>=32)</span><br></pre></td></tr></table></figure>
<h3 id="day3"><a href="#day3" class="headerlink" title="day3"></a>day3</h3><h4 id="一-orm操作表，记录"><a href="#一-orm操作表，记录" class="headerlink" title="一.orm操作表，记录"></a>一.orm操作表，记录</h4><h4 id="1-orm增加字段-table操作"><a href="#1-orm增加字段-table操作" class="headerlink" title="1.orm增加字段(table操作)"></a>1.orm增加字段(table操作)</h4><p>方法一</p>
<p><img src="/2019/03/02/django笔记1/1552233166530.png" alt="1552233166530"></p>
<p>二</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">models.py里面添加一个字段，一定要给增加的字段设为初始值，为null都可以，然后重新数据库迁移</span></span><br><span class="line"><span class="xml">phone=models.CharField(max_length=64,default='120')</span></span><br></pre></td></tr></table></figure>
<h4 id="2-orm删除字段"><a href="#2-orm删除字段" class="headerlink" title="2.orm删除字段"></a>2.orm删除字段</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">models</span><span class="selector-class">.py</span>里面将字段删除，然后重新数据库迁移,注释也可以</span><br></pre></td></tr></table></figure>
<h4 id="3-orm修改字段"><a href="#3-orm修改字段" class="headerlink" title="3.orm修改字段"></a>3.orm修改字段</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">models</span><span class="selector-class">.py</span>里面讲修改的字段，需要修改的东西写好，然后数据库迁移</span><br></pre></td></tr></table></figure>
<h4 id="4-orm查字段"><a href="#4-orm查字段" class="headerlink" title="4.orm查字段"></a>4.orm查字段</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">models</span><span class="selector-class">.py</span>里面看看就可以了</span><br></pre></td></tr></table></figure>
<h4 id="5-orm添加记录"><a href="#5-orm添加记录" class="headerlink" title="5.orm添加记录"></a>5.orm添加记录</h4><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user=models.User.objects.create<span class="params">(<span class="attr">name</span>=name,<span class="attr">password</span>=pwd,<span class="attr">address</span>=addr)</span></span><br></pre></td></tr></table></figure>
<h4 id="6-orm删除记录"><a href="#6-orm删除记录" class="headerlink" title="6.orm删除记录"></a>6.orm删除记录</h4><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ret = models.User.objects<span class="built_in">.filter</span><span class="built_in">(id</span><span class="built_in">=id</span>).<span class="keyword">delete</span>()</span><br></pre></td></tr></table></figure>
<h4 id="7-orm修改记录"><a href="#7-orm修改记录" class="headerlink" title="7.orm修改记录"></a>7.orm修改记录</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">models.User.objects.filter(<span class="attribute">id</span>=id).update(name=name, <span class="attribute">password</span>=pwd, <span class="attribute">address</span>=addr)</span><br></pre></td></tr></table></figure>
<h4 id="8-orm查询记录"><a href="#8-orm查询记录" class="headerlink" title="8.orm查询记录"></a>8.orm查询记录</h4><p>出来的是对象可以全部,可以点字段出想要的数据</p>
<p><img src="/2019/03/02/django笔记1/1555849029706.png" alt="1555849029706"></p>
<p><img src="/2019/03/02/django笔记1/1552234194253.png" alt="1552234194253"></p>
<p><img src="/2019/03/02/django笔记1/1552234212442.png" alt="1552234212442"></p>
<h6 id="数据在reder里面就已经替换完成"><a href="#数据在reder里面就已经替换完成" class="headerlink" title="数据在reder里面就已经替换完成"></a>数据在reder里面就已经替换完成</h6><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ret</span> = models.User.objects.<span class="keyword">all</span>()列表</span><br><span class="line"><span class="keyword">ret</span> = models.User.objects.<span class="built_in">filter</span>（id=id).<span class="keyword">first</span>()</span><br></pre></td></tr></table></figure>
<h4 id="二-django中前端向后端发送请求后携带值得2种方式"><a href="#二-django中前端向后端发送请求后携带值得2种方式" class="headerlink" title="二.django中前端向后端发送请求后携带值得2种方式"></a>二.django中前端向后端发送请求后携带值得2种方式</h4><ul>
<li><p>方式一</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/updateuser/?id=&#123;&#123; user.id &#125;&#125;"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; user.name &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>密码: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; user.password &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>地址: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"addr"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; user.address &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">注意：后端如何取值</span><br><span class="line">id = request.GET.get("id")</span><br></pre></td></tr></table></figure>
</li>
<li><p>方式二</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; user.id &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">注意：后端如何取值</span><br><span class="line">id = request.POST.get("id")</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="三-django请求的生命周期"><a href="#三-django请求的生命周期" class="headerlink" title="三.django请求的生命周期"></a>三.django请求的生命周期</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">客户端发出请求 &lt;--&gt; web服务器（遵循wsgi协议） &lt;--&gt; 中间件&lt;--&gt;url路由层&lt;--&gt;视图层(views)&lt;--&gt;模型层&lt;--&gt;模板层</span><br></pre></td></tr></table></figure>
<h3 id="day4"><a href="#day4" class="headerlink" title="day4"></a>day4</h3><h4 id="一-路由层"><a href="#一-路由层" class="headerlink" title="一.    路由层"></a>一.    路由层</h4><h5 id="简单配置"><a href="#简单配置" class="headerlink" title="简单配置"></a>简单配置</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>第一个参数是正则表达式（如果要精准匹配：url(<span class="string">r'^admin/$'</span>, admin.site.urls)）</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>第二个参数是视图函数（不要加括号）</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>为假,路径不会加反斜杠</span><br><span class="line">APPEND_SLASH=<span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h5 id="无名分组"><a href="#无名分组" class="headerlink" title="无名分组"></a>无名分组</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">按位置传参</span><br><span class="line">分组过后，会把分组出来的数据，当做位置参数，传到视图函数，所以视图函数需要定义形参。</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">url(<span class="string">r'^publish/([0-9]&#123;4&#125;)/([0-9]&#123;2&#125;)$'</span>, views.publish),</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">publish</span><span class="params">(request,*args)</span>:</span>   视图函数可以这样接收</span><br></pre></td></tr></table></figure>
<h5 id="有名分组"><a href="#有名分组" class="headerlink" title="有名分组"></a>有名分组</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">按关键字传参</span><br><span class="line">有名分组出来之后，会把分出出来的数据，当关键字参数，传到视图函数中，所以视图函数需要定义形参，形参的名字和分组名对应，与顺序无关。</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">url(<span class="string">r'^publish/(?P&lt;year&gt;[0-9]&#123;4&#125;)/(?P&lt;mounth&gt;[0-9]&#123;2&#125;)/$'</span>, views.publish),</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">publish</span><span class="params">(request, mounth,year)</span>:</span></span><br><span class="line">*****有名分组和无名分组,不要混用</span><br></pre></td></tr></table></figure>
<h5 id="反向解析"><a href="#反向解析" class="headerlink" title="反向解析"></a>反向解析</h5><p>是把一个</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>先命一个名：</span><br><span class="line">	<span class="number">1.1</span> 无参数：</span><br><span class="line">    url(<span class="string">r'^publishadd133/$'</span>,views.publishadd,name=<span class="string">'ddd'</span>),</span><br><span class="line">    <span class="number">1.2</span> 无名分组</span><br><span class="line">    url(<span class="string">r'^publishadd/([0-9]&#123;4&#125;)/([0-9]&#123;2&#125;)/$'</span>, views.publishadd,name=<span class="string">'ddd'</span>),</span><br><span class="line">    <span class="number">1.3</span> 有名分组</span><br><span class="line">    url(<span class="string">r'^publishadd/(?P&lt;year&gt;[0-9]&#123;4&#125;)/(?P&lt;mounth&gt;[0-9]&#123;2&#125;)/$'</span>, views.publishadd,name=<span class="string">'ddd'</span>),</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>在模型层</span><br><span class="line">	<span class="number">2.1</span> 无参数</span><br><span class="line">    &#123;% url <span class="string">'ddd'</span> %&#125;【</span><br><span class="line">    <span class="number">2.2</span> 无名分组</span><br><span class="line">    &#123;% url <span class="string">'ddd'</span> <span class="number">2018</span> <span class="number">12</span> %&#125;</span><br><span class="line">    <span class="number">2.3</span> 有名分组</span><br><span class="line">    &#123;% url <span class="string">'ddd'</span> <span class="number">2018</span> <span class="number">12</span> %&#125;  还可以 &#123;% url <span class="string">'ddd'</span> year=<span class="number">2018</span> mounth=<span class="number">12</span> %&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.</span>在视图层</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> reverse</span><br><span class="line">	<span class="number">3.1</span> 无参数</span><br><span class="line">    url=reverse(<span class="string">'ddd'</span>)</span><br><span class="line">    <span class="number">3.2</span> 无名分组</span><br><span class="line">    url=reverse(<span class="string">'ddd'</span>,args=(<span class="number">2018</span>,<span class="number">12</span>,)) </span><br><span class="line">    <span class="number">3.3</span> 有名分组</span><br><span class="line">    url=reverse(<span class="string">'ddd'</span>,args=(<span class="number">2018</span>,<span class="number">12</span>,)) 还可以 url=reverse(<span class="string">'ddd'</span>,kwargs=&#123;<span class="string">'year'</span>:<span class="number">2018</span>,<span class="string">'mounth'</span>:<span class="number">12</span>&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="路由分发"><a href="#路由分发" class="headerlink" title="路由分发"></a>路由分发</h5><p>创建APP</p>
<p><img src="/2019/03/02/django笔记1/1552488359923.png" alt="1552488359923"></p>
<p>settings.py里面配置<img src="/2019/03/02/django笔记1/1552488778206.png" alt="1552488778206"></p>
<p>app的视图函数要和路由一致</p>
<p><img src="/2019/03/02/django笔记1/1552489301361.png" alt="1552489301361"></p>
<p><img src="/2019/03/02/django笔记1/1552489506222.png" alt="1552489506222"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 在不同的app里创建urls.py</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 在总路由 </span><br><span class="line">导入 app01 urls</span><br><span class="line">-<span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> include </span><br><span class="line">-url(<span class="string">r'^blog/'</span>,include(<span class="string">'blog.urls'</span>)),</span><br><span class="line">-url(<span class="string">r'^app01/'</span>,include(<span class="string">'app01.urls'</span>)),</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 在不同的app的urls里配置路由关系	</span><br><span class="line">***重点***总路由,不能加结束符$</span><br></pre></td></tr></table></figure>
<h5 id="名称空间"><a href="#名称空间" class="headerlink" title="名称空间"></a>名称空间</h5><p>这样不用多此一举加入名称空间</p>
<p><img src="/2019/03/02/django笔记1/1552489924936.png" alt="1552489924936"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>url(<span class="string">r'^blog/'</span>,include(<span class="string">'blog.urls'</span>,namespace=<span class="string">'blog'</span>)),</span><br><span class="line">子路由:url(<span class="string">r'^publish/$'</span>, views.publish,name=<span class="string">'test'</span>),</span><br><span class="line">    反向解析:</span><br><span class="line">        视图层:url = reverse(<span class="string">'blog:test'</span>)</span><br><span class="line">        模板层:&#123;% url <span class="string">'app01:test'</span>%&#125;</span><br><span class="line">                ***一般不要用***</span><br><span class="line">                子路由:url(<span class="string">r'^publish/$'</span>, views.publish,name=<span class="string">'app01_test'</span>),</span><br></pre></td></tr></table></figure>
<h5 id="伪静态"><a href="#伪静态" class="headerlink" title="伪静态"></a>伪静态</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">路由:url(<span class="string">r'^book/(?P&lt;id&gt;\d+.html)'</span>,views.book),</span><br><span class="line">访问:http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/book/<span class="number">4.</span>html</span><br></pre></td></tr></table></figure>
<h5 id="根路径响应到指定"><a href="#根路径响应到指定" class="headerlink" title="根路径响应到指定"></a>根路径响应到指定</h5><p><img src="/2019/03/02/django笔记1/1552490963768.png" alt="552490897960"></p>
<h3 id="day5"><a href="#day5" class="headerlink" title="day5"></a>day5</h3><h4 id="一-虚拟环境"><a href="#一-虚拟环境" class="headerlink" title="一.虚拟环境"></a>一.虚拟环境</h4><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>虚拟环境的应用场景</span><br><span class="line">在同一台电脑上可以同时运行多个不同版本的软件</span><br></pre></td></tr></table></figure>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>通过virtualenv软件创建</span><br><span class="line">安装：</span><br><span class="line">	pip install virtualenv</span><br><span class="line">创建虚拟环境：</span><br><span class="line">	virtualenv env_django <span class="comment">--&gt;创建纯净环境</span></span><br><span class="line">	virtualenv <span class="comment">--system-site-packages env_django 继承原安装的模块</span></span><br><span class="line">激活该虚拟环境：</span><br><span class="line">	windows进入都目录里的<span class="keyword">script</span>文件夹输入：active</span><br><span class="line">退出虚拟环境：</span><br><span class="line">	deactivate</span><br></pre></td></tr></table></figure>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span>.在pycharm中创建虚拟环境</span><br><span class="line"><span class="keyword">File</span>---&gt;<span class="keyword">New</span> <span class="keyword">Project</span>--&gt; <span class="keyword">Project</span> Interpreter：<span class="keyword">New</span> Virtualenv environment</span><br></pre></td></tr></table></figure>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">4</span><span class="string">.</span><span class="comment">在pycharm下创建</span> <span class="comment">新建项目</span></span><br><span class="line"><span class="comment">files</span>--<span class="comment">settings</span>--<span class="comment">Project</span>--<span class="comment">Project</span> <span class="comment">Interpreter</span>--<span class="comment">add选择虚拟环境路径下的python</span><span class="string">.</span><span class="comment">exe即可</span></span><br></pre></td></tr></table></figure>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5</span>.参数说明</span><br><span class="line"></span><br><span class="line"><span class="symbol">Name</span>中填写新虚拟环境的名字，或者使用默认名字，方便以后安装第三方包和其他项目使用；</span><br><span class="line">在Location中填写新环境的文件目录<span class="comment">;</span></span><br><span class="line">在<span class="keyword">Base </span>interpreter下拉框中选择Python解释器；</span><br><span class="line">勾选Inherit <span class="meta">global</span> site-packages可以使用<span class="keyword">base </span>interpreter中的第三方库，不选将和外界完全隔离；</span><br><span class="line">勾选Make available to all projects可将此虚拟环境提供给其他项目使用。</span><br></pre></td></tr></table></figure>
<h4 id="二-django2和django1的路由的区别"><a href="#二-django2和django1的路由的区别" class="headerlink" title="二.django2和django1的路由的区别"></a>二.django2和django1的路由的区别</h4><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>dja<span class="symbol">ngo1</span>和dja<span class="symbol">ngo2</span>的路由区别</span><br><span class="line">dja<span class="symbol">ngo1</span>中使用url</span><br><span class="line">dja<span class="symbol">ngo2</span>中使用path，或re_path</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">path:传的路径,是准确路径</span><br><span class="line">5个转换器--&gt;path('test/&lt;path:year&gt;', views.re_test),</span><br><span class="line">            str,匹配除了路径分隔符（/）之外的非空字符串，这是默认的形式</span><br><span class="line">            int,匹配正整数，包含<span class="number">0</span>。</span><br><span class="line">            slug,匹配字母、数字以及横杠、下划线组成的字符串。</span><br><span class="line">            uuid,匹配格式化的uuid，如 <span class="number">075194</span>d3<span class="number">-6885</span><span class="number">-417</span>e-a8a8<span class="number">-6</span>c931e272f00。</span><br><span class="line">            path,匹配任何非空字符串，包含了路径分隔符（/）（不能用？）</span><br><span class="line">-自定义转换器</span><br><span class="line">    <span class="number">1</span> 定义一个类:</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyCon</span>:</span></span><br><span class="line">        <span class="comment"># 写一个正则表达式</span></span><br><span class="line">        regex = <span class="string">'[0-9]&#123;4&#125;'</span></span><br><span class="line">        <span class="comment"># 匹配出來的数据,会传到这里,retrun回去的,会被视图函数接收</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">to_python</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        	<span class="keyword">return</span> int(value)</span><br><span class="line">        <span class="comment"># 反向解析用的</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">to_url</span><span class="params">(self, value)</span>:</span></span><br><span class="line">       	 	<span class="keyword">return</span> <span class="string">'%04d'</span> % value</span><br><span class="line">        </span><br><span class="line">    <span class="number">2</span> <span class="keyword">from</span> django.urls <span class="keyword">import</span> register_converter</span><br><span class="line">        register_converter(MyCon,<span class="string">'yyy'</span>)</span><br><span class="line">    <span class="number">3</span> path(<span class="string">'test/&lt;yyy:year&gt;'</span>, views.re_test,name=<span class="string">'test'</span>),</span><br></pre></td></tr></table></figure>
<h6 id="反斜杠-settings-py里面"><a href="#反斜杠-settings-py里面" class="headerlink" title="反斜杠(settings.py里面)"></a>反斜杠(settings.py里面)</h6><p><img src="/2019/03/02/django笔记1/1552492082082.png" alt="1552492082082"></p>
<h4 id="3-视图层之HttpResquest对象"><a href="#3-视图层之HttpResquest对象" class="headerlink" title="3.视图层之HttpResquest对象"></a>3.视图层之HttpResquest对象</h4><p><img src="/2019/03/02/django笔记1/1552492635768.png" alt="1552492635768"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 前台Post传过来的数据,包装到POST字典中</span></span><br><span class="line"><span class="comment"># request.POST</span></span><br><span class="line"><span class="comment"># 前台浏览器窗口里携带的数据,包装到GET字典中</span></span><br><span class="line"><span class="comment"># request.GET</span></span><br><span class="line"><span class="comment"># 前台请求的方式</span></span><br><span class="line"><span class="comment"># request.method</span></span><br><span class="line"><span class="comment"># post提交的数据,body体的内容,前台会封装成:name=lqz&amp;age=18&amp;sex=1</span></span><br><span class="line"><span class="comment"># request.body</span></span><br><span class="line"><span class="comment"># 取出请求的路径,取不到数据部分</span></span><br><span class="line"><span class="comment"># print(request.path)</span></span><br><span class="line"><span class="comment"># 取出请求的路径,能取到数据部分</span></span><br><span class="line"><span class="comment"># print(request.get_full_path())</span></span><br><span class="line"><span class="comment"># print(request.META)</span></span><br></pre></td></tr></table></figure>
<h4 id="4-视图层之三件套"><a href="#4-视图层之三件套" class="headerlink" title="4.视图层之三件套"></a>4.视图层之三件套</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">三件套:render,HttpResponse,redirect</span><br><span class="line">render函数:</span><br><span class="line">    temp=Template(<span class="string">'&lt;h1&gt;&#123;&#123; user &#125;&#125;&lt;/h1&gt;'</span>)</span><br><span class="line">    con=Context(&#123;<span class="string">'user'</span>:<span class="string">'lqz'</span>&#125;)</span><br><span class="line">    ret=temp.render(con)</span><br><span class="line">    print(ret)</span><br><span class="line">    <span class="comment"># return render(request,'index.html')</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(ret)</span><br></pre></td></tr></table></figure>
<h4 id="5-视图层之JsonResponse"><a href="#5-视图层之JsonResponse" class="headerlink" title="5.视图层之JsonResponse"></a>5.视图层之JsonResponse</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">导入：</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line">视图函数中：</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">import</span> json</span><br><span class="line">    <span class="comment"># dic=&#123;'name':'lqz','age':18&#125;</span></span><br><span class="line">    ll = [<span class="string">'name'</span>, <span class="string">'age'</span>]</span><br><span class="line">    <span class="comment"># 把字典转换成json格式,返回到前台</span></span><br><span class="line">    <span class="comment"># return HttpResponse(json.dumps(dic))</span></span><br><span class="line">    <span class="comment"># 把列表转换成json格式,返回到前台</span></span><br><span class="line">    <span class="comment"># return HttpResponse(json.dumps(ll))</span></span><br><span class="line">    <span class="comment"># 把字典转换成json格式,返回到前台</span></span><br><span class="line">    <span class="comment"># return JsonResponse(dic)</span></span><br><span class="line">    <span class="comment"># 报错,默认不支持列表形式</span></span><br><span class="line">    <span class="comment"># return JsonResponse(ll)</span></span><br><span class="line">    <span class="comment"># 支持列表形式</span></span><br><span class="line">    <span class="keyword">return</span> JsonResponse(ll,safe=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">如果json中包含中文，可以</span><br><span class="line"><span class="keyword">return</span> JsonResponse(list_new, safe=<span class="literal">False</span>, json_dumps_params=&#123;<span class="string">"ensure_ascii"</span>: <span class="literal">False</span>&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="6-CBV和FBV类的视图还是函数的视图"><a href="#6-CBV和FBV类的视图还是函数的视图" class="headerlink" title="6.CBV和FBV类的视图还是函数的视图"></a>6.CBV和FBV类的视图还是函数的视图</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">基于类的视图</span><br><span class="line"><span class="number">1</span> 路由层:</span><br><span class="line">url(<span class="string">r'^test/'</span>, views.Test.as_view()),</span><br><span class="line"><span class="number">2</span> 视图层</span><br><span class="line">导入:</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line">写一个类:</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span><span class="comment">#一定要传request对象</span></span><br><span class="line">    	<span class="keyword">return</span> HttpResponse(<span class="string">'get-test'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">    	<span class="keyword">return</span> HttpResponse(<span class="string">'post-test'</span>)</span><br><span class="line">使用</span><br><span class="line">url(<span class="string">r'^test/'</span>, views.Test.as_view()),</span><br><span class="line"></span><br><span class="line">基于函数的视图</span><br></pre></td></tr></table></figure>
<h4 id="7-简单的文件上传功能"><a href="#7-简单的文件上传功能" class="headerlink" title="7.简单的文件上传功能"></a>7.简单的文件上传功能</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.模板层</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"my_file"</span> <span class="attr">value</span>=<span class="string">"请选择文件"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>视图层</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fileupload</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">'GET'</span>:</span><br><span class="line">    	<span class="keyword">return</span> render(request,<span class="string">'fileupload.html'</span>)</span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">'POST'</span>:</span><br><span class="line">        <span class="comment"># FILES</span></span><br><span class="line">        print(request.FILES)</span><br><span class="line">        print(type(request.FILES.get(<span class="string">'myfile'</span>)))</span><br><span class="line">        <span class="comment"># 从字典里根据名字,把文件取出来</span></span><br><span class="line">        myfile=request.FILES.get(<span class="string">'myfile'</span>)</span><br><span class="line">        <span class="keyword">from</span> django.core.files.uploadedfile <span class="keyword">import</span> InMemoryUploadedFile</span><br><span class="line">        <span class="comment"># 文件名字</span></span><br><span class="line">        name=myfile.name</span><br><span class="line">        <span class="comment"># 打开文件,把上传过来的文件存到本地</span></span><br><span class="line">        <span class="keyword">with</span> open(name,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="comment"># for line in myfile.chunks():</span></span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> myfile:</span><br><span class="line">                f.write(line)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'ok'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="day6"><a href="#day6" class="headerlink" title="day6"></a>day6</h3><h4 id="1-模板层"><a href="#1-模板层" class="headerlink" title="1.模板层"></a>1.模板层</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>解释视图如何工作的</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">current_datetime</span><span class="params">(request)</span>:</span></span><br><span class="line">    now = datetime.datetime.now()</span><br><span class="line">    html = <span class="string">"&lt;html&gt;&lt;body&gt;It is now %s.&lt;/body&gt;&lt;/html&gt;"</span> % now</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(html)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>为什么使用模板</span><br><span class="line">对页面设计进行的任何改变都必须对 Python 代码进行相应的修改。 站点设计的修改往往比底层 Python 代码的修改要频繁得多，因此如果可以在不进行 Python 代码修改的情况下变更设计，那将会方便得多。</span><br><span class="line"></span><br><span class="line">Python 代码编写和 HTML 设计是两项不同的工作，大多数专业的网站开发环境都将他们分配给不同的人员（甚至不同部门）来完成。 设计者和HTML/CSS的编码人员不应该被要求去编辑Python的代码来完成他们的工作。</span><br><span class="line"></span><br><span class="line">程序员编写 Python代码和设计人员制作模板两项工作同时进行的效率是最高的，远胜于让一个人等待另一个人完成对某个既包含 Python又包含 HTML 的文件的编辑工作。</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.</span>原始视图函数和django模板修改的视图函数</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">current_time</span><span class="params">(req)</span>:</span></span><br><span class="line">    <span class="comment"># ================================原始的视图函数</span></span><br><span class="line">    <span class="comment"># import datetime</span></span><br><span class="line">    <span class="comment"># now=datetime.datetime.now()</span></span><br><span class="line">    <span class="comment"># html="&lt;html&gt;&lt;body&gt;现在时刻：&lt;h1&gt;%s.&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;" %now</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ================================django模板修改的视图函数</span></span><br><span class="line">    <span class="comment"># from django.template import Template,Context</span></span><br><span class="line">    <span class="comment"># now=datetime.datetime.now()</span></span><br><span class="line">    <span class="comment"># t=Template('&lt;html&gt;&lt;body&gt;现在时刻是:&lt;h1&gt;&#123;&#123;current_date&#125;&#125;&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;')</span></span><br><span class="line">    <span class="comment"># #t=get_template('current_datetime.html')</span></span><br><span class="line">    <span class="comment"># c=Context(&#123;'current_date':str(now)&#125;)</span></span><br><span class="line">    <span class="comment"># html=t.render(c)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># return HttpResponse(html)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#另一种写法(推荐)</span></span><br><span class="line">    <span class="keyword">import</span> datetime</span><br><span class="line">    now=datetime.datetime.now()</span><br><span class="line">    <span class="keyword">return</span> render(req, <span class="string">'current_datetime.html'</span>, &#123;<span class="string">'current_date'</span>:str(now)[:<span class="number">19</span>]&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-模板语法之变量"><a href="#2-模板语法之变量" class="headerlink" title="2.模板语法之变量"></a>2.模板语法之变量</h4><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">模版语法重点：</span><br><span class="line"></span><br><span class="line">　　变量：&#123;&#123; 变量名 &#125;&#125;</span><br><span class="line"></span><br><span class="line">　　　　<span class="number">1</span> 深度查询 用句点符</span><br><span class="line"></span><br><span class="line">　　　　<span class="number">2</span> 过滤器</span><br><span class="line"></span><br><span class="line">　　标签：｛｛<span class="meta">%</span>  <span class="meta">%</span> ｝｝</span><br></pre></td></tr></table></figure>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">1.html部分</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>模板语言之变量<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="comment">&#123;# 模板语言注释 #&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>字符串：</span><span class="template-variable">&#123;&#123; name &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>数字：</span><span class="template-variable">&#123;&#123; age &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>列表：</span><span class="template-variable">&#123;&#123; lis &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>字典：</span><span class="template-variable">&#123;&#123; dic &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>元祖：</span><span class="template-variable">&#123;&#123; tu &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="comment">&#123;#只写函数名默认加括号运行#&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>函数：</span><span class="template-variable">&#123;&#123; test &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>类：</span><span class="template-variable">&#123;&#123; People &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>对象：</span><span class="template-variable">&#123;&#123; zhang &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>类对象列表：</span><span class="template-variable">&#123;&#123; lis2 &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>变量的深度查询<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>列表的第一个值：</span><span class="template-variable">&#123;&#123; lis.0 &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>字典取值：</span><span class="template-variable">&#123;&#123; dic.name &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="comment">&#123;#再继续取值继续点#&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>字典取列表值：</span><span class="template-variable">&#123;&#123; dic.hobbies &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>列表的第一个值：</span><span class="template-variable">&#123;&#123; lis.0 &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>对象取数据属性：</span><span class="template-variable">&#123;&#123; zhang.name &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>对象取函数属性：</span><span class="template-variable">&#123;&#123; zhang.get_name &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>对象取绑定给类函数属性：</span><span class="template-variable">&#123;&#123; zhang.cls_test &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>对象取静态函数属性：</span><span class="template-variable">&#123;&#123; zhang.foo &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>在列表对象中取出对象的属性：</span><span class="template-variable">&#123;&#123; lis2.0.age &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="comment">&#123;#注意：不能调有参数的方法#&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>字符串的内置方法：</span><span class="template-variable">&#123;&#123; name.isdigit &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>视图部分</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    name = <span class="string">"zcg"</span></span><br><span class="line">    age = <span class="number">18</span></span><br><span class="line">    lis = [<span class="string">"hello"</span>, <span class="number">33</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], &#123;<span class="string">"name"</span>: <span class="string">"zcg"</span>&#125;]</span><br><span class="line">    dic = &#123;<span class="string">"name"</span>: <span class="string">"zhang"</span>, <span class="string">"age"</span>: <span class="number">11</span>, <span class="string">"hobbies"</span>: [<span class="string">"chi"</span>, <span class="string">"he"</span>]&#125;</span><br><span class="line">    tu = (<span class="string">"si"</span>, <span class="number">1</span>, lis, type(lis))</span><br><span class="line">    lis4 = []</span><br><span class="line">    lis5 = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">    file_size = <span class="number">1024</span></span><br><span class="line">    c_time = datetime.datetime.now()</span><br><span class="line">    h1 = <span class="string">"&lt;h1&gt;你好啊&lt;/h1&gt;"</span></span><br><span class="line">    <span class="comment"># 这里的alert里面的东西如果是汉子必须加引号</span></span><br><span class="line">    script = <span class="string">"&lt;script&gt;alert('傻逼')&lt;/script&gt;"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># locals()会将该视图函数内的属性返回给模板</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"zhang"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello test"</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">People</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">            self.name = name</span><br><span class="line">            self.age = age</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_name</span><span class="params">(self)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="meta">        @classmethod</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">cls_test</span><span class="params">(cls)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"class use"</span></span><br><span class="line"></span><br><span class="line"><span class="meta">        @staticmethod</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"foo use"</span></span><br><span class="line"></span><br><span class="line">    zhang = People(<span class="string">"zhang"</span>, <span class="number">22</span>)</span><br><span class="line">    zcg = People(<span class="string">"zcg"</span>, <span class="number">44</span>)</span><br><span class="line">    lis2 = [zhang, zcg]</span><br><span class="line">    <span class="comment"># 相当于执行该函数，并打印</span></span><br><span class="line">    <span class="comment"># print(test())</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">"index.html"</span>, locals())</span><br></pre></td></tr></table></figure>
<h4 id="3-模板语法之过滤器"><a href="#3-模板语法之过滤器" class="headerlink" title="3.模板语法之过滤器"></a>3.模板语法之过滤器</h4><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">1.html部分</span></span><br><span class="line"><span class="xml">h1&gt;模板语言之过滤器<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="comment">&#123;#后面就是个python中的函数,|前面的,是函数的第一个参数,冒号后面的是第二个参数#&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>统计字符串的长度：</span><span class="template-variable">&#123;&#123; name|<span class="name">length</span> &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>统计列表的长度：</span><span class="template-variable">&#123;&#123; lis|<span class="name">length</span> &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>过滤器之默认值：</span><span class="template-variable">&#123;&#123; lis4|<span class="name">default</span>:<span class="string">"[hello]"</span> &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>过滤器之filesizeformat：</span><span class="template-variable">&#123;&#123; file_size|<span class="name">filesizeformat</span> &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>过滤器之无date：</span><span class="template-variable">&#123;&#123; c_time &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>过滤器之date:</span><span class="template-variable">&#123;&#123; c_time|<span class="name">date</span>:<span class="string">'Y-m-d'</span> &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>过滤器之slice:</span><span class="template-variable">&#123;&#123; name|<span class="name">slice</span>:<span class="string">'0:5:4'</span> &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="comment">&#123;#truncatechars 至少三个起步#&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>过滤器之truncatechars:</span><span class="template-variable">&#123;&#123; 'dafddfafgadfgaasdgadgfadaf'|<span class="name">truncatechars</span>:5 &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>过滤器之truncatewords:</span><span class="template-variable">&#123;&#123; '我 dfaf ga dfgaas 你 dgf adaf'|<span class="name">truncatewords</span>:5 &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>过滤器之不用safe：</span><span class="template-variable">&#123;&#123; h1 &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>过滤器之用safe：</span><span class="template-variable">&#123;&#123; h1|<span class="name">safe</span> &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>过滤器之不用safe：</span><span class="template-variable">&#123;&#123; script &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="comment">&#123;#&lt;p&gt;过滤器之用safe：&#123;&#123; script|safe &#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>过滤器之用add:</span><span class="template-variable">&#123;&#123; 12|<span class="name">add</span>:<span class="string">'1'</span> &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>过滤器之用add:</span><span class="template-variable">&#123;&#123; 'egon'|<span class="name">add</span>:<span class="string">'dsb'</span> &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="4-模板语法之标签"><a href="#4-模板语法之标签" class="headerlink" title="4.模板语法之标签"></a>4.模板语法之标签</h4><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">1.html部分</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>模板语言之标签<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">for</span></span> li <span class="keyword">in</span> lis %&#125;</span></span><br><span class="line"><span class="xml">    </span><span class="template-variable">&#123;&#123; forloop &#125;&#125;</span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> forloop.revcounter %&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123; forloop.first &#125;&#125;</span><span class="xml">---&gt;</span><span class="template-variable">&#123;&#123; forloop.counter0 &#125;&#125;</span><span class="xml">---&gt;</span><span class="template-variable">&#123;&#123; forloop.revcounter &#125;&#125;</span><span class="xml">-----&gt;</span><span class="template-variable">&#123;&#123; li &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">endfor</span></span> %&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">for</span></span> foo <span class="keyword">in</span> lis5 %&#125;</span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">for</span></span> li <span class="keyword">in</span> lis %&#125;</span></span><br><span class="line"><span class="xml">        </span><span class="template-variable">&#123;&#123; forloop.parentloop.counter &#125;&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123; forloop.first &#125;&#125;</span><span class="xml">---&gt;</span><span class="template-variable">&#123;&#123; forloop.counter0 &#125;&#125;</span><span class="xml">---&gt;</span><span class="template-variable">&#123;&#123; forloop.revcounter &#125;&#125;</span><span class="xml">-----&gt;</span><span class="template-variable">&#123;&#123; li &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">endfor</span></span> %&#125;</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">endfor</span></span> %&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">for</span></span> foo <span class="keyword">in</span> lis5 %&#125;</span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">for</span></span> foo <span class="keyword">in</span> lis %&#125;</span></span><br><span class="line"><span class="xml">        </span><span class="comment">&#123;#        标签之if#&#125;</span></span><br><span class="line"><span class="xml">        </span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> forloop.counter &lt; 3 and forloop.parentloop.counter == 1 %&#125;</span></span><br><span class="line"><span class="xml">            </span><span class="template-variable">&#123;&#123; forloop.parentloop.counter &#125;&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123; foo &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">        </span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">endfor</span></span> %&#125;</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">endfor</span></span> %&#125;</span></span><br><span class="line"><span class="comment">&#123;#标签之with,取别名，对于名字过长的变量起到简化作用#&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">with</span></span> lis5 <span class="keyword">as</span> mm %&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123; mm.0 &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123; lis5.0 &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">endwith</span></span> %&#125;</span></span><br><span class="line"><span class="xml">************************for ,if,with 都要有结束******************</span></span><br></pre></td></tr></table></figure>
<h4 id="5-模板语法之自定义过滤器"><a href="#5-模板语法之自定义过滤器" class="headerlink" title="5.模板语法之自定义过滤器"></a>5.模板语法之自定义过滤器</h4><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">***标签不能用在if判断中,过滤器,可以用在if判断中</span></span><br><span class="line"><span class="xml">自定义过滤器</span></span><br><span class="line"><span class="xml">1 先app是不是已经在setting中注册</span></span><br><span class="line"><span class="xml">2 在app下创建一个templatetags(****名字不能变***)的文件夹(模块)</span></span><br><span class="line"><span class="xml">3 在模块下创建一个py文件,名字随意:mytag.py</span></span><br><span class="line"><span class="xml">4 # 第一步,导入template</span></span><br><span class="line"><span class="xml">from django.template import Library</span></span><br><span class="line"><span class="xml"># 第二步,定义一个叫register的变量=template.Library()</span></span><br><span class="line"><span class="xml">			   register = Library()</span></span><br><span class="line"><span class="xml">5 写一个函数,用@register.filter(name='yyy')装饰一下(可以指定别名)</span></span><br><span class="line"><span class="xml">def str_add(str1, str2): #一定要有返回值</span></span><br><span class="line"><span class="xml">    # 业务逻辑很复杂</span></span><br><span class="line"><span class="xml">    return str1 + str2</span></span><br><span class="line"><span class="xml">6 在模板里:(新定定义的标签,过滤器,都要重启程序)</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">load</span></span> mytag %&#125;</span></span><br><span class="line"><span class="template-variable">&#123;&#123;'lqz'|str_add:'nb'&#125;&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>实例html部分</span><br><span class="line">&#123;% load my_tags %&#125;</span><br><span class="line">&lt;p&gt;&#123;&#123; 'lqz'|yyy:'nb' &#125;&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>实例templatetags下的mytag</span><br><span class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> Library</span><br><span class="line">register = Library()</span><br><span class="line"><span class="meta">@register.filter(name='yyy')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str_add</span><span class="params">(str1, str2)</span>:</span></span><br><span class="line">    <span class="comment"># 业务逻辑很复杂</span></span><br><span class="line">    <span class="keyword">return</span> str1 + str2</span><br></pre></td></tr></table></figure>
<h4 id="6-模板语法之自定义标签"><a href="#6-模板语法之自定义标签" class="headerlink" title="6.模板语法之自定义标签"></a>6.模板语法之自定义标签</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">自定义标签:</span><br><span class="line"><span class="number">1</span><span class="number">-4</span>:前<span class="number">4</span>步,根过滤器的定义完全一样</span><br><span class="line"><span class="number">5</span> 只是装饰器不一样</span><br><span class="line"><span class="meta">@register.simple_tag()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_nb</span><span class="params">(value)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> value+<span class="string">'nb'</span></span><br><span class="line"><span class="number">6</span> 在模板里:(多个参数,以空格区分)</span><br><span class="line">&#123;% load mytag %&#125;</span><br><span class="line">&#123;% add_nb <span class="string">'lqz'</span>%&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>实例之html部分</span><br><span class="line">&lt;h4&gt;使用自定义的标签&lt;/h4&gt;</span><br><span class="line">&lt;p&gt;&#123;% add_nb 'egon' %&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;% add_3 'egon' 'is' 'dsb' %&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>实例之templatetags的mytag部分</span><br><span class="line"><span class="meta">@register.simple_tag()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">(value)</span>:</span></span><br><span class="line">    word = Thread_word.objects.all().values()</span><br><span class="line">    map_word = &#123;dic.get(<span class="string">"old_word"</span>): dic.get(<span class="string">"new_word"</span>) <span class="keyword">for</span> dic <span class="keyword">in</span> word&#125;</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> map_word.items():</span><br><span class="line">        <span class="keyword">if</span> k <span class="keyword">in</span> value:</span><br><span class="line">            value = value.replace(k, v)</span><br><span class="line">    <span class="keyword">return</span> value</span><br></pre></td></tr></table></figure>
<h4 id="7-模板的导入-重复使用"><a href="#7-模板的导入-重复使用" class="headerlink" title="7.模板的导入(重复使用)"></a>7.模板的导入(重复使用)</h4><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">1.什么是模板的导入</span></span><br><span class="line"><span class="xml">就是写了一个好看的组件，可以复用</span></span><br><span class="line"></span><br><span class="line"><span class="xml">2.如何导入</span></span><br><span class="line"><span class="xml">2.1 先写一个模板</span></span><br><span class="line"><span class="xml">2.2 在需要导入的模板中：</span><span class="template-tag">&#123;% <span class="name"><span class="name">include</span></span> "模板的名字" %&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">3.实例</span></span><br><span class="line"><span class="xml">3.1 需要导入模板中的代码</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">include</span></span> "love.html" %&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">3.2 模板中的代码：注意不要html标签，只写一个组件即可</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>床前明月光<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>疑是地上霜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>举头望明月<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>低头思故乡<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">3.3 视图中的代码</span></span><br><span class="line"><span class="xml">def input_test(request):</span></span><br><span class="line"><span class="xml">    return render(request, "input_html.html")</span></span><br></pre></td></tr></table></figure>
<h4 id="8-模板的继承"><a href="#8-模板的继承" class="headerlink" title="8.模板的继承"></a>8.模板的继承</h4><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">注意：模板继承的时候，可以先将需要的数据，查询出来，然后通过<span class="built_in">local</span>（），将数据拿到前端页面渲染，在后台渲染完毕后，返回到前台，</span><br><span class="line"></span><br><span class="line">非常重要的：</span><br><span class="line">当后台共用一个视图函数时，视图函数中可以通过<span class="built_in">args</span>/kwargs等来接受，如论是否传值，均可以相应到对应的视图</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">eg：</span><br><span class="line">url(<span class="string">r'^(?P&lt;username&gt;[\w]+)/(?P&lt;condition&gt;category|tag|archive)/(?P&lt;param&gt;.*)'</span>, views.user_blog),</span><br><span class="line">url(<span class="string">r'^(?P&lt;username&gt;[\w]+)$'</span>, views.user_blog),</span><br><span class="line"></span><br><span class="line">视图：</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_blog</span><span class="params">(request, username, *args, **kwargs)</span>:</span></span><br><span class="line">    print(username)</span><br><span class="line">    <span class="comment"># username=username</span></span><br><span class="line">    user = models.UserInfo.objects.filter(username=username).first()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'error.html'</span>)</span><br><span class="line"></span><br><span class="line">    blog = user.blog</span><br><span class="line">    article_list = blog.article_set.all()</span><br><span class="line">    <span class="comment"># 取出condition中的分类/标签/时间</span></span><br><span class="line">    condition = kwargs.get(<span class="string">'condition'</span>)</span><br><span class="line">    <span class="comment"># condition可能是category|tag|archive中的一个 还可能是空</span></span><br><span class="line">    <span class="comment"># 取出param的值,可能为标签id,分类id,或者是时间</span></span><br><span class="line">    param = kwargs.get(<span class="string">'param'</span>)</span><br><span class="line">    print(condition)</span><br><span class="line">    print(param)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'tag'</span> == condition:</span><br><span class="line">        article_list = article_list.filter(tag__pk=param)</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">'category'</span> == condition:</span><br><span class="line">        article_list = article_list.filter(category__pk=param)</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">'archive'</span> == condition:</span><br><span class="line">        <span class="comment">#     2018-11   --&gt;切分---&gt;查询</span></span><br><span class="line">        <span class="comment"># [2018,11]</span></span><br><span class="line">        archive_list = param.split(<span class="string">'-'</span>)</span><br><span class="line">        <span class="comment"># 过滤:发布年为2018年,月为11月的所有文章</span></span><br><span class="line">        article_list = article_list.filter(create_time__year=archive_list[<span class="number">0</span>], create_time__month=archive_list[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_blog.html'</span>, locals())</span><br></pre></td></tr></table></figure>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">1.什么是模板的继承</span></span><br><span class="line"><span class="xml">写一个母版，留一个可拓展区域的盒子，可以留多个盒子，盒子内的东西可以变化，盒子外的其他部分，都继承之母版，不可改变</span></span><br><span class="line"></span><br><span class="line"><span class="xml">2.使用方式</span></span><br><span class="line"><span class="xml">2.1 先写一个母版，留合适的可拓展区域的盒子</span></span><br><span class="line"><span class="xml">语法：</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">block</span></span> content %&#125;</span></span><br><span class="line"><span class="xml">....可以写内容</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">endblock</span></span> content %&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">2.2 在子模板中使用</span></span><br><span class="line"><span class="xml">语法：</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">extends</span></span> "母版的名字" %&#125;</span><span class="xml">  ---明确继承的母版</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">block</span></span> content %&#125;</span></span><br><span class="line"><span class="xml">....可以写页面内容</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">endblock</span></span> content%&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">3.实例：</span></span><br><span class="line"><span class="xml">3.1母版</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        </span><span class="template-tag">&#123;% <span class="name"><span class="name">block</span></span> content %&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        </span><span class="template-tag">&#123;% <span class="name"><span class="name">endblock</span></span> content %&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">3.2 使用母版</span></span><br><span class="line"><span class="xml">方式一：直接继承过来使用，不重写block，默认显示父级的内容</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">extends</span></span> "muban.html" %&#125;</span></span><br><span class="line"><span class="xml">    </span></span><br><span class="line"><span class="xml">方式二：继承过来，重写block，block部分使用自己的其他部分使用母版的</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">extends</span></span> "muban.html" %&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">block</span></span> content %&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>我是可以使用区域，我厉害吧<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>我是可以使用区域，我厉害吧<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>我是可以使用区域，我厉害吧<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>我是可以使用区域，我厉害吧<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>我是可以使用区域，我厉害吧<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>我是可以使用区域，我厉害吧<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">endblock</span></span> %&#125;</span></span><br><span class="line"><span class="xml">    </span></span><br><span class="line"><span class="xml">方式三：继承过来，重写block，super重用父级的功能</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">extends</span></span> "muban.html" %&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">block</span></span> content %&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>我是可以使用区域，我厉害吧<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-variable">&#123;&#123; block.super &#125;&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>我是可以使用区域，我厉害吧<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>我是可以使用区域，我厉害吧<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>我是可以使用区域，我厉害吧<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>我是可以使用区域，我厉害吧<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>我是可以使用区域，我厉害吧<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">endblock</span></span> %&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="9-静态文件相关"><a href="#9-静态文件相关" class="headerlink" title="9.静态文件相关"></a>9.静态文件相关</h4><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">方式一：写死静态文件的路径</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/static/css/new.css"</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">方式二：通过反向查找拼接路径</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">load</span></span> static %&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"</span></span></span><span class="template-tag">&#123;% <span class="name"><span class="name">static</span></span> 'css/new.css' %&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">方式三：通过反向查找</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">load</span></span> static %&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"</span></span></span><span class="template-tag">&#123;% <span class="name"><span class="name">get_static_prefix</span></span> %&#125;</span><span class="xml"><span class="tag"><span class="string">css/new.css"</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">注意：</span></span><br><span class="line"><span class="xml">get_static_prefix返回值是:静态文件的地址,相当于/static/</span></span><br></pre></td></tr></table></figure>
<h3 id="day7"><a href="#day7" class="headerlink" title="day7"></a>day7</h3><h4 id="1-单表操作"><a href="#1-单表操作" class="headerlink" title="1.单表操作"></a>1.单表操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    <span class="number">1.</span>数据库迁移命令</span><br><span class="line">python manage.py makemigrations 只是在migrations里面做了一个记录</span><br><span class="line">python manage.py migrate  真正在数据库中建立表格</span><br><span class="line">python manage.py showmigrations 查看有没有提交到数据库</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>查询的api（接口）**********</span><br><span class="line"></span><br><span class="line">增加：</span><br><span class="line">方式一：create创建</span><br><span class="line">book = models.Book.objects.create(name=<span class="string">"红楼梦"</span>, price=<span class="number">23.8</span>, publish=<span class="string">"人民出版社"</span>, author=<span class="string">"曹大姐"</span>, create_date=<span class="string">"2011-9-12"</span>)</span><br><span class="line">print(book.create_date)</span><br><span class="line"></span><br><span class="line">方式二：先实例化产生对象，然后调用save方法</span><br><span class="line">book = models.Book(name=<span class="string">"水浒传"</span>, price=<span class="number">19</span>, publish=<span class="string">"北京出版社"</span>, author=<span class="string">"施耐阉"</span>)</span><br><span class="line">book.save()</span><br><span class="line">print(book.name)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">删除：</span><br><span class="line">方式一：删除名字叫水浒传的这本书，通过queryset删除</span><br><span class="line">ret = models.Book.objects.filter(name=<span class="string">"水浒传"</span>).first().delete()</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line">方式二：删除全部，通过queryset删除</span><br><span class="line">ret = models.Book.objects.filter(name=<span class="string">"水浒传"</span>).all().delete()</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line">方式三：通过对象删除</span><br><span class="line">ret = models.Book.objects.filter(name=<span class="string">"水浒传"</span>).first()</span><br><span class="line">print(ret)</span><br><span class="line">msg = ret.delete()</span><br><span class="line">print(msg)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">修改：</span><br><span class="line">方式一：通过queryset来修改，,返回值是int类型的影响的行数</span><br><span class="line">ret = models.Book.objects.filter(name=<span class="string">"水浒传"</span>).update(price=<span class="number">99</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line">方式二：通过book对象的方式来修改</span><br><span class="line">book = models.Book.objects.filter(name=<span class="string">"水浒传"</span>).last()</span><br><span class="line">book.price = <span class="number">88</span></span><br><span class="line">book.save()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">查询：********非常重要**********</span><br><span class="line"><span class="number">1.</span>all()取到表中所有记录放入queryset对象中</span><br><span class="line">ret = models.Book.objects.all()</span><br><span class="line">print(ret)</span><br><span class="line">eg:</span><br><span class="line">&lt;QuerySet [&lt;Book: name:红楼梦  price:<span class="number">23.80</span>&gt;, &lt;Book: name:水浒传  price:<span class="number">88.00</span>&gt;, &lt;Book: name:水浒传  price:<span class="number">88.00</span>&gt;, &lt;Book: name:小李飞刀  price:<span class="number">44.00</span>&gt;, &lt;Book: name:书剑恩仇录  price:<span class="number">50.00</span>&gt;]&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>filter() 相当于sql中的where，后面跟过滤条件，返回的结果是queryset的对象</span><br><span class="line">ret = models.Book.objects.filter(name=<span class="string">"小李飞刀"</span>)</span><br><span class="line">print(ret) -- 拿到的是queryset对象</span><br><span class="line"></span><br><span class="line">ret = models.Book.objects.filter(name=<span class="string">"水浒传"</span>).first()</span><br><span class="line">print(ret) --book的对象</span><br><span class="line"></span><br><span class="line">ret = models.Book.objects.filter(name=<span class="string">"水浒传"</span>, id=<span class="number">11</span>)</span><br><span class="line">print(ret) --取到名字是水浒传且id是<span class="number">1</span>的queryset对象</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>get() 有且只有一个结果，返回的是表中的一条记录，不是queryset对象</span><br><span class="line">ret = models.Book.objects.get(id=<span class="number">1</span>) --返回唯一的对象  </span><br><span class="line">print(ret)</span><br><span class="line">ret = models.Book.objects.get(name=<span class="string">"水浒传"</span>) --多个就报错</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>exclude() 查询名字不叫西游记的书，结果也是queryset的对象</span><br><span class="line">ret = models.Book.objects.exclude(name=<span class="string">"小李飞刀"</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>order_by() 按指定字段排序，默认是asc，-号是desc</span><br><span class="line">ret = models.Book.objects.all().order_by(<span class="string">"price"</span>)</span><br><span class="line">print(ret) --asc</span><br><span class="line">ret = models.Book.objects.all().order_by(<span class="string">"-price"</span>)</span><br><span class="line">print(ret) -- desc</span><br><span class="line">ret=models.Book.objects.all().order_by(<span class="string">'-price'</span>,<span class="string">'create_data'</span>) --可以传多个值</span><br><span class="line"></span><br><span class="line"><span class="number">6.</span>reverse() 对排序后的结果进行反向排序（一定是排序后的结果，否则报错）</span><br><span class="line">ret = models.Book.objects.all().order_by(<span class="string">"-price"</span>).reverse()</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="number">7.</span>count() 查询结果的个数，是int类型</span><br><span class="line">ret = models.Book.objects.filter(name=<span class="string">"水浒传"</span>).count()</span><br><span class="line">print(ret) --结果为：<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="number">8.l</span>ast() 对queryset的对象取最后一个，得到的是book的对象</span><br><span class="line">ret = models.Book.objects.all().last()</span><br><span class="line">print(ret) --Bookobj</span><br><span class="line"></span><br><span class="line"><span class="number">9.</span> exists 判断查询的结果是否存在，返回结果是布尔类型</span><br><span class="line">ret = models.Book.objects.filter(name=<span class="string">"cc"</span>).exists()</span><br><span class="line">print(ret) --<span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="number">10.</span>values(*field) 返回queryset的对象，里面套字典，字典里面拥有的字段名为values里面的字段名</span><br><span class="line"></span><br><span class="line">ret = models.Book.objects.all().values(<span class="string">'name'</span>, <span class="string">'price'</span>)&lt;QuerySet [&#123;<span class="string">'name'</span>: <span class="string">'红楼梦'</span>, <span class="string">'price'</span>: Decimal(<span class="string">'23.80'</span>)&#125;] &gt;</span><br><span class="line"></span><br><span class="line"><span class="number">11.</span>value_list() 返回时queryset对象，里面是元祖，元祖里面是value_list里面的字段名</span><br><span class="line"></span><br><span class="line"> ret = models.Book.objects.all().values_list(<span class="string">'name'</span>, <span class="string">'price'</span>)</span><br><span class="line"> &lt;QuerySet [(<span class="string">'红楼梦'</span>, Decimal(<span class="string">'23.80'</span>))] &gt;</span><br><span class="line"></span><br><span class="line"><span class="number">12.</span>distinct() 必须完全一样,才能去重   只要带了id,去重就没有意义了</span><br><span class="line"></span><br><span class="line">ret = models.Book.objects.all().values(<span class="string">'name'</span>).distinct()</span><br><span class="line">print(ret) ---去除名字重复的记录</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">查询：基于双下划线的模糊查询</span><br><span class="line"><span class="number">1.</span>大于gt &gt;</span><br><span class="line">ret = models.Book.objects.filter(price__gt=<span class="number">50</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>小于lt &lt;</span><br><span class="line">ret = models.Book.objects.filter(price__lt=<span class="number">50</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>大于等于gte &gt;=</span><br><span class="line">ret = models.Book.objects.filter(price__gte=<span class="string">'50'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>小于等于lte &lt;=</span><br><span class="line">ret = models.Book.objects.filter(price__lte=<span class="string">'50'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>在什么之中 <span class="keyword">in</span></span><br><span class="line">ret = models.Book.objects.filter(price__in=[<span class="string">'88'</span>, <span class="string">'44'</span>, <span class="string">'50'</span>])</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="number">6.</span>在什么范围中 range = between <span class="keyword">and</span></span><br><span class="line">ret = models.Book.objects.filter(price__range=[<span class="number">50</span>, <span class="number">100</span>])</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="number">7.</span>查询在字段中是否包含某个字contains 首尾中全符合</span><br><span class="line">ret = models.Book.objects.filter(name__contains=<span class="string">'李'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="number">8.</span>icontains 查询名字带p的书,忽略大小写</span><br><span class="line">ret=models.Book.objects.filter(name__icontains=<span class="string">'P'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="number">9.</span>以什么开头startswith </span><br><span class="line">ret = models.Book.objects.filter(name__startswith=<span class="string">"水"</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="number">10.</span>以什么结尾endswith 不能查询价格之类的字段</span><br><span class="line">ret = models.Book.objects.filter(name__endswith=<span class="string">"传"</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="number">11.</span>按年查询：year | month | day</span><br><span class="line">ret = models.Book.objects.filter(create_date__year=<span class="string">"2017"</span>)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<h3 id="day8"><a href="#day8" class="headerlink" title="day8"></a>day8</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>django终端打印sql语句</span><br><span class="line"></span><br><span class="line">LOGGING = &#123;</span><br><span class="line">    <span class="string">'version'</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">'disable_existing_loggers'</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">'handlers'</span>: &#123;</span><br><span class="line">        <span class="string">'console'</span>:&#123;</span><br><span class="line">            <span class="string">'level'</span>:<span class="string">'DEBUG'</span>,</span><br><span class="line">            <span class="string">'class'</span>:<span class="string">'logging.StreamHandler'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'loggers'</span>: &#123;</span><br><span class="line">        <span class="string">'django.db.backends'</span>: &#123;</span><br><span class="line">            <span class="string">'handlers'</span>: [<span class="string">'console'</span>],</span><br><span class="line">            <span class="string">'propagate'</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">'level'</span>:<span class="string">'DEBUG'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>创建模型</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="comment"># 名字使用大驼峰</span></span><br><span class="line"><span class="comment"># 用OneToOneField/ForeignKey 默认会在字段后面添加_id</span></span><br><span class="line"><span class="comment"># 一对一的关系:OneToOneField</span></span><br><span class="line"><span class="comment"># 一对多的关系:ForeignKey</span></span><br><span class="line"><span class="comment"># 多对多的关系:ManyToManyField</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publish</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># id如果不写，会自动生成,nid,自动递增</span></span><br><span class="line">    id = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    address = models.CharField(max_length=<span class="number">55</span>)</span><br><span class="line">    email = models.EmailField()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    id = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="comment"># 数字类型</span></span><br><span class="line">    sex = models.IntegerField()</span><br><span class="line">    <span class="comment"># 这样也不会出错，但是不建议这样来做</span></span><br><span class="line">    <span class="comment"># author_detail = models.ForeignKey(unique=True)</span></span><br><span class="line">    author_detail = models.OneToOneField(to=<span class="string">"AuthorDetail"</span>, to_field=<span class="string">"id"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthorDetail</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    id = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    phone = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    address = models.CharField(max_length=<span class="number">55</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    id = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    price = models.DecimalField(max_digits=<span class="number">5</span>, decimal_places=<span class="number">2</span>)</span><br><span class="line">    publish = models.ForeignKey(to=<span class="string">"Publish"</span>, to_field=<span class="string">"id"</span>)</span><br><span class="line">    authors = models.ManyToManyField(to=<span class="string">"Author"</span>)</span><br></pre></td></tr></table></figure>
<h4 id="1-一对多的增删改"><a href="#1-一对多的增删改" class="headerlink" title="1.一对多的增删改"></a>1.一对多的增删改</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>一对多的新增数据</span><br><span class="line">    <span class="comment">#one 直接传id</span></span><br><span class="line">    ret = Book.objects.create(name=<span class="string">"红楼梦"</span>, price=<span class="number">33.5</span>, publish_id=<span class="number">2</span>)</span><br><span class="line">    print(ret.name)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#two 传对象,传到数据库中还是id</span></span><br><span class="line">    pk是主键自动去表中寻找对应的主键</span><br><span class="line">    publish = Publish.objects.get(pk=<span class="number">1</span>)</span><br><span class="line">    ret = Book.objects.create(name=<span class="string">'西游记'</span>, price=<span class="number">99</span>, publish=publish)</span><br><span class="line">    print(ret)</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>一对多的删除数据 delete方法，模型对象或者queryset对象</span><br><span class="line">    <span class="comment">#one</span></span><br><span class="line">    ret = Book.objects.filter(name=<span class="string">'西游记'</span>).first().delete()</span><br><span class="line">    print(ret) </span><br><span class="line"></span><br><span class="line">    <span class="comment">#two</span></span><br><span class="line">    ret = Book.objects.filter(name=<span class="string">"西游记"</span>).delete()</span><br><span class="line">    print(ret)</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>一对多更新数据 update方法，或者模型对象修改属性，然后save</span><br><span class="line">    <span class="comment">#one</span></span><br><span class="line">    ret = Book.objects.filter(name=<span class="string">"西游记"</span>).update(publish_id= <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#two</span></span><br><span class="line">    book = Book.objects.filter(name=<span class="string">"红楼梦"</span>).first()</span><br><span class="line">    book.publish_id = <span class="number">1</span></span><br><span class="line">    book.save()</span><br></pre></td></tr></table></figure>
<h4 id="2-多对多的增删改"><a href="#2-多对多的增删改" class="headerlink" title="2.多对多的增删改"></a>2.多对多的增删改</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>多对多的增删改</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.增 add（）里面可以是对象，或者是pk</span></span><br><span class="line">    <span class="comment"># one 对象</span></span><br><span class="line">    aaa = Author.objects.filter(name=<span class="string">'aaa'</span>).first()</span><br><span class="line">    bbb = Author.objects.filter(name=<span class="string">'bbb'</span>).first()</span><br><span class="line">    book = Book.objects.filter(name=<span class="string">'红楼梦'</span>).first()</span><br><span class="line">    ret = book.authors.add(aaa, bbb)</span><br><span class="line">    print(ret)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># two 添加pk</span></span><br><span class="line">    book = Book.objects.filter(name=<span class="string">"金瓶梅"</span>).first().authors.add(<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.删 remove() 里面可以是对象，或者id</span></span><br><span class="line">    <span class="comment"># one 对象	</span></span><br><span class="line">    aaa = Author.objects.filter(name=<span class="string">'aaa'</span>).first()</span><br><span class="line">    book = Book.objects.filter(name=<span class="string">'红楼梦'</span>).first()</span><br><span class="line">    ret = book.authors.remove(aaa)</span><br><span class="line">    print(ret)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># two id</span></span><br><span class="line">    book = Book.objects.filter(name=<span class="string">'金瓶梅'</span>).first().authors.remove(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#  clear() 清空所有</span></span><br><span class="line">	book = Book.objects.filter(name=<span class="string">"金瓶梅"</span>).first().authors.clear()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.改 set([iter]) 里面是一个可迭代的对象，对象里面可以放模型对象，或者id，先清空再添加</span></span><br><span class="line">	book = Book.objects.filter(name=<span class="string">'金瓶梅'</span>).first().authors.set([<span class="number">3</span>, <span class="number">4</span>])</span><br></pre></td></tr></table></figure>
<h4 id="3-一对一的增删改"><a href="#3-一对一的增删改" class="headerlink" title="3.一对一的增删改"></a>3.一对一的增删改</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="4-基于对象的跨表查询"><a href="#4-基于对象的跨表查询" class="headerlink" title="4.基于对象的跨表查询"></a>4.基于对象的跨表查询</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>一对一</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">一对一</span></span><br><span class="line"><span class="string">正向 author --关联字段在author中 ---&gt;author_detail   ----按字段</span></span><br><span class="line"><span class="string">反向 author_detail --关联字段在author中 --&gt;author    ----按表名小写</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># 1.正向查询</span></span><br><span class="line">author = Author.objects.filter(name=<span class="string">"aaa"</span>).first().author_detail.phone</span><br><span class="line"><span class="comment"># AuthorDetail object /Author.objects.filter(name="aaa").first().author_detail</span></span><br><span class="line">print(author)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.反向查询</span></span><br><span class="line">author_detail = AuthorDetail.objects.filter(address=<span class="string">"北京"</span>).first().author.name</span><br><span class="line"><span class="comment"># Author object /AuthorDetail.objects.filter(address="北京").first().author</span></span><br><span class="line">print(author_detail)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>一对多 </span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">一对多</span></span><br><span class="line"><span class="string">正向 book --关联字段在book中 ---&gt;publish   ----按字段</span></span><br><span class="line"><span class="string">反向 publish --关联字段在book中 --&gt;book   ----按表名小写_set.all() queryset对象</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 正向查询</span></span><br><span class="line">book = Book.objects.filter(name=<span class="string">'金瓶梅'</span>).first().publish.name</span><br><span class="line"><span class="comment"># Publish object/Book.objects.filter(name='金瓶梅').first().publish</span></span><br><span class="line">print(book)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 反向查询</span></span><br><span class="line">publish = Publish.objects.filter(address=<span class="string">"北京"</span>).first().book_set.all().values(<span class="string">"name"</span>)</span><br><span class="line"><span class="comment"># &lt;QuerySet [&lt;Book: Book object&gt;, &lt;Book: Book object&gt;]&gt;/Publish.objects.filter(address="北京").first().book_set.all()</span></span><br><span class="line">print(publish)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.</span>多对多</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">多对多:都得用all()</span></span><br><span class="line"><span class="string">正向 book --关联字段在book中 ---&gt;author   ----按字段.all()</span></span><br><span class="line"><span class="string">反向 author --关联字段在book中 --&gt;book   ----按表名小写_set.all() queryset对象</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 正向查询</span></span><br><span class="line">book = Book.objects.filter(name=<span class="string">"红楼梦"</span>).first().authors.all().values(<span class="string">"name"</span>)</span><br><span class="line"><span class="comment"># &lt;QuerySet [&#123;'name': 'bbb'&#125;, &#123;'name': 'ddd'&#125;]&gt;/Book.objects.filter(name="红楼梦").first().authors.all()</span></span><br><span class="line">print(book)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 反向查询</span></span><br><span class="line">author = Author.objects.filter(name=<span class="string">"ddd"</span>).first().book_set.all().values(<span class="string">"name"</span>)</span><br><span class="line"><span class="comment"># &lt;QuerySet [&#123;'name': '红楼梦'&#125;, &#123;'name': '金瓶梅'&#125;]&gt;/Author.objects.filter(name="ddd").first().book_set.all()</span></span><br><span class="line">print(author)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连续跨表</span></span><br><span class="line"><span class="comment"># 查询地址是北京的作者写过的的书的出版社的名字 杭州出版社</span></span><br><span class="line">author_detail = AuthorDetail.objects.filter(address=<span class="string">"北京"</span>).all()</span><br><span class="line">list_item = []</span><br><span class="line"><span class="keyword">for</span> author_d <span class="keyword">in</span> author_detail:</span><br><span class="line">    books = author_d.author.book_set.all()</span><br><span class="line">    print(books)</span><br><span class="line">    list_name = [book.publish.name <span class="keyword">for</span> book <span class="keyword">in</span> books]</span><br><span class="line">    list_item.append(list_name)</span><br><span class="line">print(list_item)</span><br></pre></td></tr></table></figure>
<h4 id="5-基于双下划线的连表查询"><a href="#5-基于双下划线的连表查询" class="headerlink" title="5.基于双下划线的连表查询"></a>5.基于双下划线的连表查询</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>一对一：基于双下划线的查询（连接查询inner left right union）</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以Author表作为基表</span></span><br><span class="line">ret = Author.objects.filter(name=<span class="string">"aaa"</span>).values(<span class="string">"author_detail__phone"</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以AuthorDetail表作为基表</span></span><br><span class="line">ret = AuthorDetail.objects.filter(author__name=<span class="string">'aaa'</span>).values(<span class="string">"phone"</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正向</span></span><br><span class="line">ret = Author.objects.filter(name=<span class="string">"bbb"</span>).values(<span class="string">'sex'</span>, <span class="string">'author_detail__phone'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 反向</span></span><br><span class="line">ret = AuthorDetail.objects.filter(phone=<span class="string">'9999999'</span>).values(<span class="string">'author__sex'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line">ret = Author.objects.filter(author_detail__phone=<span class="string">'9999999'</span>).values(<span class="string">'sex'</span>)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>基于双下划线的一对多的连表查询（出版社 -- book）</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询出版社为北京出版社出版的所有图书的名字,价格--(反向查 按表名小写)</span></span><br><span class="line">ret = Publish.objects.filter(name=<span class="string">"北京出版社"</span>).values(<span class="string">'book__name'</span>, <span class="string">'book__price'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"><span class="comment"># 正向查 按字段</span></span><br><span class="line">ret = Book.objects.filter(publish__name=<span class="string">'北京出版社'</span>).values(<span class="string">'name'</span>, <span class="string">'price'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询北京出版社出版的价格大于19的书--(反向查 按表名小写)</span></span><br><span class="line">ret = Publish.objects.filter(name=<span class="string">'北京出版社'</span>, book__price__gt=<span class="number">19</span>).values(<span class="string">'book__name'</span>, <span class="string">"book__price"</span>)</span><br><span class="line">print(ret)</span><br><span class="line"><span class="comment"># 正向查 按字段</span></span><br><span class="line">ret = Book.objects.filter(publish__name=<span class="string">'北京出版社'</span>, price__gt=<span class="number">19</span>).values(<span class="string">'name'</span>, <span class="string">'price'</span>)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.</span>基于双下划线的多对多的连表查询(book -- author)</span><br><span class="line"></span><br><span class="line">eg:查询红楼梦的所有作者</span><br><span class="line"><span class="comment"># 正向 按字段</span></span><br><span class="line">ret = Book.objects.all().filter(name=<span class="string">'红楼梦'</span>).values(<span class="string">'authors__name'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"><span class="comment"># 反向 按表名小写</span></span><br><span class="line">ret = Author.objects.all().filter(book__name=<span class="string">'红楼梦'</span>).values(<span class="string">'name'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line">eg:	查询图书价格大于<span class="number">30</span>的所有作者名字</span><br><span class="line"><span class="comment"># 正向 按字段</span></span><br><span class="line">ret = Book.objects.all().filter(price__gt=<span class="number">30</span>).values(<span class="string">'authors__name'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"><span class="comment"># 反向 按表名</span></span><br><span class="line">ret = Author.objects.all().filter(book__price__gt=<span class="number">30</span>).values(<span class="string">'name'</span>)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4.</span>连续跨表（进阶版）</span><br><span class="line">注意：连续跨表的本质是将所有需要关联的表连接在一起，没有效率之分</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询北京出版社出版过的所有书籍的名字以及作者的姓名和电话（五表联查）</span></span><br><span class="line">ret = Publish.objects.all().filter(name=<span class="string">"北京出版社"</span>).values(<span class="string">'book__name'</span>, <span class="string">'book__authors__name'</span>,<span class="string">'book__authors__author_detail__phone'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line">ret = Book.objects.all().filter(publish__name=<span class="string">"北京出版社"</span>).values(<span class="string">'name'</span>, <span class="string">'authors__name'</span>,<span class="string">'authors__author_detail__phone'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 手机号以138开头的作者出版过的所有书籍名称以及出版社名称</span></span><br><span class="line">ret = AuthorDetail.objects.all().filter(phone__startswith=<span class="string">'138'</span>).values(<span class="string">'author__name'</span>, <span class="string">'author__book__name'</span>,<span class="string">'author__book__publish__name'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line">ret = Book.objects.all().filter(authors__author_detail__phone__startswith=<span class="string">"138"</span>).values(<span class="string">'authors__name'</span>, <span class="string">'name'</span>,<span class="string">'publish__name'</span>)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<h4 id="6-聚合查询aggregate-–-Avg-Count-Max-Min-Sum"><a href="#6-聚合查询aggregate-–-Avg-Count-Max-Min-Sum" class="headerlink" title="6.聚合查询aggregate –(Avg, Count, Max, Min, Sum)"></a>6.聚合查询aggregate –(Avg, Count, Max, Min, Sum)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 聚合查询aggregate 是queryset终止子句</span></span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Avg, Count, Max, Min, Sum</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算所有图书的平均价格</span></span><br><span class="line">ret = Book.objects.all().aggregate(Avg(<span class="string">'price'</span>))</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算图书中最高的价格</span></span><br><span class="line">ret = Book.objects.all().aggregate(Max(<span class="string">"price"</span>))</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算图书的最高价格,最低价格,平均价格,总价</span></span><br><span class="line">ret = Book.objects.all().aggregate(Max(<span class="string">'price'</span>), Min(<span class="string">"price"</span>), Sum(<span class="string">"price"</span>), Count(<span class="string">"pk"</span>))</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<h4 id="7-分组查询annotate"><a href="#7-分组查询annotate" class="headerlink" title="7.分组查询annotate ()"></a>7.分组查询annotate ()</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">总结终极版本</span><br><span class="line">    values在前,表示group by 在后,表示取值</span><br><span class="line">    filter在前,表示where条件,在后表示having</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分组查询annotate</span></span><br><span class="line"><span class="comment"># 统计每一本书的作者的个数</span></span><br><span class="line">ret = Book.objects.all().annotate(c=Count(<span class="string">"authors"</span>)).values(<span class="string">'name'</span>, <span class="string">'c'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计每一个出版社的最便宜的书(以谁group by 就以谁为基表)</span></span><br><span class="line">ret = Publish.objects.all().annotate(m=Min(<span class="string">'book__price'</span>)).values(<span class="string">'name'</span>, <span class="string">'m'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计每一本以王结尾的书籍的作者个数</span></span><br><span class="line">ret = Book.objects.all().filter(name__endswith=<span class="string">"王"</span>).annotate(c=Count(<span class="string">'authors'</span>)).values(<span class="string">"name"</span>, <span class="string">'c'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询各个作者出的书的总价格</span></span><br><span class="line">ret = Author.objects.all().annotate(s=Sum(<span class="string">'book__price'</span>)).values(<span class="string">'name'</span>, <span class="string">'s'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询名字叫lqz作者书的总价格</span></span><br><span class="line">ret = Author.objects.all().filter(name=<span class="string">"lqz"</span>).annotate(s=Sum(<span class="string">'book__price'</span>)).values(<span class="string">'name'</span>, <span class="string">'s'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询所有作者写的书的总价格大于30</span></span><br><span class="line">ret = Author.objects.all().annotate(s=Sum(<span class="string">"book__price"</span>)).filter(s__gt=<span class="number">30</span>).values(<span class="string">'name'</span>,<span class="string">'s'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计不止一个作者的图书</span></span><br><span class="line">ret = Book.objects.all().values(<span class="string">'pk'</span>).annotate(c=Count(<span class="string">'authors'</span>)).filter(c__gt=<span class="number">1</span>).values(<span class="string">'name'</span>,<span class="string">'c'</span>)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<h4 id="8-F函数-同一张表中的2个字段作比较"><a href="#8-F函数-同一张表中的2个字段作比较" class="headerlink" title="8.F函数:同一张表中的2个字段作比较"></a>8.F函数:同一张表中的2个字段作比较</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>导入此模块</span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># F函数 </span></span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询评论数大于阅读数的书</span></span><br><span class="line">ret = Book.objects.all().filter(commit_num__gt=F(<span class="string">'read_num'</span>)).values(<span class="string">'name'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把所有书的评论数加1</span></span><br><span class="line">ret = Book.objects.all().update(commit_num=F(<span class="string">'commit_num'</span>) + <span class="number">1</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把红楼梦这本书的阅读数减5</span></span><br><span class="line">ret = Book.objects.all().filter(name=<span class="string">'红楼梦'</span>).update(commit_num=F(<span class="string">'commit_num'</span>)<span class="number">-5</span>)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<h4 id="9-Q函数：与或非（-amp-）"><a href="#9-Q函数：与或非（-amp-）" class="headerlink" title="9.Q函数：与或非（&amp;|~）"></a>9.Q函数：与或非（&amp;|~）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>导入此模块</span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 查询作者名字是lqz或者名字是zcg的书</span></span><br><span class="line">ret = Book.objects.all().filter(Q(authors__name=<span class="string">'lqz'</span>) | Q(authors__name=<span class="string">'zcg'</span>)).values(<span class="string">'name'</span>, <span class="string">'authors__name'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询作者不是lqz的书</span></span><br><span class="line">ret = Book.objects.all().filter(~Q(authors__name=<span class="string">'lqz'</span>)).values(<span class="string">'name'</span>, <span class="string">'authors__name'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建很复杂的逻辑，需要用括号来区分</span></span><br><span class="line">ret = Book.objects.all().filter((Q(name=<span class="string">'红楼梦'</span>) &amp; Q(price__gt=<span class="string">'100'</span>)) | Q(pk__gt=<span class="number">2</span>)).values()</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<h3 id="day9"><a href="#day9" class="headerlink" title="day9"></a>day9</h3><h4 id="1-ORM常用字段"><a href="#1-ORM常用字段" class="headerlink" title="1.ORM常用字段"></a>1.ORM常用字段</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="2-ORM不常用的字段"><a href="#2-ORM不常用的字段" class="headerlink" title="2.ORM不常用的字段"></a>2.ORM不常用的字段</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">AutoField(Field)</span><br><span class="line">        - int自增列，必须填入参数 primary_key=<span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    BigAutoField(AutoField)</span><br><span class="line">        - bigint自增列，必须填入参数 primary_key=<span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        注：当model中如果没有自增列，则自动会创建一个列名为id的列</span><br><span class="line">        <span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">            <span class="comment"># 自动创建一个列名为id的且为自增的整数列</span></span><br><span class="line">            username = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Group</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">            <span class="comment"># 自定义自增列</span></span><br><span class="line">            nid = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">            name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    SmallIntegerField(IntegerField):</span><br><span class="line">        - 小整数 <span class="number">-32768</span> ～ <span class="number">32767</span></span><br><span class="line"></span><br><span class="line">    PositiveSmallIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)</span><br><span class="line">        - 正小整数 <span class="number">0</span> ～ <span class="number">32767</span></span><br><span class="line">    IntegerField(Field)</span><br><span class="line">        - 整数列(有符号的) <span class="number">-2147483648</span> ～ <span class="number">2147483647</span></span><br><span class="line"></span><br><span class="line">    PositiveIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)</span><br><span class="line">        - 正整数 <span class="number">0</span> ～ <span class="number">2147483647</span></span><br><span class="line"></span><br><span class="line">    BigIntegerField(IntegerField):</span><br><span class="line">        - 长整型(有符号的) <span class="number">-9223372036854775808</span> ～ <span class="number">9223372036854775807</span></span><br><span class="line"></span><br><span class="line">    BooleanField(Field)</span><br><span class="line">        - 布尔值类型</span><br><span class="line"></span><br><span class="line">    NullBooleanField(Field):</span><br><span class="line">        - 可以为空的布尔值</span><br><span class="line"></span><br><span class="line">    CharField(Field)</span><br><span class="line">        - 字符类型</span><br><span class="line">        - 必须提供max_length参数， max_length表示字符长度</span><br><span class="line"></span><br><span class="line">    TextField(Field)</span><br><span class="line">        - 文本类型</span><br><span class="line"></span><br><span class="line">    EmailField(CharField)：</span><br><span class="line">        - 字符串类型，Django Admin以及ModelForm中提供验证机制</span><br><span class="line"></span><br><span class="line">    IPAddressField(Field)</span><br><span class="line">        - 字符串类型，Django Admin以及ModelForm中提供验证 IPV4 机制</span><br><span class="line"></span><br><span class="line">    GenericIPAddressField(Field)</span><br><span class="line">        - 字符串类型，Django Admin以及ModelForm中提供验证 Ipv4和Ipv6</span><br><span class="line">        - 参数：</span><br><span class="line">            protocol，用于指定Ipv4或Ipv6， <span class="string">'both'</span>,<span class="string">"ipv4"</span>,<span class="string">"ipv6"</span></span><br><span class="line">            unpack_ipv4， 如果指定为<span class="literal">True</span>，则输入::ffff:<span class="number">192.0</span><span class="number">.2</span><span class="number">.1</span>时候，可解析为<span class="number">192.0</span><span class="number">.2</span><span class="number">.1</span>，开启此功能，需要protocol=<span class="string">"both"</span></span><br><span class="line"></span><br><span class="line">    URLField(CharField)</span><br><span class="line">        - 字符串类型，Django Admin以及ModelForm中提供验证 URL</span><br><span class="line"></span><br><span class="line">    SlugField(CharField)</span><br><span class="line">        - 字符串类型，Django Admin以及ModelForm中提供验证支持 字母、数字、下划线、连接符（减号）</span><br><span class="line"></span><br><span class="line">    CommaSeparatedIntegerField(CharField)</span><br><span class="line">        - 字符串类型，格式必须为逗号分割的数字</span><br><span class="line"></span><br><span class="line">    UUIDField(Field)</span><br><span class="line">        - 字符串类型，Django Admin以及ModelForm中提供对UUID格式的验证</span><br><span class="line"></span><br><span class="line">    FilePathField(Field)</span><br><span class="line">        - 字符串，Django Admin以及ModelForm中提供读取文件夹下文件的功能</span><br><span class="line">        - 参数：</span><br><span class="line">                path,                      文件夹路径</span><br><span class="line">                match=<span class="literal">None</span>,                正则匹配</span><br><span class="line">                recursive=<span class="literal">False</span>,           递归下面的文件夹</span><br><span class="line">                allow_files=<span class="literal">True</span>,          允许文件</span><br><span class="line">                allow_folders=<span class="literal">False</span>,       允许文件夹</span><br><span class="line"></span><br><span class="line">    FileField(Field)</span><br><span class="line">        - 字符串，路径保存在数据库，文件上传到指定目录</span><br><span class="line">        - 参数：</span><br><span class="line">            upload_to = <span class="string">""</span>      上传文件的保存路径</span><br><span class="line">            storage = <span class="literal">None</span>      存储组件，默认django.core.files.storage.FileSystemStorage</span><br><span class="line"></span><br><span class="line">    ImageField(FileField)</span><br><span class="line">        - 字符串，路径保存在数据库，文件上传到指定目录</span><br><span class="line">        - 参数：</span><br><span class="line">            upload_to = <span class="string">""</span>      上传文件的保存路径</span><br><span class="line">            storage = <span class="literal">None</span>      存储组件，默认django.core.files.storage.FileSystemStorage</span><br><span class="line">            width_field=<span class="literal">None</span>,   上传图片的高度保存的数据库字段名（字符串）</span><br><span class="line">            height_field=<span class="literal">None</span>   上传图片的宽度保存的数据库字段名（字符串）</span><br><span class="line"></span><br><span class="line">    DateTimeField(DateField)</span><br><span class="line">        - 日期+时间格式 YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ]</span><br><span class="line"></span><br><span class="line">    DateField(DateTimeCheckMixin, Field)</span><br><span class="line">        - 日期格式      YYYY-MM-DD</span><br><span class="line"></span><br><span class="line">    TimeField(DateTimeCheckMixin, Field)</span><br><span class="line">        - 时间格式      HH:MM[:ss[.uuuuuu]]</span><br><span class="line"></span><br><span class="line">    DurationField(Field)</span><br><span class="line">        - 长整数，时间间隔，数据库中按照bigint存储，ORM中获取的值为datetime.timedelta类型</span><br><span class="line"></span><br><span class="line">    FloatField(Field)</span><br><span class="line">        - 浮点型</span><br><span class="line"></span><br><span class="line">    DecimalField(Field)</span><br><span class="line">        - <span class="number">10</span>进制小数</span><br><span class="line">        - 参数：</span><br><span class="line">            max_digits，小数总长度</span><br><span class="line">            decimal_places，小数位长度</span><br><span class="line"></span><br><span class="line">    BinaryField(Field)</span><br><span class="line">        - 二进制类型</span><br><span class="line"></span><br><span class="line">常用和非常用字段合集</span><br></pre></td></tr></table></figure>
<h4 id="3-ORM和mysql中对应的字段关系"><a href="#3-ORM和mysql中对应的字段关系" class="headerlink" title="3.ORM和mysql中对应的字段关系"></a>3.ORM和mysql中对应的字段关系</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">对应关系：</span><br><span class="line">    <span class="string">'AutoField'</span>: <span class="string">'integer AUTO_INCREMENT'</span>,</span><br><span class="line">    <span class="string">'BigAutoField'</span>: <span class="string">'bigint AUTO_INCREMENT'</span>,</span><br><span class="line">    <span class="string">'BinaryField'</span>: <span class="string">'longblob'</span>,</span><br><span class="line">    <span class="string">'BooleanField'</span>: <span class="string">'bool'</span>,</span><br><span class="line">    <span class="string">'CharField'</span>: <span class="string">'varchar(%(max_length)s)'</span>,</span><br><span class="line">    <span class="string">'CommaSeparatedIntegerField'</span>: <span class="string">'varchar(%(max_length)s)'</span>,</span><br><span class="line">    <span class="string">'DateField'</span>: <span class="string">'date'</span>,</span><br><span class="line">    <span class="string">'DateTimeField'</span>: <span class="string">'datetime'</span>,</span><br><span class="line">    <span class="string">'DecimalField'</span>: <span class="string">'numeric(%(max_digits)s, %(decimal_places)s)'</span>,</span><br><span class="line">    <span class="string">'DurationField'</span>: <span class="string">'bigint'</span>,</span><br><span class="line">    <span class="string">'FileField'</span>: <span class="string">'varchar(%(max_length)s)'</span>,</span><br><span class="line">    <span class="string">'FilePathField'</span>: <span class="string">'varchar(%(max_length)s)'</span>,</span><br><span class="line">    <span class="string">'FloatField'</span>: <span class="string">'double precision'</span>,</span><br><span class="line">    <span class="string">'IntegerField'</span>: <span class="string">'integer'</span>,</span><br><span class="line">    <span class="string">'BigIntegerField'</span>: <span class="string">'bigint'</span>,</span><br><span class="line">    <span class="string">'IPAddressField'</span>: <span class="string">'char(15)'</span>,</span><br><span class="line">    <span class="string">'GenericIPAddressField'</span>: <span class="string">'char(39)'</span>,</span><br><span class="line">    <span class="string">'NullBooleanField'</span>: <span class="string">'bool'</span>,</span><br><span class="line">    <span class="string">'OneToOneField'</span>: <span class="string">'integer'</span>,</span><br><span class="line">    <span class="string">'PositiveIntegerField'</span>: <span class="string">'integer UNSIGNED'</span>,</span><br><span class="line">    <span class="string">'PositiveSmallIntegerField'</span>: <span class="string">'smallint UNSIGNED'</span>,</span><br><span class="line">    <span class="string">'SlugField'</span>: <span class="string">'varchar(%(max_length)s)'</span>,</span><br><span class="line">    <span class="string">'SmallIntegerField'</span>: <span class="string">'smallint'</span>,</span><br><span class="line">    <span class="string">'TextField'</span>: <span class="string">'longtext'</span>,</span><br><span class="line">    <span class="string">'TimeField'</span>: <span class="string">'time'</span>,</span><br><span class="line">    <span class="string">'UUIDField'</span>: <span class="string">'char(32)'</span>,</span><br></pre></td></tr></table></figure>
<h4 id="4-ORM字段参数"><a href="#4-ORM字段参数" class="headerlink" title="4.ORM字段参数"></a>4.ORM字段参数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">null</span><br><span class="line">用于表示某个字段可以为空。</span><br><span class="line"></span><br><span class="line">unique</span><br><span class="line">如果设置为unique=<span class="literal">True</span> 则该字段在此表中必须是唯一的 。</span><br><span class="line"></span><br><span class="line">db_index</span><br><span class="line">如果db_index=<span class="literal">True</span> 则代表着为此字段设置索引。</span><br><span class="line"></span><br><span class="line">default</span><br><span class="line">为该字段设置默认值。</span><br><span class="line"></span><br><span class="line">DateField和DateTimeField</span><br><span class="line">auto_now_add</span><br><span class="line">配置auto_now_add=<span class="literal">True</span>，创建数据记录的时候会把当前时间添加到数据库。</span><br><span class="line"></span><br><span class="line">auto_now</span><br><span class="line">配置上auto_now=<span class="literal">True</span>，每次更新数据记录的时候会更新该字段。</span><br></pre></td></tr></table></figure>
<h4 id="5-关系字段"><a href="#5-关系字段" class="headerlink" title="5.关系字段"></a>5.关系字段</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>ForeignKey</span><br><span class="line">外键类型在ORM中用来表示外键关联关系，一般把ForeignKey字段设置在 <span class="string">'一对多'</span>中<span class="string">'多'</span>的一方。</span><br><span class="line"></span><br><span class="line">ForeignKey可以和其他表做关联关系同时也可以和自身做关联关系。</span><br><span class="line"></span><br><span class="line">to</span><br><span class="line">设置要关联的表</span><br><span class="line"></span><br><span class="line">to_field</span><br><span class="line">设置要关联的表的字段</span><br><span class="line"></span><br><span class="line">related_name</span><br><span class="line">反向操作时，使用的字段名，用于代替原反向查询时的<span class="string">'表名_set'</span>。</span><br><span class="line"></span><br><span class="line">on_delete</span><br><span class="line">　　当删除关联表中的数据时，当前表与其关联的行的行为。</span><br><span class="line"></span><br><span class="line">　　models.CASCADE</span><br><span class="line">　　删除关联数据，与之关联也删除</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">　　models.DO_NOTHING</span><br><span class="line">　　删除关联数据，引发错误IntegrityError</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">　　models.PROTECT</span><br><span class="line">　　删除关联数据，引发错误ProtectedError</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">　　models.SET_NULL</span><br><span class="line">　　删除关联数据，与之关联的值设置为null（前提FK字段需要设置为可空）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">　　models.SET_DEFAULT</span><br><span class="line">　　删除关联数据，与之关联的值设置为默认值（前提FK字段需要设置默认值）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">　　models.SET</span><br><span class="line"></span><br><span class="line">　　删除关联数据，</span><br><span class="line">　　a. 与之关联的值设置为指定值，设置：models.SET(值)</span><br><span class="line">　　b. 与之关联的值设置为可执行对象的返回值，设置：models.SET(可执行对象)</span><br><span class="line">    </span><br><span class="line">db_constraint</span><br><span class="line">是否在数据库中创建外键约束，默认为<span class="literal">True</span>。</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>OneToOneField</span><br><span class="line">一对一字段。</span><br><span class="line"></span><br><span class="line">通常一对一字段用来扩展已有字段。</span><br><span class="line"></span><br><span class="line">一对一的关联关系多用在当一张表的不同字段查询频次差距过大的情况下，将本可以存储在一张表的字段拆开放置在两张表中，然后将两张表建立一对一的关联关系。</span><br><span class="line"></span><br><span class="line">to</span><br><span class="line">设置要关联的表。</span><br><span class="line"></span><br><span class="line">to_field</span><br><span class="line">设置要关联的字段。</span><br><span class="line"></span><br><span class="line">on_delete</span><br><span class="line">同ForeignKey字段。</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.</span>ManyToManyField</span><br><span class="line">用于表示多对多的关联关系。在数据库中通过第三张表来建立关联关系</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">through</span><br><span class="line">在使用ManyToManyField字段时，Django将自动生成一张表来管理多对多的关联关系。</span><br><span class="line"></span><br><span class="line">但我们也可以手动创建第三张表来管理多对多关系，此时就需要通过through来指定第三张表的表名。</span><br><span class="line"></span><br><span class="line">through_fields</span><br><span class="line">设置关联的字段。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">db_table</span><br><span class="line">默认创建第三张表时，数据库中表的名称。</span><br></pre></td></tr></table></figure>
<h4 id="6-元信息"><a href="#6-元信息" class="headerlink" title="6.元信息"></a>6.元信息</h4><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ORM对应的类里面包含另一个Meta类，而Meta类封装了一些数据库的信息。主要字段如下:</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">db_table</span></span><br><span class="line"><span class="keyword">ORM在数据库中的表名默认是 </span>app_类名，可以通过db_table可以重写表名。</span><br><span class="line"></span><br><span class="line">index_together</span><br><span class="line">联合索引。</span><br><span class="line"></span><br><span class="line">unique_together</span><br><span class="line">联合唯一索引。</span><br><span class="line"></span><br><span class="line"><span class="keyword">ordering</span></span><br><span class="line"><span class="keyword">指定默认按什么字段排序。</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">只有设置了该属性，我们查询到的结果才可以被reverse()。</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">实例：</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">        nid = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">        username = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">            <span class="comment"># 数据库中生成的表名称 默认 app名称 + 下划线 + 类名</span></span><br><span class="line">            db_table = <span class="string">"table_name"</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 联合索引</span></span><br><span class="line">            index_together = [</span><br><span class="line">                (<span class="string">"pub_date"</span>, <span class="string">"deadline"</span>),</span><br><span class="line">            ]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 联合唯一索引</span></span><br><span class="line">            unique_together = ((<span class="string">"driver"</span>, <span class="string">"restaurant"</span>),)</span><br><span class="line">            </span><br><span class="line">            ordering = (<span class="string">'name'</span>,)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># admin中显示的表名称</span></span><br><span class="line">            verbose_name=<span class="string">'哈哈'</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># verbose_name加s</span></span><br><span class="line">            verbose_name_plural=verbose_name</span><br></pre></td></tr></table></figure>
<h4 id="7-自定义字段-了解"><a href="#7-自定义字段-了解" class="headerlink" title="7.自定义字段(了解)"></a>7.自定义字段(了解)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">自定义char类型字段：</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FixedCharField</span><span class="params">(models.Field)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    自定义的char类型的字段类</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, max_length, *args, **kwargs)</span>:</span></span><br><span class="line">        self.max_length = max_length</span><br><span class="line">        super(FixedCharField, self).__init__(max_length=max_length, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">db_type</span><span class="params">(self, connection)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        限定生成数据库表的字段类型为char，长度为max_length指定的值</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'char(%s)'</span> % self.max_length</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Class</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    id = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    title = models.CharField(max_length=<span class="number">25</span>)</span><br><span class="line">    <span class="comment"># 使用自定义的char类型的字段</span></span><br><span class="line">    cname = FixedCharField(max_length=<span class="number">25</span>)</span><br></pre></td></tr></table></figure>
<h4 id="8-多对多关联关系三种创建方式"><a href="#8-多对多关联关系三种创建方式" class="headerlink" title="8.多对多关联关系三种创建方式"></a>8.多对多关联关系三种创建方式</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">方式一：自行创建第三张表</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">32</span>, verbose_name=<span class="string">"书名"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>, verbose_name=<span class="string">"作者姓名"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自己创建第三张表，分别通过外键关联书和作者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author2Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    author = models.ForeignKey(to=<span class="string">"Author"</span>)</span><br><span class="line">    book = models.ForeignKey(to=<span class="string">"Book"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        unique_together = (<span class="string">"author"</span>, <span class="string">"book"</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">方式二：通过ManyToManyField自动创建</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">32</span>, verbose_name=<span class="string">"书名"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过ORM自带的ManyToManyField自动创建第三张表</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>, verbose_name=<span class="string">"作者姓名"</span>)</span><br><span class="line">    books = models.ManyToManyField(to=<span class="string">"Book"</span>, related_name=<span class="string">"authors"</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">方式三：设置ManyToManyField并指定自己创建的第三张表</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">32</span>, verbose_name=<span class="string">"书名"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自己创建第三张表，并通过ManyToManyField指定关联</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>, verbose_name=<span class="string">"作者姓名"</span>)</span><br><span class="line">    books = models.ManyToManyField(to=<span class="string">"Book"</span>, through=<span class="string">"Author2Book"</span>, through_fields=(<span class="string">"author"</span>, <span class="string">"book"</span>))</span><br><span class="line">    <span class="comment"># through_fields接受一个2元组（'field1'，'field2'）：</span></span><br><span class="line">    <span class="comment"># 其中field1是定义ManyToManyField的模型外键的名（author），field2是关联目标模型（book）的外键名。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author2Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    author = models.ForeignKey(to=<span class="string">"Author"</span>)</span><br><span class="line">    book = models.ForeignKey(to=<span class="string">"Book"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        unique_together = (<span class="string">"author"</span>, <span class="string">"book"</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line"></span><br><span class="line">当我们需要在第三张关系表中存储额外的字段时，就要使用第三种方式。</span><br><span class="line"></span><br><span class="line">但是当我们使用第三种方式创建多对多关联关系时，就无法使用<span class="keyword">set</span>、<span class="keyword">add</span>、remove、<span class="keyword">clear</span>方法来管理多对多的关系了，需要通过第三张表的<span class="keyword">model</span>来管理多对多关系。</span><br></pre></td></tr></table></figure>
<h3 id="day10"><a href="#day10" class="headerlink" title="day10"></a>day10</h3><h4 id="1-inclusion-tag"><a href="#1-inclusion-tag" class="headerlink" title="1.inclusion_tag"></a>1.inclusion_tag</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>作用</span><br><span class="line">	生成html的片段（动态，传参数，传数据）</span><br><span class="line"><span class="number">2.</span>使用</span><br><span class="line">	<span class="number">2.1</span> mytag中</span><br><span class="line"><span class="meta">		@inclusion_tag('模板路径',name='重命名')</span></span><br><span class="line">		<span class="function"><span class="keyword">def</span> <span class="title">my_in</span><span class="params">()</span>:</span>  不写,写多个,不写不传,写多个,按空格来传参</span><br><span class="line">			一堆逻辑处理,查数据库</span><br><span class="line">			ret=Book.objects.all()</span><br><span class="line">			<span class="keyword">return</span> &#123;<span class="string">'books'</span>:ret&#125;</span><br><span class="line">        </span><br><span class="line">    <span class="number">2.2</span> 模板中</span><br><span class="line">    	可以用books这个变量,渲染页面</span><br><span class="line">        </span><br><span class="line">    <span class="number">2.3</span> 在需要展示的模板中</span><br><span class="line">    	&#123;%load mytag %&#125;</span><br><span class="line">		&#123;% my_in 参数 %&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-defer-only（数据库优化）"><a href="#2-defer-only（数据库优化）" class="headerlink" title="2.defer/only（数据库优化）"></a>2.defer/only（数据库优化）</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">defer----&gt;除了指定字段之外</span><br><span class="line">only----&gt;只查询几个字段</span><br><span class="line">比如<span class="symbol">:ret=Book</span>.object.all().only(<span class="string">'name'</span>)  id始终会查</span><br><span class="line">结果是queryset对象,套book对象</span><br><span class="line"></span><br><span class="line">问<span class="symbol">:</span>如果取price,发生了什么?</span><br><span class="line">	它会再次查询数据库,对数据库造成压力</span><br></pre></td></tr></table></figure>
<h4 id="3-事务-原子性操作"><a href="#3-事务-原子性操作" class="headerlink" title="3.事务(原子性操作)"></a>3.事务(原子性操作)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transition</span><br><span class="line"><span class="keyword">with</span> transition.atomic():</span><br><span class="line">    sql1</span><br><span class="line">    sql2</span><br></pre></td></tr></table></figure>
<h4 id="4-choice"><a href="#4-choice" class="headerlink" title="4.choice"></a>4.choice</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">模型表中某个字段,可以指定choice,用在选择不经常变的情况,经常变,尽量用数据库</span><br><span class="line"></span><br><span class="line">mychoice=((<span class="number">1</span>,<span class="string">'男'</span>),(<span class="number">2</span>,<span class="string">'女'</span>),(<span class="number">3</span>,<span class="string">'其他'</span>)) </span><br><span class="line">dd = models.ForeignKey(choices=mychoice)</span><br><span class="line"></span><br><span class="line">get_dd_display()  视图中</span><br><span class="line">get_dd_dispaly 模板中</span><br></pre></td></tr></table></figure>
<h3 id="day11"><a href="#day11" class="headerlink" title="day11"></a>day11</h3><h4 id="1-ajax组件"><a href="#1-ajax组件" class="headerlink" title="1.ajax组件"></a>1.ajax组件</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>什么是ajax</span><br><span class="line">	异步的JavaScript和xml,跟后台交互,都用json</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>有什么用</span><br><span class="line">	前后端做数据交互</span><br><span class="line"><span class="number">3.</span>特点</span><br><span class="line">	异步(异步和同步的区别:同步是请求发过去,要等着回应;异步:不需要等回应,可以进行其他操作)</span><br><span class="line">	</span><br><span class="line">	局部刷新：不影响其他页面内容</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>如何用：基本使用</span><br><span class="line"></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    url:<span class="string">'/index/'</span>,</span><br><span class="line">    type:<span class="string">'post'</span>,</span><br><span class="line">    <span class="comment">//data:往后台提交的数据</span></span><br><span class="line">    data:&#123;<span class="string">'name'</span>:<span class="string">'lqz'</span>,<span class="string">'age'</span>:<span class="number">18</span>&#125;,</span><br><span class="line">    <span class="comment">//成功的时候回调这个函数</span></span><br><span class="line">    success:<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    	alert(data)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-通过ajax上传文件"><a href="#2-通过ajax上传文件" class="headerlink" title="2.通过ajax上传文件"></a>2.通过ajax上传文件</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>模板层</span><br><span class="line"></span><br><span class="line">$(<span class="string">"#btn"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//上传文件,必须用FormData,生产一个formdata对象</span></span><br><span class="line">    <span class="keyword">var</span> formdata=<span class="keyword">new</span> FormData();</span><br><span class="line">    formdata.append(<span class="string">'name'</span>,$(<span class="string">"#name"</span>).val());</span><br><span class="line">    <span class="comment">//取出文件$("#myfile")[0].files拿到的是文件列表,取第0个把具体的文件取出来</span></span><br><span class="line">    formdata.append(<span class="string">'myfile'</span>,$(<span class="string">"#myfile"</span>)[<span class="number">0</span>].files[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url:<span class="string">'/files_ajax/'</span>,</span><br><span class="line">        type:<span class="string">'post'</span>,</span><br><span class="line">        <span class="comment">//不预处理数据,(name=lqz&amp;age=18)</span></span><br><span class="line">        processData:<span class="literal">false</span>,</span><br><span class="line">        <span class="comment">//指定往后台传数据的编码格式(urlencoded,formdata,json)</span></span><br><span class="line">        <span class="comment">//现在用formdata对象处理了,就不需要指定编码格式了,不要给我编码了</span></span><br><span class="line">        contentType:<span class="literal">false</span>,</span><br><span class="line">        data:formdata,</span><br><span class="line">        success:<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        	alert(data)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">    </span><br><span class="line">视图层:(跟form表单上传文件完全一样)</span><br></pre></td></tr></table></figure>
<h4 id="3-基于ajax提交json格式的数据"><a href="#3-基于ajax提交json格式的数据" class="headerlink" title="3.基于ajax提交json格式的数据"></a>3.基于ajax提交json格式的数据</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>模板层</span><br><span class="line"></span><br><span class="line">$(<span class="string">'#btn'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> post_data=&#123;<span class="string">'name'</span>:$(<span class="string">"#name"</span>).val(),<span class="string">'pwd'</span>:$(<span class="string">"#pwd"</span>).val()&#125;;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">typeof</span> post_data);</span><br><span class="line">    <span class="comment">// 如何把post_data这个字典,转成json格式字符串</span></span><br><span class="line">    <span class="comment">//JSON.stringify相当于python中json.dumpus(post_data)</span></span><br><span class="line">    <span class="comment">//pos是个字符串,json格式字符串</span></span><br><span class="line">    <span class="keyword">var</span> pos=<span class="built_in">JSON</span>.stringify(post_data);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">typeof</span> pos); </span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url:<span class="string">'/json/'</span>,</span><br><span class="line">        type:<span class="string">'post'</span>,</span><br><span class="line">        data:pos,</span><br><span class="line">        contentType:<span class="string">'application/json'</span>,</span><br><span class="line">        success:<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//如果data是json格式字符串,如何转成对象(字典)?</span></span><br><span class="line">            <span class="comment">//data=JSON.parse(data)</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">typeof</span> data)</span><br><span class="line">            <span class="built_in">console</span>.log(data)</span><br><span class="line">            <span class="keyword">var</span> ret=<span class="built_in">JSON</span>.parse(data)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">typeof</span> ret)</span><br><span class="line">            <span class="built_in">console</span>.log(ret.status)</span><br><span class="line">            <span class="comment">//alert(data)</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>视图层</span><br><span class="line"></span><br><span class="line">def add_json(request):</span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">'GET'</span>:</span><br><span class="line">    	<span class="keyword">return</span> render(request,<span class="string">'json.html'</span>)</span><br><span class="line">    print(request.POST)</span><br><span class="line">    print(request.GET)</span><br><span class="line">    print(request.body) # json数据在body里面 b'...'</span><br><span class="line">    <span class="keyword">import</span> json</span><br><span class="line">    # res是个字典</span><br><span class="line">    res=json.loads(request.body.decode(<span class="string">'utf-8'</span>))</span><br><span class="line">    print(res)</span><br><span class="line">    print(type(res))</span><br><span class="line">    dic=&#123;<span class="string">'status'</span>:<span class="string">'100'</span>,<span class="string">'msg'</span>:<span class="string">'登录成功'</span>&#125;</span><br><span class="line">    # return HttpResponse('ok')</span><br><span class="line">    # 返回给前台json格式</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(json.dumps(dic))</span><br><span class="line">    # return JsonResponse(dic)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">重点：</span><br><span class="line">请求的编码方式:</span><br><span class="line">	contentType:<span class="string">'application/json'</span>,</span><br><span class="line">响应回来解析的方式：</span><br><span class="line">	dataType:<span class="string">'json'</span>,</span><br></pre></td></tr></table></figure>
<h4 id="4-基于ajax如何实现用户认证通过后的页面转跳"><a href="#4-基于ajax如何实现用户认证通过后的页面转跳" class="headerlink" title="4.基于ajax如何实现用户认证通过后的页面转跳"></a>4.基于ajax如何实现用户认证通过后的页面转跳</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">1.模板层</span><br><span class="line">login:</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    &#123;% load static %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static '/utils/jquery-3.3.1.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static '/utils/bootstrap-3.3.7-dist/css/bootstrap.css' %&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">class</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"btn"</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"ss"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="string">'#btn'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> msg = &#123;</span></span><br><span class="line"><span class="javascript">            <span class="string">'name'</span>: $(<span class="string">'.name'</span>).val(),</span></span><br><span class="line"><span class="javascript">            <span class="string">'password'</span>: $(<span class="string">'.password'</span>).val()</span></span><br><span class="line">        &#125;;</span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 不写默然超当前路径发请求</span></span></span><br><span class="line"><span class="actionscript">            url: <span class="string">''</span>,</span></span><br><span class="line"><span class="actionscript">            type: <span class="string">'post'</span>,</span></span><br><span class="line">            data: msg,</span><br><span class="line"><span class="actionscript">            dataType: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="actionscript">            success: <span class="function"><span class="keyword">function</span> <span class="params">(data)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(data);</span></span><br><span class="line"><span class="actionscript">				<span class="comment">// 错误信息，直接login页面渲染</span></span></span><br><span class="line"><span class="actionscript">                <span class="keyword">if</span> (data.status === <span class="string">'100'</span>) &#123;</span></span><br><span class="line"><span class="javascript">                    $(<span class="string">'.ss'</span>).text(data.data);</span></span><br><span class="line">                &#125;</span><br><span class="line"><span class="actionscript">                <span class="comment">// 登录成功，直接跳转指定页面</span></span></span><br><span class="line"><span class="actionscript">                <span class="keyword">if</span> (data.status === <span class="string">'101'</span>) &#123;</span></span><br><span class="line"><span class="actionscript">                    location.href = <span class="string">'http://127.0.0.1:8234/order/'</span>;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">2.模板order</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>order<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    &#123;% load static %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static '/utils/jquery-3.3.1.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static '/utils/bootstrap-3.3.7-dist/css/bootstrap.css' %&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container-fluid"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-lg-6 col-lg-offset-3"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-bordered"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span> <span class="attr">id</span>=<span class="string">"head"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>商品<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>价格<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">id</span>=<span class="string">"body"</span>&gt;</span></span><br><span class="line">                &#123;% for foo in msg %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; forloop.counter &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; foo.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; foo.price &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.</span>视图</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, HttpResponse, redirect</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.utils.decorators <span class="keyword">import</span> method_decorator</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app01.models <span class="keyword">import</span> User, OrderMsg</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="meta">    @wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(request, *args, **kwargs)</span>:</span></span><br><span class="line">        url = request.get_full_path()</span><br><span class="line">        <span class="keyword">if</span> request.session.get(<span class="string">'id'</span>):</span><br><span class="line">            ret = func(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/login/?next=%s'</span> % url)</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'login.html'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        name = request.POST.get(<span class="string">'name'</span>)</span><br><span class="line">        password = request.POST.get(<span class="string">'password'</span>)</span><br><span class="line">        res = User.objects.filter(name=name, password=password).first()</span><br><span class="line">        <span class="keyword">if</span> res:</span><br><span class="line">            url = request.GET.get(<span class="string">'next'</span>)</span><br><span class="line">            print(request.GET)</span><br><span class="line">            print(request.get_full_path())</span><br><span class="line">            request.session[<span class="string">'name'</span>] = res.name</span><br><span class="line">            request.session[<span class="string">'id'</span>] = res.pk</span><br><span class="line">            <span class="keyword">if</span> url:</span><br><span class="line">                obj = JsonResponse(&#123;<span class="string">'status'</span>: <span class="string">'101'</span>, <span class="string">'url'</span>: url&#125;)</span><br><span class="line">                print(url)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                obj = JsonResponse(&#123;<span class="string">'status'</span>: <span class="string">'101'</span>, <span class="string">'url'</span>: <span class="string">'/order/'</span>&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            obj = JsonResponse(&#123;<span class="string">'data'</span>: <span class="string">'用户名或密码错误'</span>, <span class="string">'status'</span>: <span class="string">'100'</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@method_decorator(auth, name='get')</span></span><br><span class="line"><span class="meta">@method_decorator(auth, name='post')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        print(request.GET)</span><br><span class="line">        id = request.session.get(<span class="string">'id'</span>)</span><br><span class="line">        msg = OrderMsg.objects.filter(user_id=id).all().values(<span class="string">'name'</span>, <span class="string">'price'</span>)</span><br><span class="line">        print(msg)</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'order.html'</span>, locals())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'ok'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="4-视图函数通过装饰器将json数据格式自动转成python中的数据类型"><a href="#4-视图函数通过装饰器将json数据格式自动转成python中的数据类型" class="headerlink" title="4.视图函数通过装饰器将json数据格式自动转成python中的数据类型"></a>4.视图函数通过装饰器将json数据格式自动转成python中的数据类型</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="meta">    @wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(request, *args, **kwargs)</span>:</span></span><br><span class="line">        request.data = request.POST</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            request.data = json.loads(request.body.decode(<span class="string">'utf-8'</span>))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">        res = func(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br></pre></td></tr></table></figure>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line"><span class="title">json</span>格式的数据放在body体中，django不会帮我们转，我们将转过后的数据赋给变量，</span><br><span class="line"><span class="title">request</span>.<span class="class"><span class="keyword">data</span> = json.loads(<span class="title">request</span>.<span class="title">body</span>.<span class="title">decode</span>('<span class="title">utf</span>-8'))</span></span><br><span class="line"><span class="class"><span class="keyword">data</span>的属性会被我们覆盖，如果单纯通过判断<span class="type">GET</span>,<span class="type">POST</span>,body里面有没有值是有逻辑漏洞的，因为可以一个post请求过来，可以通过<span class="type">GET</span>取到路径?name=ll&amp;sex = 1的值！！</span></span><br></pre></td></tr></table></figure>
<h4 id="5-ajax路径相关问题（-）"><a href="#5-ajax路径相关问题（-）" class="headerlink" title="5.ajax路径相关问题（**）"></a>5.ajax路径相关问题（<em>**</em>）</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">js得到当前页面的url信息方法</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>，设置或获取对象指定的文件名或路径。</span><br><span class="line"></span><br><span class="line">alert(<span class="built_in">window</span>.location.pathname)  ----<span class="regexp">/login/</span></span><br><span class="line"><span class="number">2</span>，设置或获取整个 URL 为字符串。</span><br><span class="line"></span><br><span class="line">alert(<span class="built_in">window</span>.location.href);  ---- http:<span class="comment">//127.0.0.1:8234/login/?next=/order/</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>，设置或获取与 URL 关联的端口号码。</span><br><span class="line"></span><br><span class="line">alert(<span class="built_in">window</span>.location.port)   ---- <span class="number">8234</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span>，设置或获取 URL 的协议部分。</span><br><span class="line"></span><br><span class="line">alert(<span class="built_in">window</span>.location.protocol)  ---- http:</span><br><span class="line"></span><br><span class="line">5，设置或获取 href 属性中在井号“#”后面的分段。</span><br><span class="line"></span><br><span class="line">alert(<span class="built_in">window</span>.location.hash)</span><br><span class="line"></span><br><span class="line"><span class="number">6</span>，设置或获取 location 或 URL 的 hostname 和 port 号码。</span><br><span class="line"></span><br><span class="line">alert(<span class="built_in">window</span>.location.host)  ---- <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8234</span></span><br><span class="line"></span><br><span class="line"><span class="number">7</span>，设置或获取 href 属性中跟在问号后面的部分。</span><br><span class="line"></span><br><span class="line">alert(<span class="built_in">window</span>.location.search) --- ?next=<span class="regexp">/order/</span></span><br><span class="line"></span><br><span class="line"><span class="number">8</span>，获取变量的值(截取等号后面的部分)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">window</span>.location.search;</span><br><span class="line"></span><br><span class="line"><span class="comment">// alert(url.length);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// alert(url.lastIndexOf(‘=’));</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> loc = url.substring(url.lastIndexOf(‘=’)+<span class="number">1</span>, url.length);</span><br><span class="line"></span><br><span class="line"><span class="number">9</span>，用来得到当前网页的域名</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> domain = <span class="built_in">document</span>.domain; ---<span class="number">-127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line"><span class="number">10.</span></span><br><span class="line"><span class="built_in">document</span>.domain + <span class="built_in">window</span>.location.pathname + <span class="built_in">window</span>.location.search</span><br><span class="line">相当于：</span><br><span class="line"><span class="built_in">window</span>.location.href</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ajax注意提交数据和form表单的冲突</span><br><span class="line"><span class="number">1.</span>form表单不要写method = <span class="string">'post'</span></span><br><span class="line"><span class="number">2.</span>form表单内input和button提交框，一律不能type=<span class="string">'submit'</span> 可以写button可以写type = <span class="string">'button'</span></span><br><span class="line"><span class="number">3.</span>可以将提交按钮写在表单外面</span><br></pre></td></tr></table></figure>
<h4 id="6-ajax获取响应头以及自定义请求头"><a href="#6-ajax获取响应头以及自定义请求头" class="headerlink" title="6.ajax获取响应头以及自定义请求头"></a>6.ajax获取响应头以及自定义请求头</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"zh"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;登录&lt;/title&gt;</span><br><span class="line">    &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"/static/utils/bootstrap-3.3.7-dist/css/bootstrap.css"</span>&gt;</span><br><span class="line">    &lt;script src="/static/utils/jquery-3.3.1.js"&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        .code &#123;</span><br><span class="line">            border-radius: <span class="number">5</span>px;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class="container-fluid"&gt;</span><br><span class="line">    &lt;div class="row"&gt;</span><br><span class="line">        &lt;form class="form-horizontal col-lg-6 col-lg-offset-3"&gt;</span><br><span class="line">            &lt;div class="form-group"&gt;</span><br><span class="line">                &lt;label for="username" class="col-sm-2 control-label"&gt;用户名&lt;/label&gt;</span><br><span class="line">                &lt;div class="col-sm-10"&gt;</span><br><span class="line">                    &lt;input type="text" class="form-control" id="username" placeholder="User" name="username"&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class="form-group"&gt;</span><br><span class="line">                &lt;label for="password" class="col-sm-2 control-label"&gt;密码&lt;/label&gt;</span><br><span class="line">                &lt;div class="col-sm-10"&gt;</span><br><span class="line">                    &lt;input type="password" class="form-control" id="password" placeholder="Password" name="password"&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class="form-group"&gt;</span><br><span class="line">                &lt;label for="code" class="col-sm-2 control-label"&gt;验证码&lt;/label&gt;</span><br><span class="line">                &lt;div class="row"&gt;</span><br><span class="line">                    &lt;div class="col-lg-6"&gt;</span><br><span class="line">                        &lt;input type="text" class="form-control " id="code" placeholder="code" name="code"&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;img src="/get_code/" alt="" class="my_code"&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class="form-group"&gt;</span><br><span class="line">                &lt;div class="col-sm-offset-2 col-sm-10"&gt;</span><br><span class="line">                    &lt;button type="button" class="btn btn-default" id="btn"&gt;登录&lt;/button&gt;</span><br><span class="line">                    &lt;span id="msg"&gt;&lt;/span&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	// 定义一个变量</span><br><span class="line">    let header;</span><br><span class="line">    </span><br><span class="line">    // 获取头部信息，生成一个对象给header</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        type: <span class="string">'HEAD'</span>, // 获取头信息，type=HEAD即可</span><br><span class="line">        url: window.location.href,</span><br><span class="line">        complete: function (xhr, data) &#123;</span><br><span class="line">            // 获取相关Http Response header</span><br><span class="line">            header = &#123;</span><br><span class="line">                // 服务器端时间</span><br><span class="line">                <span class="string">"date"</span>: xhr.getResponseHeader(<span class="string">'Date'</span>),</span><br><span class="line">                // 如果开启了gzip，会返回这个东西</span><br><span class="line">                <span class="string">"contentEncoding"</span>: xhr.getResponseHeader(<span class="string">'Content-Encoding'</span>),</span><br><span class="line">                // keep-alive ？ close？</span><br><span class="line">                <span class="string">"connection"</span>: xhr.getResponseHeader(<span class="string">'Connection'</span>),</span><br><span class="line">                // 响应长度</span><br><span class="line">                <span class="string">"contentLength"</span>: xhr.getResponseHeader(<span class="string">'Content-Length'</span>),</span><br><span class="line">                // 服务器类型，apache？lighttpd？</span><br><span class="line">                <span class="string">"server"</span>: xhr.getResponseHeader(<span class="string">'Server'</span>),</span><br><span class="line">                <span class="string">"vary"</span>: xhr.getResponseHeader(<span class="string">'Vary'</span>),</span><br><span class="line">                <span class="string">"transferEncoding"</span>: xhr.getResponseHeader(<span class="string">'Transfer-Encoding'</span>),</span><br><span class="line">                // text/html ? text/xml?</span><br><span class="line">                <span class="string">"contentType"</span>: xhr.getResponseHeader(<span class="string">'Content-Type'</span>),</span><br><span class="line">                <span class="string">"cacheControl"</span>: xhr.getResponseHeader(<span class="string">'Cache-Control'</span>),</span><br><span class="line">                // 生命周期？</span><br><span class="line">                <span class="string">"exprires"</span>: xhr.getResponseHeader(<span class="string">'Exprires'</span>),</span><br><span class="line">                <span class="string">"lastModified"</span>: xhr.getResponseHeader(<span class="string">'Last-Modified'</span>),</span><br><span class="line">                <span class="string">"valid_code"</span>: xhr.getResponseHeader(<span class="string">'Valid_code'</span>)</span><br><span class="line">            &#125;;</span><br><span class="line">            // 在这里，做想做的事。。。</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">'#btn'</span>).click(function () &#123;</span><br><span class="line">        let dic = &#123;</span><br><span class="line">            <span class="string">'username'</span>: $(<span class="string">'#username'</span>).val(),</span><br><span class="line">            <span class="string">'password'</span>: $(<span class="string">'#password'</span>).val(),</span><br><span class="line">            <span class="string">'code'</span>: $(<span class="string">'#code'</span>).val(),</span><br><span class="line">        &#125;;</span><br><span class="line">        &#123;<span class="comment">#let valid_code = xhr().getResponseHeader('valid_code');#&#125;</span></span><br><span class="line">        let json_dic = JSON.stringify(dic);</span><br><span class="line">        console.log(header.valid_code);</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url: <span class="string">''</span>,</span><br><span class="line">            type: <span class="string">'post'</span>,</span><br><span class="line">            data: json_dic,</span><br><span class="line">            contentType: <span class="string">'application/json'</span>,</span><br><span class="line">            dataType: <span class="string">'json'</span>,</span><br><span class="line">            // 在这里使用</span><br><span class="line">            headers:&#123;</span><br><span class="line">                <span class="string">'Valid-Code'</span>:header.valid_code  //一定要这样写</span><br><span class="line">            &#125;,</span><br><span class="line">            success: function (data) &#123;</span><br><span class="line">                console.log(data);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (data.status === <span class="string">'404'</span>) &#123;</span><br><span class="line">                    $(<span class="string">'#msg'</span>).text(data.data)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (data.status === <span class="string">'405'</span>) &#123;</span><br><span class="line">                    $(<span class="string">'#msg'</span>).text(data.data)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (data.status === <span class="string">'101'</span>) &#123;</span><br><span class="line">                    window.location.href = <span class="string">'http://127.0.0.1:8789/index/'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h4 id="7-ajax传json格式字典，如何通过验证"><a href="#7-ajax传json格式字典，如何通过验证" class="headerlink" title="7.ajax传json格式字典，如何通过验证(***)"></a>7.ajax传json格式字典，如何通过验证(***)</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> dic = &#123;</span><br><span class="line">    <span class="string">'username'</span>: $(<span class="string">'#username'</span>).val(),</span><br><span class="line">    <span class="string">'password'</span>: $(<span class="string">'#password'</span>).val(),</span><br><span class="line">    <span class="string">'new_password'</span>: $(<span class="string">'#new_password'</span>).val(),</span><br><span class="line">    &#125;;</span><br><span class="line">	<span class="keyword">let</span> json_dic = <span class="built_in">JSON</span>.stringify(dic);</span><br><span class="line">	<span class="built_in">console</span>.log(json_dic);</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url: <span class="string">'/ModifyPassword/'</span>,</span><br><span class="line">        type: <span class="string">'post'</span>,</span><br><span class="line">        contentType: <span class="string">'application/json'</span>,</span><br><span class="line">        data: json_dic,</span><br><span class="line">        dataType: <span class="string">'json'</span>,</span><br><span class="line">        headers: &#123;</span><br><span class="line">        	<span class="string">'X-CSRFToken'</span>:  <span class="string">"&#123;&#123; csrf_token &#125;&#125;"</span></span><br><span class="line">        &#125;,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data);</span><br><span class="line">        <span class="keyword">if</span> (data.status === <span class="string">'100'</span>) &#123;</span><br><span class="line">        	location.href = <span class="string">'http://127.0.0.1:8789/login/'</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-ajax静态刷新"><a href="#8-ajax静态刷新" class="headerlink" title="8.ajax静态刷新"></a>8.ajax静态刷新</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1.html</span><br><span class="line">&#123;% for article in article_list %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;&#123; article.title &#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"media"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"media-left"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"media-object"</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; article.blog.userinfo.avatar &#125;&#125;"</span></span></span><br><span class="line"><span class="tag"><span class="attr">style</span>=<span class="string">"width: 40px; height: 40px;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span>	</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"media-body"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h5</span> <span class="attr">class</span>=<span class="string">"media-heading"</span>&gt;</span>&#123;&#123; article.abstract &#125;&#125;<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"li"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>作者:(&#123;&#123; article.blog.userinfo.username &#125;&#125;)<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>时间（&#123;&#123; article.create_time|date:'Y:m:d H:i:s' &#125;&#125;）<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span>评论（&#123;&#123; article.comment_num &#125;&#125;）<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"up"</span>&gt;</span>赞（<span class="tag">&lt;<span class="name">i</span>&gt;</span>&#123;&#123; article.up_num &#125;&#125;<span class="tag">&lt;/<span class="name">i</span>&gt;</span>）<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"mm"</span> <span class="attr">style</span>=<span class="string">"display: none"</span>&gt;</span><span class="tag">&lt;<span class="name">i</span>&gt;</span>&#123;&#123; article.id &#125;&#125;<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"down"</span>&gt;</span>踩（<span class="tag">&lt;<span class="name">i</span>&gt;</span>&#123;&#123; article.down_num &#125;&#125;<span class="tag">&lt;/<span class="name">i</span>&gt;</span>）<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>jquery</span><br><span class="line"></span><br><span class="line"> $(<span class="string">'.up'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log($(<span class="keyword">this</span>).children().text());</span><br><span class="line">        <span class="built_in">console</span>.log($(<span class="keyword">this</span>).next().children().text());</span><br><span class="line">        <span class="keyword">let</span> dic = &#123;</span><br><span class="line">            <span class="string">'id'</span>:$(<span class="keyword">this</span>).next().children().text(),</span><br><span class="line">            <span class="string">'num'</span>: $(<span class="keyword">this</span>).children().text(),</span><br><span class="line">            <span class="string">'up_num'</span>: <span class="string">'1'</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">let</span> my = $(<span class="keyword">this</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(dic);</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url: <span class="string">'&#123;% url "upanddown" %&#125;'</span>,</span><br><span class="line">            type: <span class="string">'post'</span>,</span><br><span class="line">            data: dic,</span><br><span class="line">            headers: &#123;</span><br><span class="line">                <span class="string">'X-CSRFToken'</span>: <span class="string">"&#123;&#123; csrf_token &#125;&#125;"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(data);</span><br><span class="line">                my.children().text(data)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h4 id="9-简单的控制上传文件的方法"><a href="#9-简单的控制上传文件的方法" class="headerlink" title="9.简单的控制上传文件的方法"></a>9.简单的控制上传文件的方法</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">accept</span>=<span class="string">'image/*'</span></span><br></pre></td></tr></table></figure>
<h3 id="day12"><a href="#day12" class="headerlink" title="day12"></a>day12</h3><h4 id="1-分页器组件（-）"><a href="#1-分页器组件（-）" class="headerlink" title="1.分页器组件（*）"></a>1.分页器组件（<strong>*</strong>）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>批量插入</span><br><span class="line">lis = [models.Book.objects.create(name=<span class="string">"图书%s"</span> % i, price=i + <span class="number">10</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">101</span>)]</span><br><span class="line">models.Book.objects.bulk_create(lis)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">2.</span>分页器的属性和方法：</span><br><span class="line"><span class="comment"># 导入</span></span><br><span class="line"><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator </span><br><span class="line"><span class="comment"># 实例化产生一个paginator的分页对象,传一个iter和每页的条数</span></span><br><span class="line">paginator = Paginator(book_list,<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对象内的属性和方法</span></span><br><span class="line">	数据总条数：paginator.count</span><br><span class="line">    总页数：paginator.num_pages</span><br><span class="line">    页码数的列表：paginator.page_range</span><br><span class="line">    取到指定的页，返回一个page对象：paginator.page(<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    current_page = paginator.page(<span class="number">2</span>)</span><br><span class="line">    当前页码内所有的数据：current_page.object_list</span><br><span class="line">    是否有下一页：current_page.has_next()</span><br><span class="line">    是否有上一页：current_page.has_previous()</span><br><span class="line">    下一页的页码数：current_page.next_page_number()</span><br><span class="line">    上一页的页码数：current_page.previous_page_number()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.</span>前五后五进行分页：(视图层)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># 先查出数据</span></span><br><span class="line">    lis = models.Book.objects.all()</span><br><span class="line">    <span class="comment"># 按照指定的数目进行分页，得到一个分页后的对象</span></span><br><span class="line">    paginator = Paginator(lis, <span class="number">3</span>)</span><br><span class="line">    <span class="comment"># 为防止溢出，产生错误，放到异常处理中执行代码</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 从页面获取当前页的页码</span></span><br><span class="line">        current_page_num = int(request.GET.get(<span class="string">'page'</span>))</span><br><span class="line">        <span class="comment"># 从分页对象中产生一个当前页的对象current_page</span></span><br><span class="line">        current_page = paginator.page(current_page_num)</span><br><span class="line">        <span class="comment"># 总页码数大于11</span></span><br><span class="line">        <span class="keyword">if</span> paginator.num_pages &gt; <span class="number">11</span>:</span><br><span class="line">            <span class="keyword">if</span> current_page_num &lt; <span class="number">6</span>:</span><br><span class="line">                page_range = range(<span class="number">1</span>, <span class="number">12</span>)</span><br><span class="line">            <span class="keyword">elif</span> paginator.num_pages - current_page_num &lt; <span class="number">5</span>:</span><br><span class="line">                page_range = range(paginator.num_pages - <span class="number">10</span>, paginator.num_pages + <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                page_range = range(current_page_num - <span class="number">5</span>, current_page_num + <span class="number">6</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            page_range = paginator.page_range</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        current_page_num = <span class="number">1</span></span><br><span class="line">        current_page = paginator.page(current_page_num)</span><br><span class="line">        page_range = range(<span class="number">1</span>, <span class="number">12</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, locals())</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">1.模板层：</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>分页器<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    &#123;% load static %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static '/utils/bootstrap-3.3.7-dist/css/bootstrap.css' %&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container-fluid"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-lg-6 col-lg-offset-3"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-bordered"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>书名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>价格<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                &#123;% for book in current_page %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; forloop.counter &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; book.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; book.price &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">nav</span> <span class="attr">aria-label</span>=<span class="string">"Page navigation"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"pagination"</span>&gt;</span></span><br><span class="line">                    &#123;% if current_page.has_previous %&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/index/?page=&#123;&#123; current_page.previous_page_number &#125;&#125;"</span> <span class="attr">aria-label</span>=<span class="string">"Previous"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">span</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="symbol">&amp;laquo;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    &#123;% else %&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">aria-label</span>=<span class="string">"Previous"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">span</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="symbol">&amp;laquo;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    &#123;% endif %&#125;</span><br><span class="line">                    &#123;% for foo in page_range %&#125;</span><br><span class="line">                        &#123;% if foo == current_page_num %&#125;</span><br><span class="line">                            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/index/?page=&#123;&#123; foo &#125;&#125;"</span>&gt;</span>&#123;&#123; foo &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                        &#123;% else %&#125;</span><br><span class="line">                            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/index/?page=&#123;&#123; foo &#125;&#125;"</span>&gt;</span>&#123;&#123; foo &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                        &#123;% endif %&#125;</span><br><span class="line">                    &#123;% endfor %&#125;</span><br><span class="line">                    &#123;% if current_page.has_next %&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/index/?page=&#123;&#123; current_page.next_page_number &#125;&#125;"</span> <span class="attr">aria-label</span>=<span class="string">"Next"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">span</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="symbol">&amp;raquo;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                        &#123;% else %&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">aria-label</span>=<span class="string">"Next"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">span</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="symbol">&amp;raquo;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="day13"><a href="#day13" class="headerlink" title="day13"></a>day13</h3><h4 id="1-Forms校验功能组件"><a href="#1-Forms校验功能组件" class="headerlink" title="1.Forms校验功能组件"></a>1.Forms校验功能组件</h4><ul>
<li><p>1.校验字段的功能</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>前端传过来的数据，通过post或者get，或者body里面取出来，生成字典类型</span><br><span class="line"><span class="number">2.</span>将自定义的UserForms类实例化，同时将字典传入该类中，生成一个form的对象</span><br><span class="line"><span class="number">3.</span>执行form.is_valid()进行字段的校验</span><br><span class="line"><span class="number">4.</span>详情见实例</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1.模板层</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">novalidate</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"user"</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">id</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"pwd"</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"pwd"</span> <span class="attr">id</span>=<span class="string">"pwd"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"r_pwd"</span>&gt;</span>确认密码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"r_pwd"</span> <span class="attr">id</span>=<span class="string">"r_pwd"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"email"</span>&gt;</span>邮箱<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">id</span>=<span class="string">"email"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>视图层</span><br><span class="line"><span class="comment"># forms组件</span></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.forms <span class="keyword">import</span> widgets</span><br><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> ValidationError</span><br><span class="line"></span><br><span class="line">wid_01=widgets.TextInput(attrs=&#123;<span class="string">"class"</span>:<span class="string">"form-control"</span>&#125;)</span><br><span class="line">wid_02=widgets.PasswordInput(attrs=&#123;<span class="string">"class"</span>:<span class="string">"form-control"</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line">    name=forms.CharField(max_length=<span class="number">32</span>,</span><br><span class="line">                         widget=wid_01</span><br><span class="line">                         )</span><br><span class="line">    pwd=forms.CharField(max_length=<span class="number">32</span>,widget=wid_02)</span><br><span class="line">    r_pwd=forms.CharField(max_length=<span class="number">32</span>,widget=wid_02)</span><br><span class="line">    email=forms.EmailField(widget=wid_01)</span><br><span class="line">    tel=forms.CharField(max_length=<span class="number">32</span>,widget=wid_01)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(request)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">"POST"</span>:</span><br><span class="line">        form=UserForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            print(form.cleaned_data)       <span class="comment"># 所有干净的字段以及对应的值</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(form.cleaned_data)       <span class="comment">#</span></span><br><span class="line">            print(form.errors)             <span class="comment"># ErrorDict : &#123;"校验错误的字段":["错误信息",]&#125;</span></span><br><span class="line">            print(form.errors.get(<span class="string">"name"</span>)) <span class="comment"># ErrorList ["错误信息",]</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">"OK"</span>)</span><br><span class="line">    form=UserForm()</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">"register.html"</span>,locals())</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4.</span>form对象常用的方法和属性</span><br><span class="line">form.cleaned_data --所有校验通过的字段，以及对应的值</span><br><span class="line"></span><br><span class="line">form.errors -- 如果有校验不通过的字段，则会返回一个ErrorDict：&#123;<span class="string">"校验错误的字段"</span>:[<span class="string">"错误信息"</span>,]&#125;</span><br><span class="line"></span><br><span class="line">form.errors.get(<span class="string">"name"</span>) --ErrorList [<span class="string">'错误信息'</span>] --一般我们取第一个错误信息</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5.</span><span class="keyword">for</span>循环form对象，得到字段对象f,form里面的类中一定重写了__iter__方法</span><br><span class="line">f.lable 获取字段的标签</span><br><span class="line">f.name  获取字段的名字</span><br><span class="line">f.errors 获取字段的错误列表,一般我们取第一个字段作为错误信息渲染到页面</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.渲染标签的功能</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1.方式一:直接用form对象进行渲染，有较强的灵活性，但是代码量多</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>注册页面<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 col-lg-offset-3"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">novalidate</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">                    &#123;% csrf_token %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        &#123;&#123; form.name &#125;&#125; --最终会被解析成input标签</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        &#123;&#123; form.pwd &#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span>确认密码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        &#123;&#123; form.r_pwd &#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span> 邮箱<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        &#123;&#123; form.email &#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-default pull-right"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">2.方式二：推荐使用</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line"></span><br><span class="line">    &#123;% for field in form %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span>&#123;&#123; field.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            &#123;&#123; field &#125;&#125;	</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-default pull-right"</span>&gt;</span></span><br><span class="line">                </span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">3.方式三：代码量少但是可拓展性变弱</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line">    </span><br><span class="line">    &#123;&#123; form.as_p &#125;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-default pull-right"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>3.渲染错误信息的功能</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>视图</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">"POST"</span>:</span><br><span class="line">        form=UserForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            print(form.cleaned_data)       <span class="comment"># 所有干净的字段以及对应的值</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(form.cleaned_data)       <span class="comment">#</span></span><br><span class="line">            print(form.errors)             <span class="comment"># ErrorDict : &#123;"校验错误的字段":["错误信息",]&#125;</span></span><br><span class="line">            print(form.errors.get(<span class="string">"name"</span>)) <span class="comment"># ErrorList ["错误信息",]</span></span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">"register.html"</span>,locals())</span><br><span class="line">    form=UserForm()</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">"register.html"</span>,locals())</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">2.模板:field.errors.0就是错误信息的第一个</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">novalidate</span>&gt;</span></span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line">    </span><br><span class="line">    &#123;% for field in form %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span>&#123;&#123; field.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            &#123;&#123; field &#125;&#125; <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"pull-right"</span> <span class="attr">style</span>=<span class="string">"color: red"</span>&gt;</span>&#123;&#123; field.errors.0 &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>4.组件的参数配置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ret</span><span class="params">(Form)</span>:</span></span><br><span class="line">    name = forms.CharField(max_length=<span class="number">10</span>, min_length=<span class="number">2</span>, label=<span class="string">'用户名'</span>,</span><br><span class="line">                           error_messages=&#123;<span class="string">'required'</span>: <span class="string">'该字段不能为空'</span>, <span class="string">'invalid'</span>: <span class="string">'格式错误'</span>, <span class="string">'max_length'</span>: <span class="string">'太长'</span>,</span><br><span class="line">                                           <span class="string">'min_length'</span>: <span class="string">'太短'</span>&#125;,</span><br><span class="line">                           widget=widgets.TextInput(attrs=&#123;<span class="string">'class'</span>:<span class="string">'form-control'</span>&#125;))</span><br><span class="line">    pwd = forms.CharField(max_length=<span class="number">10</span>, min_length=<span class="number">2</span>, widget=widgets.PasswordInput(attrs=&#123;<span class="string">'class'</span>:<span class="string">'form-control'</span>&#125;))</span><br><span class="line">    email = forms.EmailField(label=<span class="string">'邮箱'</span>, error_messages=&#123;<span class="string">'required'</span>: <span class="string">'该字段不能为空'</span>, <span class="string">'invalid'</span>: <span class="string">'格式错误'</span>&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>5.局部钩子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> NON_FIELD_ERRORS, ValidationError</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_name</span><span class="params">(self)</span>:</span></span><br><span class="line"></span><br><span class="line">        val=self.cleaned_data.get(<span class="string">"name"</span>)</span><br><span class="line"></span><br><span class="line">        ret=UserInfo.objects.filter(name=val)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ret:</span><br><span class="line">            <span class="keyword">return</span> val</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">"该用户已注册!"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_tel</span><span class="params">(self)</span>:</span></span><br><span class="line"></span><br><span class="line">    val=self.cleaned_data.get(<span class="string">"tel"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(val)==<span class="number">11</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> val</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span>  ValidationError(<span class="string">"手机号格式错误"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>6.全局钩子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean</span><span class="params">(self)</span>:</span></span><br><span class="line">    pwd=self.cleaned_data.get(<span class="string">'pwd'</span>)</span><br><span class="line">    r_pwd=self.cleaned_data.get(<span class="string">'r_pwd'</span>)</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> pwd <span class="keyword">and</span> r_pwd:</span><br><span class="line">        <span class="keyword">if</span> pwd==r_pwd:</span><br><span class="line">            <span class="keyword">return</span> self.cleaned_data</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">'两次密码不一致'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> self.cleaned_data</span><br></pre></td></tr></table></figure>
</li>
<li><p>7.注意事项(***)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>form表单的name属性值应该与forms组件字段名称一致</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>form除了可以校验前端传过来的数据，也可以校验数据库的数据</span><br><span class="line">比如数据库为空的字段，可以过滤掉</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>如果前台是ajax传过来的json格式对象，那么我们返回时一定要返回json格式Httpresponse,自然对应模板中通过dom操作，渲染到模板中。</span><br></pre></td></tr></table></figure>
</li>
<li><p>8.实例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">视图层</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.forms <span class="keyword">import</span> widgets</span><br><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> ValidationError</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line">    name = forms.CharField(max_length=<span class="number">10</span>, min_length=<span class="number">3</span>, label=<span class="string">'用户名'</span>,</span><br><span class="line">                           error_messages=&#123;<span class="string">'max_length'</span>: <span class="string">'最长是10'</span>, <span class="string">'min_length'</span>: <span class="string">'最短是3'</span>, <span class="string">'required'</span>: <span class="string">'这个必须填'</span>&#125;,</span><br><span class="line">                           widget=widgets.TextInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">'form-control name'</span>&#125;))</span><br><span class="line">    password = forms.CharField(max_length=<span class="number">20</span>, min_length=<span class="number">3</span>, label=<span class="string">'密码'</span>,</span><br><span class="line">                               error_messages=&#123;<span class="string">'max_length'</span>: <span class="string">'最长是20'</span>, <span class="string">'min_length'</span>: <span class="string">'最短是3'</span>, <span class="string">'required'</span>: <span class="string">'这个必须填'</span>&#125;,</span><br><span class="line">                               widget=widgets.PasswordInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">'form-control password'</span>&#125;))</span><br><span class="line">    re_password = forms.CharField(max_length=<span class="number">20</span>, min_length=<span class="number">3</span>, label=<span class="string">'请确认密码'</span>,</span><br><span class="line">                                  error_messages=&#123;<span class="string">'max_length'</span>: <span class="string">'最长是20'</span>, <span class="string">'min_length'</span>: <span class="string">'最短是3'</span>, <span class="string">'required'</span>: <span class="string">'这个必须填'</span>&#125;,</span><br><span class="line">                                  widget=widgets.PasswordInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">'form-control re_password'</span>&#125;))</span><br><span class="line">    sex = forms.IntegerField(max_value=<span class="number">3</span>, min_value=<span class="number">1</span>, label=<span class="string">'性别'</span>,</span><br><span class="line">                             error_messages=&#123;<span class="string">'max_length'</span>: <span class="string">'最长是3'</span>, <span class="string">'min_length'</span>: <span class="string">'最短是1'</span>, <span class="string">'required'</span>: <span class="string">'这个必须填'</span>&#125;,</span><br><span class="line">                             widget=widgets.NumberInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">'form-control sex'</span>&#125;))</span><br><span class="line">    email = forms.EmailField(label=<span class="string">'邮箱'</span>, widget=widgets.EmailInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">'form-control email'</span>&#125;),</span><br><span class="line">                             error_messages=&#123;<span class="string">'required'</span>: <span class="string">'这个必须填'</span>, <span class="string">'invalid'</span>: <span class="string">'不符合邮箱格式'</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_name</span><span class="params">(self)</span>:</span></span><br><span class="line">        name = self.cleaned_data.get(<span class="string">'name'</span>)</span><br><span class="line">        print(name)</span><br><span class="line">        <span class="keyword">from</span> app01.models <span class="keyword">import</span> User</span><br><span class="line">        name_list = User.objects.all().values(<span class="string">'name'</span>)</span><br><span class="line">        lis = [v[<span class="string">'name'</span>] <span class="keyword">for</span> v <span class="keyword">in</span> name_list]</span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">in</span> lis:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">'用户名重复'</span>)</span><br><span class="line">        <span class="keyword">return</span> name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span><span class="params">(self)</span>:</span></span><br><span class="line">        password = self.cleaned_data.get(<span class="string">"password"</span>)</span><br><span class="line">        re_password = self.cleaned_data.get(<span class="string">"re_password"</span>)</span><br><span class="line">        <span class="keyword">if</span> password == re_password:</span><br><span class="line">            <span class="keyword">return</span> self.cleaned_data</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">'两次输入的密码不一致'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        my_form = MyForm()</span><br><span class="line">        print(type(my_form))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> my_form:</span><br><span class="line">            print(i)</span><br><span class="line">            print(i.label)</span><br><span class="line">            print(i.name)</span><br><span class="line">            print(i.errors)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        <span class="keyword">import</span> json</span><br><span class="line">        print(request.GET)</span><br><span class="line">        print(request.POST)</span><br><span class="line">        print(request.body)</span><br><span class="line">        print(request.META)</span><br><span class="line">        print(json.loads(request.body))</span><br><span class="line"></span><br><span class="line">        my_form = MyForm(json.loads(request.body))</span><br><span class="line">        <span class="keyword">if</span> my_form.is_valid():</span><br><span class="line">            my_form.cleaned_data.pop(<span class="string">"re_password"</span>)</span><br><span class="line">            User.objects.create(**my_form.cleaned_data)</span><br><span class="line">            dic = &#123;<span class="string">'status'</span>: <span class="literal">True</span>&#125;</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(dic)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            global_error = my_form.errors.get(<span class="string">'__all__'</span>)</span><br><span class="line">            <span class="keyword">if</span> global_error:</span><br><span class="line">                my_form.errors[<span class="string">'all'</span>] = [global_error[<span class="number">0</span>]]</span><br><span class="line">                my_form.errors.pop(<span class="string">"__all__"</span>)</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(my_form.errors)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'register.html'</span>, locals())</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">模板层</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/static/utils/bootstrap-3.3.7-dist/css/bootstrap.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/utils/jquery-3.3.1.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container-fluid"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-lg-6 col-lg-offset-3"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form-horizontal"</span>&gt;</span></span><br><span class="line">                    &#123;% for foo in my_form %&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group "</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"inputEmail3"</span> <span class="attr">class</span>=<span class="string">"col-sm-2 control-label"</span>&gt;</span>&#123;&#123; foo.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-10 mm"</span> <span class="attr">id</span>=<span class="string">"&#123;&#123; foo.auto_id &#125;&#125;"</span>&gt;</span></span><br><span class="line">                                &#123;&#123; foo &#125;&#125;</span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    &#123;% endfor %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-offset-2 col-sm-10"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span> <span class="attr">id</span>=<span class="string">"btn"</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"id_all"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="string">'#btn'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> dic = &#123;</span></span><br><span class="line"><span class="javascript">            <span class="string">"name"</span>: $(<span class="string">'.name'</span>).val(),</span></span><br><span class="line"><span class="javascript">            <span class="string">"password"</span>: $(<span class="string">'.password'</span>).val(),</span></span><br><span class="line"><span class="javascript">            <span class="string">"re_password"</span>: $(<span class="string">'.re_password'</span>).val(),</span></span><br><span class="line"><span class="javascript">            <span class="string">"sex"</span>: $(<span class="string">'.sex'</span>).val(),</span></span><br><span class="line"><span class="javascript">            <span class="string">"email"</span>: $(<span class="string">'.email'</span>).val()</span></span><br><span class="line">        &#125;;</span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> json_dic = <span class="built_in">JSON</span>.stringify(dic);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(dic);</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="actionscript">            url: <span class="string">'/register/'</span>,</span></span><br><span class="line"><span class="actionscript">            type: <span class="string">'post'</span>,</span></span><br><span class="line"><span class="actionscript">            contentType: <span class="string">'application/json'</span>,</span></span><br><span class="line">            data: json_dic,</span><br><span class="line"><span class="actionscript">            dataType: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="actionscript">            success: <span class="function"><span class="keyword">function</span> <span class="params">(data)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(data);</span></span><br><span class="line"><span class="javascript">                $.each(data, <span class="function"><span class="keyword">function</span> (<span class="params">i, obj</span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">                    <span class="keyword">if</span> (i === <span class="string">'status'</span>) &#123;</span></span><br><span class="line"><span class="actionscript">                        location.href=<span class="string">'http://www.baidu.com'</span></span></span><br><span class="line">                    &#125;</span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(i);</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(i, obj);</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">let</span> $span = $(<span class="string">'&lt;span&gt;&lt;/span&gt;'</span>);</span></span><br><span class="line">                    $span.text(obj[0]);</span><br><span class="line"><span class="actionscript">                    res = <span class="string">'#id_aa'</span>.replace(<span class="string">'aa'</span>, i);</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(res);</span></span><br><span class="line">                    $span.appendTo(res)</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">    $(<span class="string">'#id_name .name'</span>).mouseout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> ($(<span class="keyword">this</span>).val()) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> name_dic = &#123;<span class="string">'name'</span>: $(<span class="keyword">this</span>).val()&#125;;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> json_dic = <span class="built_in">JSON</span>.stringify(name_dic);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">            $.ajax(&#123;</span></span><br><span class="line"><span class="actionscript">                url: <span class="string">'/register/'</span>,</span></span><br><span class="line"><span class="actionscript">                type: <span class="string">'post'</span>,</span></span><br><span class="line"><span class="actionscript">                contentType: <span class="string">'application/json'</span>,</span></span><br><span class="line">                data: json_dic,</span><br><span class="line"><span class="actionscript">                dataType: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="actionscript">                success: <span class="function"><span class="keyword">function</span> <span class="params">(data)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> ($(<span class="string">'.myname'</span>).length &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(<span class="string">'jjj'</span>)</span></span><br><span class="line"><span class="actionscript">                    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">let</span> $span = $(<span class="string">'&lt;span&gt;&lt;/span&gt;'</span>);</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(data, <span class="string">'mmmmmmmm'</span>);</span></span><br><span class="line">                        $span.text(data.name[0]);</span><br><span class="line"><span class="actionscript">                        $span.addClass(<span class="string">'myname'</span>);</span></span><br><span class="line"><span class="javascript">                        $span.appendTo($(<span class="string">'#id_name'</span>));</span></span><br><span class="line"><span class="actionscript">                        setTimeout(<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line">                            $span.remove();</span><br><span class="line">                        &#125;, 3000)</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line"><span class="actionscript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log($(<span class="keyword">this</span>).val())</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="day14"><a href="#day14" class="headerlink" title="day14"></a>day14</h3><h4 id="1-cookie组件"><a href="#1-cookie组件" class="headerlink" title="1.cookie组件"></a>1.cookie组件</h4><ul>
<li><p>1.会话跟踪技术</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>因为http协议是无状态协议，也就是说每个请求都是相互独立的！</span><br><span class="line">这样会导致每次请求过来都是一个全新的会话，无法知道上一次会话的是谁，但是在</span><br><span class="line">同一个会话中，应该是数据共享的，所以就有了cookie和session来完成</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>seesion底层依赖的是cookie技术</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.cookie简介</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">1</span><span class="string">.</span><span class="comment">什么是cookie</span></span><br><span class="line"><span class="comment">cookie的本质就是key</span><span class="literal">-</span><span class="comment">value结构，类似于python中的字典</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">客户端浏览器第一次发送请求（没有cookie）</span>--&gt;<span class="comment">服务端判断是否有cookie</span>--<span class="literal">-</span><span class="comment">没有</span>--<span class="literal">-</span><span class="comment">就生成一个cookie</span>--<span class="comment">返回给客户端浏览器</span>--<span class="comment">客户端浏览器保存这个cookie</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">客户端浏览器第二次发送请求（有之前存的cookie）</span>--&gt;<span class="comment">服务器判断是否有cookie</span>--&gt;<span class="comment">有cookie，服务器会识别数据，最终返回给客户端数据</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>3.cookie规范</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>cookie大小上限<span class="number">4</span>kb</span><br><span class="line"><span class="number">2.</span>一个服务器最多在客户端保存<span class="number">20</span>个cookie</span><br><span class="line"><span class="number">3.</span>一个浏览器最多保存<span class="number">300</span>个cookie</span><br></pre></td></tr></table></figure>
</li>
<li><p>4.cookie的覆盖</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果服务端发送重复cookie那么就会覆盖原有的cookie</span><br><span class="line"></span><br><span class="line">例如客户端的第一个请求服务器端发送的Cookie是：Set-Cookie: <span class="attribute">a</span>=A；第二请求服务器端发送的是：Set-Cookie: <span class="attribute">a</span>=AA，那么客户端只留下一个Cookie，即：a=AA。</span><br></pre></td></tr></table></figure>
</li>
<li><p>5.在浏览器中查看cookie</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">浏览器中按F12，点network<span class="comment">---cookie就能看到</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-django中如何使用cookie"><a href="#2-django中如何使用cookie" class="headerlink" title="2.django中如何使用cookie"></a>2.django中如何使用cookie</h4><ul>
<li><p>1.获取cookie</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">request.COOKIES[<span class="string">'key'</span>]</span><br><span class="line">request.get_signed_cookie(key, default=RAISE_ERROR, salt=<span class="string">''</span>, max_age=<span class="literal">None</span>)</span><br><span class="line">name=request.COOKIES.get(<span class="string">'name'</span>)</span><br><span class="line">参数：</span><br><span class="line">    default: 默认值</span><br><span class="line">    salt: 加密盐</span><br><span class="line">    max_age: 后台控制过期时间</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.设置cookie</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">rep = HttpResponse(...)</span><br><span class="line">rep ＝ render(request, ...)</span><br><span class="line"></span><br><span class="line">rep.set_cookie(key,value)</span><br><span class="line">格式：Set-Cookie: name：zhang</span><br><span class="line">    </span><br><span class="line">rep.set_signed_cookie(key,value,salt=<span class="string">'加密盐'</span>)</span><br><span class="line">格式：Set-Cookie: name=zhang:<span class="number">1</span>gPsDw:kPYWmlBNjZ7YXCSKT50nb1ldLjk;</span><br><span class="line">参数：</span><br><span class="line"></span><br><span class="line"><span class="comment">#key---- 键</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#value='', 值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#max_age=None, 超时时间 cookie需要延续的时间（以秒为单位）如果参数是\ None`` ，这个cookie会延续到浏览器关闭为止</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#expires=None, 超时时间(IE requires expires, so set it if hasn't been already.)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#path='/', Cookie生效的路径，/ 表示根路径，特殊的：根路径的cookie可以被任何url的页面访问，浏览器只会把cookie回传给带有该路径的页面，这样可以避免将cookie传给站点中的其他的应用。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#domain=None, Cookie生效的域名 你可用这个参数来构造一个跨站cookie。如， domain=".example.com"所构造的cookie对下面这些站点都是可读的：www.example.com 、 www2.example.com 和an.other.sub.domain.example.com 。如果该参数设置为 None ，cookie只能由设置它的站点读取</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#secure=False, 浏览器将通过HTTPS来回传cookie</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#httponly=False 只能http协议传输，无法被JavaScript获取（不是绝对，底层抓包可以获取到也可以被覆盖）</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>3.删除cookie</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_cookie</span><span class="params">(request)</span>:</span></span><br><span class="line">    obj = HttpResponse(<span class="string">'ok'</span>)</span><br><span class="line">    <span class="comment"># 指定删除名字是name的cookie</span></span><br><span class="line">    obj.delete_cookie(<span class="string">'name'</span>)</span><br><span class="line">    <span class="keyword">return</span> obj</span><br></pre></td></tr></table></figure>
</li>
<li><p>4.登录认证装饰器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录认证装饰器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login_auth</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># 拿到之前访问的路径</span></span><br><span class="line">        <span class="comment"># 这个不行,因为取不到数据部分</span></span><br><span class="line">        <span class="comment"># url=request.path</span></span><br><span class="line">        url = request.get_full_path()</span><br><span class="line"></span><br><span class="line">        is_login = request.COOKIES.get(<span class="string">'is_login'</span>)</span><br><span class="line">        <span class="keyword">if</span> is_login:</span><br><span class="line">            res = func(request, *args, **kwargs)</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/login/?next=%s'</span> % url)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新的login</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'login.html'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        next = request.GET.get(<span class="string">'next'</span>)</span><br><span class="line">        name = request.POST.get(<span class="string">'name'</span>)</span><br><span class="line">        pwd = request.POST.get(<span class="string">'pwd'</span>)</span><br><span class="line">        <span class="keyword">if</span> name == <span class="string">'lqz'</span> <span class="keyword">and</span> pwd == <span class="string">'123'</span>:</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> next:  <span class="comment">#判断是否存在next，存在则返回之前的页面，反之返回shop页面，并生成一个新的cookie</span></span><br><span class="line">                obj = redirect(next)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                obj = redirect(<span class="string">'/shopping/'</span>)</span><br><span class="line"></span><br><span class="line">            obj.set_cookie(<span class="string">'is_login'</span>, <span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span> obj</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">'用户名或密码错误'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="3-session组件（一定要做数据库迁移）"><a href="#3-session组件（一定要做数据库迁移）" class="headerlink" title="3.session组件（一定要做数据库迁移）"></a>3.session组件（一定要做数据库迁移）</h4><ul>
<li><p>1.session的由来</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>Cookie弥补了HTTP无状态的不足，让服务器知道来的人是“谁”；但是Cookie以文本的形式保存在本地，自身安全性较差；所以我们就通过Cookie识别不同的用户，对应的在Session里保存私密的信息以及超过<span class="number">4096</span>字节的文本。</span><br><span class="line"></span><br><span class="line">另外，上述所说的Cookie和Session其实是共通性的东西，不限于语言和框架。</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>session必须和cookie连用</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.django中session相关方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取、设置、删除Session中数据</span></span><br><span class="line">request.session[<span class="string">'k1'</span>]</span><br><span class="line">request.session.get(<span class="string">'k1'</span>,<span class="literal">None</span>)</span><br><span class="line">request.session[<span class="string">'k1'</span>] = <span class="number">123</span></span><br><span class="line">request.session.setdefault(<span class="string">'k1'</span>,<span class="number">123</span>) <span class="comment"># 存在则不设置</span></span><br><span class="line"><span class="keyword">del</span> request.session[<span class="string">'k1'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 所有 键、值、键值对</span></span><br><span class="line">request.session.keys()</span><br><span class="line">request.session.values()</span><br><span class="line">request.session.items()</span><br><span class="line">request.session.iterkeys()</span><br><span class="line">request.session.itervalues()</span><br><span class="line">request.session.iteritems()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 会话session的key</span></span><br><span class="line">request.session.session_key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将所有Session失效日期小于当前日期的数据删除</span></span><br><span class="line">request.session.clear_expired()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查会话session的key在数据库中是否存在</span></span><br><span class="line">request.session.exists(<span class="string">"session_key"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除当前会话的所有Session数据(只删数据库)</span></span><br><span class="line">request.session.delete()</span><br><span class="line">　　</span><br><span class="line"><span class="comment"># 删除当前的会话数据并删除会话的Cookie（数据库和cookie都删）。</span></span><br><span class="line">request.session.flush() </span><br><span class="line">    这用于确保前面的会话数据不可以再次被用户的浏览器访问</span><br><span class="line">    例如，django.contrib.auth.logout() 函数中就会调用它。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置会话Session和Cookie的超时时间</span></span><br><span class="line">request.session.set_expiry(value)</span><br><span class="line">    * 如果value是个整数，session会在些秒数后失效。</span><br><span class="line">    * 如果value是个datatime或timedelta，session就会在这个时间后失效。</span><br><span class="line">    * 如果value是<span class="number">0</span>,用户关闭浏览器session就会失效。</span><br><span class="line">    * 如果value是<span class="literal">None</span>,session会依赖全局session失效策略。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">思考，如果第二个人再次再同一个浏览器上登录，django-session表会怎样？</span><br><span class="line"></span><br><span class="line">会覆盖之前session，之前用户的登录信息失效</span><br></pre></td></tr></table></figure>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="strong">*****</span><span class="strong">*****</span><span class="emphasis">***</span>*session的配置</span><br><span class="line">不但能放到数据库,还能放到文件中,redis(内存数据库)</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.基于session的登录验证装饰器（FBV）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基于session写一个登陆认证装饰器,登陆之后才能查看订单页面,购物页面</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth_login</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(request, *args, **kwargs)</span>:</span></span><br><span class="line">        url = request.get_full_path()</span><br><span class="line">        <span class="keyword">if</span> request.session.get(<span class="string">'is_login'</span>):</span><br><span class="line">            res = func(request, *args, **kwargs)</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/login/?next=%s'</span> % url)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'login.html'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        name = request.POST.get(<span class="string">"name"</span>)</span><br><span class="line">        password = request.POST.get(<span class="string">"password"</span>)</span><br><span class="line">        next = request.GET.get(<span class="string">'next'</span>)</span><br><span class="line">        <span class="keyword">if</span> name == <span class="string">'zhang'</span> <span class="keyword">and</span> password == <span class="string">'123'</span>:</span><br><span class="line">            <span class="keyword">if</span> next:</span><br><span class="line">                obj = redirect(next)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                obj = redirect(<span class="string">'/shopping/'</span>)</span><br><span class="line">            request.session[<span class="string">'is_login'</span>] = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">return</span> obj</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">'账号或密码错误'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@auth_login</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shopping</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">'我是购物页面'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@auth_login</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">order</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">'我是订单页面'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>4.登录认证装饰器（CBV）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, HttpResponse, redirect</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.utils.decorators <span class="keyword">import</span> method_decorator</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app01.models <span class="keyword">import</span> User, OrderMsg</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="meta">    @wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(request, *args, **kwargs)</span>:</span></span><br><span class="line">        url = request.get_full_path()</span><br><span class="line">        <span class="keyword">if</span> request.session.get(<span class="string">'id'</span>):</span><br><span class="line">            res = func(request, *args, **kwargs)</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/login/?next=%s'</span> % url)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'login.html'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        name = request.POST.get(<span class="string">'name'</span>)</span><br><span class="line">        password = request.POST.get(<span class="string">'password'</span>)</span><br><span class="line">        res = User.objects.filter(name=name, password=password).first()</span><br><span class="line">        <span class="keyword">if</span> res:</span><br><span class="line">            url = request.GET.get(<span class="string">'next'</span>)</span><br><span class="line">            print(request.GET)</span><br><span class="line">            request.session[<span class="string">'name'</span>] = res.name</span><br><span class="line">            request.session[<span class="string">'id'</span>] = res.pk</span><br><span class="line">            <span class="keyword">if</span> url:</span><br><span class="line">                <span class="keyword">return</span> redirect(url)  ---<span class="comment">#这地方有问题</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> redirect(<span class="string">'/order/'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'data'</span>: <span class="string">'用户名或密码错误'</span>, <span class="string">'status'</span>: <span class="string">'100'</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@method_decorator(auth, name='get')</span></span><br><span class="line"><span class="meta">@method_decorator(auth, name='post')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        id = request.session.get(<span class="string">'id'</span>)</span><br><span class="line">        msg = OrderMsg.objects.filter(user_id=id).all().values(<span class="string">'name'</span>, <span class="string">'price'</span>)</span><br><span class="line">        lis = &#123;<span class="string">'status'</span>: <span class="string">'101'</span>, <span class="string">'data'</span>: [&#123;i.get(<span class="string">'name'</span>): i.get(<span class="string">'price'</span>)&#125; <span class="keyword">for</span> i <span class="keyword">in</span> msg]&#125;</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(lis, safe=<span class="literal">True</span>, json_dumps_params=&#123;<span class="string">'ensure_ascii'</span>: <span class="literal">False</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'ok'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    &#123;% load static %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static '/utils/jquery-3.3.1.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">class</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"btn"</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"ss"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="string">'#btn'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> msg = &#123;</span></span><br><span class="line"><span class="javascript">            <span class="string">'name'</span>: $(<span class="string">'.name'</span>).val(),</span></span><br><span class="line"><span class="javascript">            <span class="string">'password'</span>: $(<span class="string">'.password'</span>).val()</span></span><br><span class="line">        &#125;;</span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="actionscript">            url: <span class="string">'/login/'</span>,</span></span><br><span class="line"><span class="actionscript">            type: <span class="string">'post'</span>,</span></span><br><span class="line">            data: msg,</span><br><span class="line"><span class="actionscript">            dataType: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="actionscript">            success: <span class="function"><span class="keyword">function</span> <span class="params">(data)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(data);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">                <span class="keyword">if</span> (data.status === <span class="string">'100'</span>)&#123;</span></span><br><span class="line"><span class="javascript">                    $(<span class="string">'.ss'</span>).text(data.data);</span></span><br><span class="line">                &#125;</span><br><span class="line"><span class="actionscript">                <span class="keyword">if</span> (data.status === <span class="string">'101'</span>) &#123;</span></span><br><span class="line"><span class="actionscript">                    location.href =<span class="string">'http://127.0.0.1:8234/order/'</span>;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="day15"><a href="#day15" class="headerlink" title="day15"></a>day15</h3><h4 id="1-中间件"><a href="#1-中间件" class="headerlink" title="1.中间件"></a>1.中间件</h4><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>什么是中间件</span><br><span class="line">请求和响应之间的一道屏障</span><br><span class="line"><span class="number">2.</span>中间件的作用</span><br><span class="line">控制请求和响应</span><br></pre></td></tr></table></figure>
<h4 id="2-自定义中间件"><a href="#2-自定义中间件" class="headerlink" title="2.自定义中间件"></a>2.自定义中间件</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>导入</span><br><span class="line">先创建一个py文件,再导入</span><br><span class="line"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>定义一个类：名字可以随意，继承MiddlewareMixin</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyMiddleware1</span><span class="params">(MiddlewareMixin)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        print(<span class="string">'MyMiddleware----&gt;1----&gt;process_request'</span>)</span><br><span class="line">        <span class="comment"># 返回HttpRspons对象,直接返回,走自己的process_response</span></span><br><span class="line">        <span class="comment"># 返回None的时候,继续往下走</span></span><br><span class="line">        <span class="comment"># return HttpResponse('i am middle--1')</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span><span class="params">(self, request, response)</span>:</span></span><br><span class="line"></span><br><span class="line">        print(<span class="string">'MyMiddleware---&gt;1----&gt;process_response'</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"> </span><br><span class="line"><span class="number">3.</span>使用：在settings中注册</span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">'app01.mymiddelware.MyMiddleware1'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">中间件的执行循序（正常情况）</span><br><span class="line">request：从上往下执行，每个中间件都会执行</span><br><span class="line">response：从下往上执行，每个中间件都会执行</span><br><span class="line">-<span class="ruby">process_request,从上往下执行</span></span><br><span class="line"><span class="ruby">    -如果retrun HttpResponse的对象,直接返回了</span></span><br><span class="line"><span class="ruby">    -如果retrun None ,继续往下走</span></span><br><span class="line"><span class="ruby">-process_response,从下往上执行</span></span><br><span class="line"><span class="ruby">	-必须要retrun Httpresponse的对象</span></span><br></pre></td></tr></table></figure>
<h4 id="3-中间件的方法（最重要前2个）"><a href="#3-中间件的方法（最重要前2个）" class="headerlink" title="3.中间件的方法（最重要前2个）"></a>3.中间件的方法（最重要前2个）</h4><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">process_request</span></span><br><span class="line"><span class="ruby">-请求来的时候,会响应它</span></span><br><span class="line"></span><br><span class="line"><span class="ruby">-process_response</span></span><br><span class="line"><span class="ruby">-响应回去的时候,会走它</span></span><br><span class="line"></span><br><span class="line"><span class="ruby">-process_view(了解)</span></span><br><span class="line"><span class="ruby">    - request, callback(视图函数), callback_args(无名分组的参数), 	callback_kwargs(有名分组的参数)</span></span><br><span class="line"><span class="ruby">-执行顺序,详见图</span></span><br><span class="line"></span><br><span class="line"><span class="ruby">-<span class="function"><span class="keyword">def</span> <span class="title">process_exception</span><span class="params">(<span class="keyword">self</span>, request, exception)</span></span>(了解)</span></span><br><span class="line"><span class="ruby">-<span class="function"><span class="keyword">def</span> <span class="title">process_template_response</span><span class="params">(<span class="keyword">self</span>, request, response)</span></span><span class="symbol">:</span>(了解)</span></span><br></pre></td></tr></table></figure>
<h4 id="4-csrf：跨站请求伪造"><a href="#4-csrf：跨站请求伪造" class="headerlink" title="4.csrf：跨站请求伪造"></a>4.csrf：跨站请求伪造</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">比如<span class="symbol">:</span>转账请求<span class="symbol">:transfer?to=lqz&amp;count=</span><span class="number">1000</span></span><br><span class="line">是什么?</span><br><span class="line">攻击者盗用了你的身份，以你的名义发送恶意请求，对服务器来说这个请求是完全合法的</span><br></pre></td></tr></table></figure>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">如何防范：</span><br><span class="line"><span class="number">1.</span>通过refer：判断发送请求的上次域名和端口是不是在转账请求域名和端口内</span><br><span class="line"><span class="number">2.</span>加一个随机字符串校验（加在请求的路径里，或者加在请求体中）</span><br><span class="line"><span class="number">3.</span>在请求头中加字符串校验</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">验证原理：</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_compare_salted_tokens</span><span class="params">(request_csrf_token, csrf_token)</span>:</span></span><br><span class="line">    <span class="comment"># Assume both arguments are sanitized -- that is, strings of</span></span><br><span class="line">    <span class="comment"># length CSRF_TOKEN_LENGTH, all CSRF_ALLOWED_CHARS.</span></span><br><span class="line">    <span class="keyword">return</span> constant_time_compare(</span><br><span class="line">        _unsalt_cipher_token(request_csrf_token),</span><br><span class="line">        _unsalt_cipher_token(csrf_token),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_unsalt_cipher_token</span><span class="params">(token)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Given a token (assumed to be a string of CSRF_ALLOWED_CHARS, of length</span></span><br><span class="line"><span class="string">    CSRF_TOKEN_LENGTH, and that its first half is a salt), use it to decrypt</span></span><br><span class="line"><span class="string">    the second half to produce the original secret.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    salt = token[:CSRF_SECRET_LENGTH]</span><br><span class="line">    token = token[CSRF_SECRET_LENGTH:]</span><br><span class="line">    chars = CSRF_ALLOWED_CHARS</span><br><span class="line">    pairs = zip((chars.index(x) <span class="keyword">for</span> x <span class="keyword">in</span> token), (chars.index(x) <span class="keyword">for</span> x <span class="keyword">in</span> salt))</span><br><span class="line">    secret = <span class="string">''</span>.join(chars[x - y] <span class="keyword">for</span> x, y <span class="keyword">in</span> pairs)  <span class="comment"># Note negative values are ok</span></span><br><span class="line">    <span class="keyword">return</span> secret</span><br><span class="line"></span><br><span class="line">token字符串的前<span class="number">32</span>位是salt， 后面是加密后的token， 通过salt能解密出唯一的secret。</span><br><span class="line">django会验证表单中的token和cookie中token是否能解出同样的secret，secret一样则本次请求合法。</span><br><span class="line">同样也不难解释，为什么ajax请求时，需要从cookie中拿取token添加到请求头中。</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">如何使用：</span><br><span class="line"><span class="number">1.</span>中间件不在注释掉</span><br><span class="line"><span class="number">2.</span>以后再发post请求时，携带那个随机字符串</span><br><span class="line"></span><br><span class="line">form表单形式:</span><br><span class="line">&lt;form action=<span class="string">""</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"name"</span>&gt;	</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"pwd"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"提交"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">ajax提交：</span><br><span class="line">data: &#123;</span><br><span class="line">    <span class="string">'name'</span>: $(<span class="string">'[name="name"]'</span>).val(),</span><br><span class="line">    <span class="string">'pwd'</span>: $(<span class="string">'[name="pwd"]'</span>).val(),</span><br><span class="line">    //<span class="string">'csrfmiddlewaretoken'</span>: $(<span class="string">'[name="csrfmiddlewaretoken"]'</span>).val()</span><br><span class="line">    <span class="string">'csrfmiddlewaretoken'</span>: <span class="string">'&#123;&#123; csrf_token &#125;&#125;'</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h4 id="5-csrf：局部禁用，局部使用-CBV"><a href="#5-csrf：局部禁用，局部使用-CBV" class="headerlink" title="5.csrf：局部禁用，局部使用(CBV)"></a>5.csrf：局部禁用，局部使用(CBV)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>局部禁用：全局就得使用</span><br><span class="line"><span class="number">2.</span>局部使用：全局就得禁用</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.utils.decorators <span class="keyword">import</span> method_decorator</span><br><span class="line"><span class="meta">@method_decorator(csrf_protect,name='dispatch')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Csrf_disable</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="comment"># @method_decorator(csrf_protect)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dispatch</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        ret=super().dispatch(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'ok'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'post---ok'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意：<span class="emphasis">***</span>*</span><br><span class="line">只能加在dispatch方法或者类上面，如上</span><br></pre></td></tr></table></figure>
<h4 id="6-csrf：局部禁用，局部使用-FBV"><a href="#6-csrf：局部禁用，局部使用-FBV" class="headerlink" title="6.csrf：局部禁用，局部使用(FBV)"></a>6.csrf：局部禁用，局部使用(FBV)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">用装饰器:<span class="keyword">from</span> django.views.decorators.csrf <span class="keyword">import</span> csrf_exempt,csrf_protect</span><br><span class="line">    fbv---&gt;直接加载fbv上就行了</span><br><span class="line">    局部禁用,全局得使用</span><br><span class="line"><span class="meta">    @csrf_exempt</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">csrf_disable</span><span class="params">(request)</span>:</span></span><br><span class="line">        print(request.POST)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'ok'</span>)</span><br><span class="line">    局部使用,全局得禁用</span><br><span class="line"><span class="meta">    @csrf_protect</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">csrf_disable</span><span class="params">(request)</span>:</span></span><br><span class="line">        print(request.POST)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'ok'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="day16"><a href="#day16" class="headerlink" title="day16"></a>day16</h3><h4 id="1-auth组件"><a href="#1-auth组件" class="headerlink" title="1.auth组件"></a>1.auth组件</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>什么是auth组件</span><br><span class="line">是django内置的用户认证的组件</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>作用</span><br><span class="line">可以快速的实现用户的登录，注册，修改，注销等操作</span><br></pre></td></tr></table></figure>
<p><img src="/2019/03/02/django笔记1/1552153143351.png" alt="1552153143351"></p>
<h5 id="is-superuser是0普通用户-1超级用户"><a href="#is-superuser是0普通用户-1超级用户" class="headerlink" title="is_superuser是0普通用户,1超级用户"></a>is_superuser是0普通用户,1超级用户</h5><p><img src="/2019/03/02/django笔记1/1552153361848.png" alt="1552153361848"></p>
<h5 id="干了3件事生成一个随机字符串-把随机字符串写到cookie里-再写道session的字典里"><a href="#干了3件事生成一个随机字符串-把随机字符串写到cookie里-再写道session的字典里" class="headerlink" title="干了3件事生成一个随机字符串,把随机字符串写到cookie里,再写道session的字典里"></a>干了3件事生成一个随机字符串,把随机字符串写到cookie里,再写道session的字典里</h5><p><img src="/2019/03/02/django笔记1/1552153728832.png" alt="1552153728832"></p>
<h5 id="以后在任意视图可以调用user的方法"><a href="#以后在任意视图可以调用user的方法" class="headerlink" title="以后在任意视图可以调用user的方法"></a>以后在任意视图可以调用user的方法</h5><p><img src="/2019/03/02/django笔记1/1552153847052.png" alt="1552153847052"></p>
<p><img src="/2019/03/02/django笔记1/1552154157269.png" alt="1552154157269"></p>
<h6 id="auth中间件"><a href="#auth中间件" class="headerlink" title="auth中间件"></a>auth中间件</h6><p><img src="/2019/03/02/django笔记1/1552154010685.png" alt="1552154010685"></p>
<h4 id="2-auth组件常用的功能"><a href="#2-auth组件常用的功能" class="headerlink" title="2.auth组件常用的功能"></a>2.auth组件常用的功能</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>auth验证功能  --authenticate</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> auth</span><br><span class="line">user = auth.authenticate(request, username = name, password = password)</span><br><span class="line">**通过返回一个user对象</span><br><span class="line">相当于：</span><br><span class="line">user = User.objects.filter(name = name, password = password).first()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>auth登录功能   --login</span><br><span class="line"></span><br><span class="line">auth.login(request, user)</span><br><span class="line">目的：就是将用户信息存到session里面，并返回给客户端一个cookie里面包含一个随机字符串</span><br><span class="line">相当于：</span><br><span class="line">request.session[<span class="string">'name'</span>] = name</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">一旦登录成功，以后无论在哪个视图函数中，会多一个request.user的属性</span><br><span class="line">无论在哪个视图函数中都可以通过request.user取出当前登录的用户对象</span><br><span class="line">如果没有登录：request.user = AnonymousUser匿名用户</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">3<span class="selector-class">.auth</span>注销功能  <span class="selector-tag">--logout</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">auth</span><span class="selector-class">.logout</span>(<span class="selector-tag">request</span>)</span><br><span class="line">相当于：</span><br><span class="line"><span class="selector-tag">request</span><span class="selector-class">.session</span><span class="selector-class">.flush</span>(),删除用户的状态</span><br></pre></td></tr></table></figure>
<p><img src="/2019/03/02/django笔记1/1552154293200.png" alt="1552154293200"></p>
<p><img src="/2019/03/02/django笔记1/1552154436732.png" alt="1552154436732"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4.</span>auth的登录认证装饰器</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="meta">@login_required(redirect_field_name = 'mmm',login_url='/login/')</span></span><br><span class="line">相当于：</span><br><span class="line">?next=/.../ ...代表上次访问的路径，登录成功后返回到上次访问的路径</span><br><span class="line">redirect_field_name --相当于？后面的key值</span><br><span class="line">login_url = <span class="string">'/login/'</span></span><br><span class="line"></span><br><span class="line">注意:可以全局配置(setting配置)</span><br><span class="line"><span class="comment"># 全局的配置,如果没有登录,跳到这个路由</span></span><br><span class="line">LOGIN_URL=<span class="string">'/login/'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5.</span>auth创建用户   --create_user/create_superuser</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line">-创建普通用户</span><br><span class="line">user = User.objects.create_user(username = name, password = password)</span><br><span class="line">-创建超级用户</span><br><span class="line">user = User.objects.create_superuser(username = name, password = password)</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">不能使用create直接创建用户，因为密码是密文的，而create的密码是明文的，所以反解时会出错</span><br><span class="line">user=User.objects.create(username=name,password=pwd)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">6.</span>auth校验密码  ---check_password</span><br><span class="line">res = request.user.check_password(password)</span><br><span class="line">返回时boolean类型</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">7.</span>auth修改密码   ---set_password</span><br><span class="line">res = request.user.set_password(newpassword).save()</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">8.auth判断当前用户是否通过认证   ---is_authenticated(调用了login方法)</span><br><span class="line">res = request.user.is_authenticated()</span><br><span class="line">返回boolean类型</span><br><span class="line">应用场景登陆了显示requset.user.username,没有登陆显示注册</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">9.</span></span><br><span class="line">auth判断用户是否拥有网站的管理权限（is_staff）</span><br><span class="line"><span class="number">10.</span></span><br><span class="line">is_active ： 是否允许用户登录, 设置为 <span class="literal">False</span>，可以在不删除用户的前提下禁止用户登录。</span><br></pre></td></tr></table></figure>
<p>orm删除</p>
<h4 id="3-扩展默认的auth-user表-增加一个字段"><a href="#3-扩展默认的auth-user表-增加一个字段" class="headerlink" title="3.扩展默认的auth_user表(增加一个字段)"></a>3.扩展默认的auth_user表(增加一个字段)</h4><p><img src="/2019/03/02/django笔记1/1552156641791.png" alt="1552156641791"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">方式一：使用一对一关联</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一种方式</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserDetail</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    phone=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="comment"># 一对一跟auth_user表做关联</span></span><br><span class="line">    <span class="comment"># 如果是从外部引入的表模型,是不能加引号的</span></span><br><span class="line">    <span class="comment"># 如果加引号,只是在当前model找</span></span><br><span class="line">    user=models.OneToOneField(to=User)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">方式二：使用类继承AbstractUser,因为user模块也是继承了AbstractUser</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> AbstractUser</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(AbstractUser)</span>:</span></span><br><span class="line">    <span class="comment"># username,password...都有</span></span><br><span class="line">    phone = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    sex = models.BooleanField()</span><br><span class="line">    </span><br><span class="line">注意：一定要在setting里面做配置</span><br><span class="line"><span class="comment"># 引用Django自带的User表，继承使用时需要设置</span></span><br><span class="line">AUTH_USER_MODEL = <span class="string">"app名.UserInfo"</span></span><br><span class="line"><span class="comment"># 一旦我们指定了新的认证系统所使用的表，我们就需要重新在数据库中创建该表，而不能继续使用原来默认的auth_user表了。</span></span><br></pre></td></tr></table></figure>
<p><img src="/2019/03/02/django笔记1/1552156970809.png" alt="1552156970809"></p>
<h6 id="重构后导入自己的"><a href="#重构后导入自己的" class="headerlink" title="重构后导入自己的"></a>重构后导入自己的</h6><p><img src="/2019/03/02/django笔记1/1552157199316.png" alt="1552157199316"></p>
<h4 id="4-auth使用login-required如何重定向回去"><a href="#4-auth使用login-required如何重定向回去" class="headerlink" title="4.auth使用login_required如何重定向回去"></a>4.auth使用login_required如何重定向回去</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 需要登录的视图函数</span></span><br><span class="line"><span class="meta">@login_required(redirect_field_name='next')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">back</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        blog = request.user.blog</span><br><span class="line">        article_list = Article.objects.filter(blog=blog)</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'back_edit/detail.html'</span>, locals())</span><br><span class="line">        </span><br><span class="line"><span class="comment"># login视图函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'login.html'</span>, locals())</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        print(request.body)</span><br><span class="line">        dic = json.loads(request.body)</span><br><span class="line">        url = request.GET.get(<span class="string">'next'</span>) <span class="comment"># 获得next后面值</span></span><br><span class="line">        <span class="keyword">if</span> dic[<span class="string">'code'</span>] == request.session.get(<span class="string">'valid_code'</span>):</span><br><span class="line">            dic.pop(<span class="string">'code'</span>)</span><br><span class="line">            user = auth.authenticate(request, **dic)</span><br><span class="line">            <span class="keyword">if</span> user:</span><br><span class="line">                auth.login(request, user)</span><br><span class="line">                <span class="keyword">if</span> url: <span class="comment"># 有就重定向指定url</span></span><br><span class="line">                    res = &#123;<span class="string">'status'</span>: <span class="string">'101'</span>, <span class="string">'url'</span>: url&#125;</span><br><span class="line">                <span class="keyword">else</span>: <span class="comment"># 没有就返回到主页</span></span><br><span class="line">                    res = &#123;<span class="string">'status'</span>: <span class="string">'101'</span>, <span class="string">'url'</span>: <span class="string">'/index/'</span>&#125;</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                res = &#123;<span class="string">'status'</span>: <span class="string">'404'</span>, <span class="string">'data'</span>: <span class="string">'用户名或密码错误'</span>&#125;</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res = &#123;<span class="string">'status'</span>: <span class="string">'404'</span>, <span class="string">'data'</span>: <span class="string">'验证码输入错误'</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(res)</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1<span class="selector-class">.ajax</span>按照上面的方式重定向</span><br><span class="line"></span><br><span class="line">2<span class="selector-class">.form</span>表单，直接视图函数中重定向</span><br></pre></td></tr></table></figure>

      
    </div>

    

    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center;">
  <img id="wechat_subscriber_qcode" src="/images/gongzhonghao.jpg" alt="李江洋 wechat" style="width: 200px; max-width: 100%;">
  <div>添加微信，实地看房</div>
</div>

      </div>
    

    
      
    
    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>欢迎联系我，带您实地看房</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById(&quot;QR&quot;); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="李江洋 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="李江洋 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/python框架/" rel="tag"># python框架</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/03/02/flask/" rel="next" title="flask">
                <i class="fa fa-chevron-left"></i> flask
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/03/02/对象关系映射-orm/" rel="prev" title="对象关系映射(orm)">
                对象关系映射(orm) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="李江洋">
            
              <p class="site-author-name" itemprop="name">李江洋</p>
              <p class="site-description motion-element" itemprop="description">记录学习的技能和遇到的问题</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">179</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">41</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lvdXJuYW1l" title="GitHub &rarr; https://github.com/yourname"><i class="fa fa-fw fa-github"></i>GitHub</span>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <span class="exturl" data-url="bWFpbHRvOjEzMjgwNDQzOTJAcXEuY29t" title="E-Mail &rarr; mailto:1328044392@qq.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</span>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <span class="exturl" data-url="aHR0cDovL2V4YW1wbGUuY29t" title="http://example.com">Title</span>
                  </li>
                
              </ul>
            </div>
          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#django框架"><span class="nav-number">1.</span> <span class="nav-text">django框架</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#day01"><span class="nav-number">1.1.</span> <span class="nav-text">day01</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-web应用"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.web应用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-http协议"><span class="nav-number">1.1.2.</span> <span class="nav-text">2.http协议</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-python中的web主流的框架-MVC"><span class="nav-number">1.1.3.</span> <span class="nav-text">3.python中的web主流的框架(MVC)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-内容总结"><span class="nav-number">1.2.</span> <span class="nav-text">6 内容总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#day02"><span class="nav-number">1.3.</span> <span class="nav-text">day02</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-django中的app的概念"><span class="nav-number">1.3.1.</span> <span class="nav-text">1.django中的app的概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-模板路径配置"><span class="nav-number">1.3.2.</span> <span class="nav-text">2.模板路径配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-静态文件配置"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.静态文件配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-完整版登录功能"><span class="nav-number">1.3.4.</span> <span class="nav-text">4.完整版登录功能</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#templates（模板）"><span class="nav-number">1.3.4.1.</span> <span class="nav-text">templates（模板）</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#views（视图层）"><span class="nav-number">1.3.4.1.1.</span> <span class="nav-text">views（视图层）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-GET请求和POST请求"><span class="nav-number">1.3.5.</span> <span class="nav-text">5.GET请求和POST请求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-新手三件套总结"><span class="nav-number">1.3.6.</span> <span class="nav-text">6.新手三件套总结</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-pycharm连接数据库"><span class="nav-number">1.3.7.</span> <span class="nav-text">7.pycharm连接数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-orm介绍"><span class="nav-number">1.3.8.</span> <span class="nav-text">8.orm介绍</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#day3"><span class="nav-number">1.4.</span> <span class="nav-text">day3</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一-orm操作表，记录"><span class="nav-number">1.4.1.</span> <span class="nav-text">一.orm操作表，记录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-orm增加字段-table操作"><span class="nav-number">1.4.2.</span> <span class="nav-text">1.orm增加字段(table操作)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-orm删除字段"><span class="nav-number">1.4.3.</span> <span class="nav-text">2.orm删除字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-orm修改字段"><span class="nav-number">1.4.4.</span> <span class="nav-text">3.orm修改字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-orm查字段"><span class="nav-number">1.4.5.</span> <span class="nav-text">4.orm查字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-orm添加记录"><span class="nav-number">1.4.6.</span> <span class="nav-text">5.orm添加记录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-orm删除记录"><span class="nav-number">1.4.7.</span> <span class="nav-text">6.orm删除记录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-orm修改记录"><span class="nav-number">1.4.8.</span> <span class="nav-text">7.orm修改记录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-orm查询记录"><span class="nav-number">1.4.9.</span> <span class="nav-text">8.orm查询记录</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#数据在reder里面就已经替换完成"><span class="nav-number">1.4.9.0.1.</span> <span class="nav-text">数据在reder里面就已经替换完成</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#二-django中前端向后端发送请求后携带值得2种方式"><span class="nav-number">1.4.10.</span> <span class="nav-text">二.django中前端向后端发送请求后携带值得2种方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#三-django请求的生命周期"><span class="nav-number">1.4.11.</span> <span class="nav-text">三.django请求的生命周期</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#day4"><span class="nav-number">1.5.</span> <span class="nav-text">day4</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一-路由层"><span class="nav-number">1.5.1.</span> <span class="nav-text">一.    路由层</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#简单配置"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">简单配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#无名分组"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">无名分组</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#有名分组"><span class="nav-number">1.5.1.3.</span> <span class="nav-text">有名分组</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#反向解析"><span class="nav-number">1.5.1.4.</span> <span class="nav-text">反向解析</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#路由分发"><span class="nav-number">1.5.1.5.</span> <span class="nav-text">路由分发</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#名称空间"><span class="nav-number">1.5.1.6.</span> <span class="nav-text">名称空间</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#伪静态"><span class="nav-number">1.5.1.7.</span> <span class="nav-text">伪静态</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#根路径响应到指定"><span class="nav-number">1.5.1.8.</span> <span class="nav-text">根路径响应到指定</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#day5"><span class="nav-number">1.6.</span> <span class="nav-text">day5</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一-虚拟环境"><span class="nav-number">1.6.1.</span> <span class="nav-text">一.虚拟环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#二-django2和django1的路由的区别"><span class="nav-number">1.6.2.</span> <span class="nav-text">二.django2和django1的路由的区别</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#反斜杠-settings-py里面"><span class="nav-number">1.6.2.0.1.</span> <span class="nav-text">反斜杠(settings.py里面)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-视图层之HttpResquest对象"><span class="nav-number">1.6.3.</span> <span class="nav-text">3.视图层之HttpResquest对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-视图层之三件套"><span class="nav-number">1.6.4.</span> <span class="nav-text">4.视图层之三件套</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-视图层之JsonResponse"><span class="nav-number">1.6.5.</span> <span class="nav-text">5.视图层之JsonResponse</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-CBV和FBV类的视图还是函数的视图"><span class="nav-number">1.6.6.</span> <span class="nav-text">6.CBV和FBV类的视图还是函数的视图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-简单的文件上传功能"><span class="nav-number">1.6.7.</span> <span class="nav-text">7.简单的文件上传功能</span></a></li></ol><li class="nav-item nav-level-3"><a class="nav-link" href="#day6"><span class="nav-number">1.7.</span> <span class="nav-text">day6</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-模板层"><span class="nav-number">1.7.1.</span> <span class="nav-text">1.模板层</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-模板语法之变量"><span class="nav-number">1.7.2.</span> <span class="nav-text">2.模板语法之变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-模板语法之过滤器"><span class="nav-number">1.7.3.</span> <span class="nav-text">3.模板语法之过滤器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-模板语法之标签"><span class="nav-number">1.7.4.</span> <span class="nav-text">4.模板语法之标签</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-模板语法之自定义过滤器"><span class="nav-number">1.7.5.</span> <span class="nav-text">5.模板语法之自定义过滤器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-模板语法之自定义标签"><span class="nav-number">1.7.6.</span> <span class="nav-text">6.模板语法之自定义标签</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-模板的导入-重复使用"><span class="nav-number">1.7.7.</span> <span class="nav-text">7.模板的导入(重复使用)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-模板的继承"><span class="nav-number">1.7.8.</span> <span class="nav-text">8.模板的继承</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-静态文件相关"><span class="nav-number">1.7.9.</span> <span class="nav-text">9.静态文件相关</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#day7"><span class="nav-number">1.8.</span> <span class="nav-text">day7</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-单表操作"><span class="nav-number">1.8.1.</span> <span class="nav-text">1.单表操作</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#day8"><span class="nav-number">1.9.</span> <span class="nav-text">day8</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-一对多的增删改"><span class="nav-number">1.9.1.</span> <span class="nav-text">1.一对多的增删改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-多对多的增删改"><span class="nav-number">1.9.2.</span> <span class="nav-text">2.多对多的增删改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-一对一的增删改"><span class="nav-number">1.9.3.</span> <span class="nav-text">3.一对一的增删改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-基于对象的跨表查询"><span class="nav-number">1.9.4.</span> <span class="nav-text">4.基于对象的跨表查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-基于双下划线的连表查询"><span class="nav-number">1.9.5.</span> <span class="nav-text">5.基于双下划线的连表查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-聚合查询aggregate-–-Avg-Count-Max-Min-Sum"><span class="nav-number">1.9.6.</span> <span class="nav-text">6.聚合查询aggregate –(Avg, Count, Max, Min, Sum)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-分组查询annotate"><span class="nav-number">1.9.7.</span> <span class="nav-text">7.分组查询annotate ()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-F函数-同一张表中的2个字段作比较"><span class="nav-number">1.9.8.</span> <span class="nav-text">8.F函数:同一张表中的2个字段作比较</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-Q函数：与或非（-amp-）"><span class="nav-number">1.9.9.</span> <span class="nav-text">9.Q函数：与或非（&amp;|~）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#day9"><span class="nav-number">1.10.</span> <span class="nav-text">day9</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-ORM常用字段"><span class="nav-number">1.10.1.</span> <span class="nav-text">1.ORM常用字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-ORM不常用的字段"><span class="nav-number">1.10.2.</span> <span class="nav-text">2.ORM不常用的字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-ORM和mysql中对应的字段关系"><span class="nav-number">1.10.3.</span> <span class="nav-text">3.ORM和mysql中对应的字段关系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-ORM字段参数"><span class="nav-number">1.10.4.</span> <span class="nav-text">4.ORM字段参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-关系字段"><span class="nav-number">1.10.5.</span> <span class="nav-text">5.关系字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-元信息"><span class="nav-number">1.10.6.</span> <span class="nav-text">6.元信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-自定义字段-了解"><span class="nav-number">1.10.7.</span> <span class="nav-text">7.自定义字段(了解)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-多对多关联关系三种创建方式"><span class="nav-number">1.10.8.</span> <span class="nav-text">8.多对多关联关系三种创建方式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#day10"><span class="nav-number">1.11.</span> <span class="nav-text">day10</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-inclusion-tag"><span class="nav-number">1.11.1.</span> <span class="nav-text">1.inclusion_tag</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-defer-only（数据库优化）"><span class="nav-number">1.11.2.</span> <span class="nav-text">2.defer/only（数据库优化）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-事务-原子性操作"><span class="nav-number">1.11.3.</span> <span class="nav-text">3.事务(原子性操作)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-choice"><span class="nav-number">1.11.4.</span> <span class="nav-text">4.choice</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#day11"><span class="nav-number">1.12.</span> <span class="nav-text">day11</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-ajax组件"><span class="nav-number">1.12.1.</span> <span class="nav-text">1.ajax组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-通过ajax上传文件"><span class="nav-number">1.12.2.</span> <span class="nav-text">2.通过ajax上传文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-基于ajax提交json格式的数据"><span class="nav-number">1.12.3.</span> <span class="nav-text">3.基于ajax提交json格式的数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-基于ajax如何实现用户认证通过后的页面转跳"><span class="nav-number">1.12.4.</span> <span class="nav-text">4.基于ajax如何实现用户认证通过后的页面转跳</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-视图函数通过装饰器将json数据格式自动转成python中的数据类型"><span class="nav-number">1.12.5.</span> <span class="nav-text">4.视图函数通过装饰器将json数据格式自动转成python中的数据类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-ajax路径相关问题（-）"><span class="nav-number">1.12.6.</span> <span class="nav-text">5.ajax路径相关问题（**）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-ajax获取响应头以及自定义请求头"><span class="nav-number">1.12.7.</span> <span class="nav-text">6.ajax获取响应头以及自定义请求头</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-ajax传json格式字典，如何通过验证"><span class="nav-number">1.12.8.</span> <span class="nav-text">7.ajax传json格式字典，如何通过验证(***)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-ajax静态刷新"><span class="nav-number">1.12.9.</span> <span class="nav-text">8.ajax静态刷新</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-简单的控制上传文件的方法"><span class="nav-number">1.12.10.</span> <span class="nav-text">9.简单的控制上传文件的方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#day12"><span class="nav-number">1.13.</span> <span class="nav-text">day12</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-分页器组件（-）"><span class="nav-number">1.13.1.</span> <span class="nav-text">1.分页器组件（*）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#day13"><span class="nav-number">1.14.</span> <span class="nav-text">day13</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-Forms校验功能组件"><span class="nav-number">1.14.1.</span> <span class="nav-text">1.Forms校验功能组件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#day14"><span class="nav-number">1.15.</span> <span class="nav-text">day14</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-cookie组件"><span class="nav-number">1.15.1.</span> <span class="nav-text">1.cookie组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-django中如何使用cookie"><span class="nav-number">1.15.2.</span> <span class="nav-text">2.django中如何使用cookie</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-session组件（一定要做数据库迁移）"><span class="nav-number">1.15.3.</span> <span class="nav-text">3.session组件（一定要做数据库迁移）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#day15"><span class="nav-number">1.16.</span> <span class="nav-text">day15</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-中间件"><span class="nav-number">1.16.1.</span> <span class="nav-text">1.中间件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-自定义中间件"><span class="nav-number">1.16.2.</span> <span class="nav-text">2.自定义中间件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-中间件的方法（最重要前2个）"><span class="nav-number">1.16.3.</span> <span class="nav-text">3.中间件的方法（最重要前2个）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-csrf：跨站请求伪造"><span class="nav-number">1.16.4.</span> <span class="nav-text">4.csrf：跨站请求伪造</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-csrf：局部禁用，局部使用-CBV"><span class="nav-number">1.16.5.</span> <span class="nav-text">5.csrf：局部禁用，局部使用(CBV)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-csrf：局部禁用，局部使用-FBV"><span class="nav-number">1.16.6.</span> <span class="nav-text">6.csrf：局部禁用，局部使用(FBV)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#day16"><span class="nav-number">1.17.</span> <span class="nav-text">day16</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-auth组件"><span class="nav-number">1.17.1.</span> <span class="nav-text">1.auth组件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#is-superuser是0普通用户-1超级用户"><span class="nav-number">1.17.1.1.</span> <span class="nav-text">is_superuser是0普通用户,1超级用户</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#干了3件事生成一个随机字符串-把随机字符串写到cookie里-再写道session的字典里"><span class="nav-number">1.17.1.2.</span> <span class="nav-text">干了3件事生成一个随机字符串,把随机字符串写到cookie里,再写道session的字典里</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#以后在任意视图可以调用user的方法"><span class="nav-number">1.17.1.3.</span> <span class="nav-text">以后在任意视图可以调用user的方法</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#auth中间件"><span class="nav-number">1.17.1.3.1.</span> <span class="nav-text">auth中间件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-auth组件常用的功能"><span class="nav-number">1.17.2.</span> <span class="nav-text">2.auth组件常用的功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-扩展默认的auth-user表-增加一个字段"><span class="nav-number">1.17.3.</span> <span class="nav-text">3.扩展默认的auth_user表(增加一个字段)</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#重构后导入自己的"><span class="nav-number">1.17.3.0.1.</span> <span class="nav-text">重构后导入自己的</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-auth使用login-required如何重定向回去"><span class="nav-number">1.17.4.</span> <span class="nav-text">4.auth使用login_required如何重定向回去</span></a></li></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2025</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">李江洋</span>

  

  
</div>


  <div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <span class="exturl theme-link" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZw==">NexT.Pisces</span> v7.0.1</div>






  <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/7.1.2/mermaid.min.js"></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({theme: 'forest'});
    }
  </script>


        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>






















  
  
  <script id="ribbon" size="300" alpha="0.6" zindex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>





  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.1"></script>


  
  
  
  <script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script>


<script>
  var disqus_config = function() {
    this.page.url = "https://ljyabc.github.io/2019/03/02/django笔记1/";
    this.page.identifier = "2019/03/02/django笔记1/";
    this.page.title = 'django笔记1';
    };
  function loadComments() {
    var d = document, s = d.createElement('script');
    s.src = 'https://.disqus.com/embed.js';
    s.setAttribute('data-timestamp', '' + +new Date());
    (d.head || d.body).appendChild(s);
  }
  
    loadComments();
  
</script>





  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  
  <script src="/js/src/exturl.js?v=7.0.1"></script>


  

  

   <!-- 代码块复制功能 -->
  <script type="text/javascript" src="/js/src/clipboard.min.js"></script>  
  <script type="text/javascript" src="/js/src/clipboard-use.js"></script>
</body>
</html>
