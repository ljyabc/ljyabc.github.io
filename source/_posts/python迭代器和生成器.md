---
title: python迭代器和生成器
tags: [python进阶]
date: 2019-03-14 22:33:22
categories: 理解
photos:
---

![1552574244213](python迭代器和生成器\1552574244213.png)

![1552574319365](python迭代器和生成器\1552574319365.png)

## 迭代器：

迭代器指的是迭代取值的工具；迭代是一重复的过程；每一次重复都是基于上一次的结果而来；迭代器提供了一种通用的且不依赖于索引的迭代取值方式

```
可迭代的对象iterable：但凡内置有__iter__方法的对象都称之为可迭代的对象
执行可迭代对象下的__iter__方法，返回的值就是一个迭代器对象iterator
迭代器对象
```

```
既内置有__next__方法的对象，执行迭代器__next__方法可以不依赖索引取值
又内置有__iter__方法的对象，执行迭代器__iter__方法得到的仍然是迭代器本身
for本质应该称之为迭代器循环
```



### 工作原理

1. 先调用in后面那个对象的__iter__方法，将其变成一个迭代器对象

2. 调用next(迭代器)，将得到的返回值赋值给变量名k

3. 循环往复直到next(迭代器)抛出异常，for会自动捕捉异常然后结束循环

  迭代器总结

  优点：

4. 提供一种通用的且不依赖于索引的迭代取值方式

5. 同一时刻在内存中只存在一个值，更节省内存

#### 缺点：

1. 取值不如按照索引的方式灵活，（不能取指定的某一个值，而且只能往后取）
2. 无法预测迭代器的长度

## 生成器：

生成器就是一种自定义的迭代器，本质就是迭代器

1.但凡函数内包含yield关键字，调用函数不会执行函数体代码，会得到一个返回值，该返回值就是生成器对象

 2.res1=next(g)  会触发函数的执行，直到碰到一个yield停下来，并且将yield后的值当作本次next的结果返回

### 3yield的表达式形式的应用: x=yield

 强调：针对表达式形式的yield的使用，第一步必须让函数先暂停到一个yield的位置，才能进行传值操作

res2 = g.send('屎包子')     1. 先为当前暂停位置的yield赋值 2. next(生成器)直到再次碰到一个yield停下来，然后其的值当做本次next的结果

### 总结yield

1. yield提供了一种自定义迭代器的解决方案
2. yield可以保存函数的暂停的状态
3. yield对比return
  4. 相同点：都可以返回值，值的类型与个数都没有限制
  5. 不同点：yield可以返回多次值，而return只能返回一次值函数就   结束了

### 生成器表达式

g=(i**2 for i in range(1,6) if i > 3)

不next永远不会触发生成器，list也会触发生成器

### 文件监控示例↓

```python
import time
def tail(filename):
    f=open(filename,encoding='utf-8')
    f.seek(0,2)
    while True:
        line = f.readline()
        if not line:
            time.sleep(0.01)
            continue
        yield line
tailg = tail('demo')
for line in tailg:
    print(line,end='')
```